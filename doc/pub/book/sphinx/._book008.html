
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Scientific software engineering</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>

        <script src="http://sagecell.sagemath.org/static/jquery.min.js"></script>
        <script src="http://sagecell.sagemath.org/static/embedded_sagecell.js"></script>

        <script>sagecell.makeSagecell({inputLocation: ".sage"});</script>

        <style type="text/css">
                .sagecell .CodeMirror-scroll {
                        overflow-y: hidden;
                        overflow-x: auto;
                }
                .sagecell .CodeMirror {
                        height: auto;
                }
        </style>

    
    <link rel="top" title="Finite Difference Computing with Exponential Decay Models" href="index.html" />
    <link rel="next" title="References" href="._book009.html" />
    <link rel="prev" title="Models" href="._book007.html" />
 
  
       <style type="text/css">
         div.admonition {
           background-color: whiteSmoke;
           border: 1px solid #bababa;
         }
       </style>
      </head>
    
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="._book009.html" title="References"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="._book007.html" title="Models"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Finite Difference Computing with Exponential Decay Models</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="scientific-software-engineering">
<span id="decay-se"></span><h1>Scientific software engineering<a class="headerlink" href="#scientific-software-engineering" title="Permalink to this headline">¶</a></h1>
<p>Teaching material on scientific computing has traditionally been very
focused on the mathematics and the applications, while details on how
the computer is programmed to solve the problems have received little attention.
Many end up writing as simple programs as possible, without being
aware of much useful computer science technology that would increase
the fun, efficiency, and reliability of the their scientific computing
activities.</p>
<p>This chapter demonstrates a series of good practices and tools
from modern computer science, using the simple mathematical problem
<span class="math">\(u^{\prime}=-au\)</span>, <span class="math">\(u(0)=I\)</span>, such that we minimize the
mathematical details and can go more in depth with implementations.
The goal is to increase the technological
quality of computer programming and make it match the more
well-established quality of the mathematics of scientific computing.</p>
<p>The conventions and techniques outlined here will save you a lot of time
when you incrementally extend software over time from simpler to more
complicated problems. In particular, you will benefit from
many good habits:</p>
<blockquote>
<div><ul class="simple">
<li>new code is added in a modular fashion to a library (modules),</li>
<li>programs are run through convenient user interfaces,</li>
<li>it takes one quick command to let all your code undergo heavy testing,</li>
<li>tedious manual work with running programs is automated,</li>
<li>your scientific investigations are reproducible,</li>
<li>scientific reports with top quality typesetting are produced both
for paper and electronic devices.</li>
</ul>
</div></blockquote>
<div class="section" id="basic-implementations">
<span id="softeng1-basic"></span><h2>Basic implementations<a class="headerlink" href="#basic-implementations" title="Permalink to this headline">¶</a></h2>
<p>All previous examples in this book have implemented numerical
algorithms as Python functions. This is a good style that readers
are expected to adopt. However, this author has experienced that
many students and engineers are inclined to make &#8220;flat&#8221; programs,
i.e., a sequence of statements without any use of functions, just to
get the problem solved as quickly as possible. Since this programming
style is so widespread, especially among people with MATLAB experience,
we shall look at the weaknesses of flat programs and show how they
can be <em>refactored</em> into more reusable programs based on functions.</p>
<div class="section" id="mathematical-problem-and-solution-technique">
<span id="softeng1-basic-math"></span><h3>Mathematical problem and solution technique<a class="headerlink" href="#mathematical-problem-and-solution-technique" title="Permalink to this headline">¶</a></h3>
<p>We address the differential equation problem</p>
<div class="math" id="equation-softeng1:ode">
<span id="eq-softeng1-ode"></span><span class="eqno">(1)</span>\[     u'(t) = -au(t), \quad t \in (0,T],\]</div>
<div class="math" id="equation-softeng1:u0">
<span id="eq-softeng1-u0"></span><span class="eqno">(2)</span>\[     u(0)  = I,\]</div>
<p>where <span class="math">\(a\)</span>, <span class="math">\(I\)</span>, and <span class="math">\(T\)</span> are prescribed parameters, and <span class="math">\(u(t)\)</span> is
the unknown function to be estimated. This mathematical model
is relevant for physical phenomena featuring exponential decay
in time, e.g., vertical pressure variation in the atmosphere,
cooling of an object, and radioactive decay.</p>
<p>As we learned in the chapter <a class="reference internal" href="._book002.html#decay-schemes-fe"><span class="std std-ref">The Forward Euler scheme</span></a>, the
time domain is discretized with points <span class="math">\(0 = t_0 &lt; t_1 \cdots &lt; t_{N_t}=T\)</span>,
here with a constant spacing <span class="math">\(\Delta t\)</span> between the
mesh points: <span class="math">\(\Delta t = t_{n}-t_{n-1}\)</span>, <span class="math">\(n=1,\ldots,N_t\)</span>. Let
<span class="math">\(u^n\)</span> be the numerical approximation to the exact solution at <span class="math">\(t_n\)</span>.
A family of popular numerical methods are provided by the <span class="math">\(\theta\)</span> scheme,</p>
<div class="math" id="equation-softeng1:utheta">
<span id="eq-softeng1-utheta"></span><span class="eqno">(3)</span>\[     u^{n+1} = \frac{1 - (1-\theta) a\Delta t}{1 + \theta a\Delta t}u^n,\]</div>
<p>for <span class="math">\(n=0,1,\ldots,N_t-1\)</span>. This formula produces
the Forward Euler
scheme when <span class="math">\(\theta=0\)</span>,
the Backward Euler
scheme when <span class="math">\(\theta=1\)</span>,
and the Crank-Nicolson
scheme when <span class="math">\(\theta=1/2\)</span>.</p>
</div>
<div class="section" id="a-first-quick-implementation">
<span id="softeng1-basic-impl1"></span><h3>A first, quick implementation<a class="headerlink" href="#a-first-quick-implementation" title="Permalink to this headline">¶</a></h3>
<p>Solving <a href="#equation-softeng1:utheta">(3)</a> in a program is very straightforward:
just make a loop over <span class="math">\(n\)</span> and evaluate the formula. The <span class="math">\(u(t_n\)</span>)
values for discrete <span class="math">\(n\)</span> can be stored in an array. This makes it easy
to also plot the solution. It would be natural to also add
the exact
solution curve <span class="math">\(u(t)=Ie^{-at}\)</span> to the plot.</p>
<p>Many have programming habits that would lead them
to write a simple program like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">A</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">dt</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
    <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">theta</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="n">y_e</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">y_e</span> <span class="o">-</span> <span class="n">y</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&#39;Norm of the error: </span><span class="si">%.3E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">E</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;r--o&#39;</span><span class="p">)</span>
<span class="n">t_e</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
<span class="n">y_e</span> <span class="o">=</span> <span class="n">A</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t_e</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">y_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>This program is easy to read, and as long it is correct, many will
claim that it has sufficient quality. Nevertheless, the program suffers
from two serious flaws:</p>
<ol class="arabic simple">
<li>The notation in the program does not correspond <em>exactly</em> to
the notation in the mathematical problem: the solution is called
<code class="docutils literal"><span class="pre">y</span></code> and corresponds to <span class="math">\(u\)</span> in the mathematical description,
the variable <code class="docutils literal"><span class="pre">A</span></code> corresponds to the mathematical parameter <span class="math">\(I\)</span>,
<code class="docutils literal"><span class="pre">N</span></code> in the program is called <span class="math">\(N_t\)</span> in the mathematics.</li>
<li>There are no comments in the program.</li>
</ol>
<p>These kind of flaws quickly become crucial if present in code for complicated
mathematical problems and code that is meant to be extended to other problems.</p>
<p>We also note that the program is <em>flat</em> in the sense that it does
not contain functions. Usually, this is a bad habit, but let us
first correct the two mentioned flaws.</p>
</div>
<div class="section" id="a-more-decent-program">
<span id="softeng1-basic-impl2"></span><h3>A more decent program<a class="headerlink" href="#a-more-decent-program" title="Permalink to this headline">¶</a></h3>
<p>A code of better quality arises from
fixing the notation and adding comments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">I</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">Nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">dt</span><span class="p">))</span>     <span class="c"># no of time intervals</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>           <span class="c"># array of u[n] values</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># time mesh</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span>                 <span class="c"># Backward Euler method</span>

<span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>                  <span class="c"># assign initial condition</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nt</span><span class="p">):</span>    <span class="c"># n=0,1,...,Nt-1</span>
    <span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">theta</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

<span class="c"># Compute norm of the error</span>
<span class="n">u_e</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>     <span class="c"># exact u at the mesh points</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">u_e</span> <span class="o">-</span> <span class="n">u</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="k">print</span> <span class="s">&#39;Norm of the error: </span><span class="si">%.3E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">E</span>

<span class="c"># Compare numerical (u) and exact solution (u_e) in a plot</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s">&#39;r--o&#39;</span><span class="p">)</span>
<span class="n">t_e</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>       <span class="c"># very fine mesh for u_e</span>
<span class="n">u_e</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t_e</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>
<span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">)</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="comments-in-a-program">
<h4>Comments in a program<a class="headerlink" href="#comments-in-a-program" title="Permalink to this headline">¶</a></h4>
<p>There is obviously not just one way to comment a program, and opinions
may differ as to what code should be accomplished by comments.
The guiding principle is, however, that comments should make the
program easy to understand for human eye. Do not comment obvious
constructions, but focus on ideas and (&#8220;what happens in the next
statements?&#8221;) and on explaining code that can be interpreted as
complicated.</p>
</div>
<div class="section" id="refactoring-into-functions">
<span id="index-0"></span><h4>Refactoring into functions<a class="headerlink" href="#refactoring-into-functions" title="Permalink to this headline">¶</a></h4>
<p>At first sight, our updated program seems like
a good starting point for playing around
with the mathematical problem: we can just change parameters and rerun.
Although such edit-and-rerun sessions are good for initial exploration,
one will soon extend the experiments and start developing the code
further. Say we want to compare <span class="math">\(\theta =0,1,0.5\)</span> in the same
plot. This extension requires changes all over the code and quickly
leads to errors. To do something serious with this program, we have to
break it into smaller pieces and make sure each piece is well tested,
and ensure that the program is sufficiently general and can be reused in
new contexts without changes.  The
next natural step is therefore to isolate the numerical computations
and the visualization in separate Python functions.
Such a rewrite of a code, without essentially changing the functionality,
but just improve the quality of the code, is known as <em>refactoring</em>.
After one has quickly put some code down and tested it, it is a common
step to refactor it so it is better prepared for extensions.</p>
</div>
<div class="section" id="program-file-vs-ide-vs-notebook">
<h4>Program file vs IDE vs notebook<a class="headerlink" href="#program-file-vs-ide-vs-notebook" title="Permalink to this headline">¶</a></h4>
<p>There are basically three different ways of working with Python code:</p>
<ol class="arabic simple">
<li>One writes the code in a file, using a text editor (such as
Emacs or Vim) and runs it in a terminal window.</li>
<li>One applies an <em>Integrated Development Environment</em> (the simplest is IDLE, which comes with standard Python) containing a graphical user interface with an editor and an element where Python code can be run.</li>
<li>One applies the Jupyter Notebook (previously known as IPython Notebook),
which offers an interactive environment for Python code where
plots are automatically inserted after the code, see Figure <a class="reference internal" href="#softeng1-ipynb"><span class="std std-ref">Experimental code in a notebook</span></a>.</li>
</ol>
<p>It appears that method 1 and 2 are quite equivalent, but the notebook
encourages more experimental code and therefore also flat programs.
Consequently, notebook users will normally need to think more about
refactoring code and increase the use of functions after initial
experimentation.</p>
<div class="figure" id="id6">
<span id="softeng1-ipynb"></span><a class="reference internal image-reference" href="_images/ipynb_flat.png"><img alt="_images/ipynb_flat.png" src="_images/ipynb_flat.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-text"><em>Experimental code in a notebook</em></span></p>
</div>
</div>
</div>
<div class="section" id="prefixing-imported-functions-by-the-module-name">
<span id="softeng1-basic-modprefix"></span><h3>Prefixing imported functions by the module name<a class="headerlink" href="#prefixing-imported-functions-by-the-module-name" title="Permalink to this headline">¶</a></h3>
<p id="index-1">Import statements of the form <code class="docutils literal"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></code> import
<em>all</em> functions and variables in <code class="docutils literal"><span class="pre">module.py</span></code> into the current file.
This is often referred to as &#8220;import star&#8221;, and
many find this convenient, but it is not considered as a good
programming style in Python.
For example, when doing</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>we get mathematical functions like <code class="docutils literal"><span class="pre">sin</span></code> and <code class="docutils literal"><span class="pre">exp</span></code> as well as
MATLAB-style functions like <code class="docutils literal"><span class="pre">linspace</span></code> and <code class="docutils literal"><span class="pre">plot</span></code>, which can be called
by these well-known names.  Unfortunately, it sometimes becomes
confusing to know where a particular function comes from, i.e., what
modules you need to import. Is a desired function from <code class="docutils literal"><span class="pre">numpy</span></code> or
<code class="docutils literal"><span class="pre">matplotlib.pyplot</span></code>? Or is it our own function?  These questions are
easy to answer if functions in modules are prefixed by the module
name. Doing an additional <code class="docutils literal"><span class="pre">from</span> <span class="pre">math</span> <span class="pre">import</span> <span class="pre">*</span></code> is really crucial: now
<code class="docutils literal"><span class="pre">sin</span></code>, <code class="docutils literal"><span class="pre">cos</span></code>, and other mathematical functions are imported and their
names hide those previously imported from <code class="docutils literal"><span class="pre">numpy</span></code>.  That is, <code class="docutils literal"><span class="pre">sin</span></code> is
now a sine function that accepts a <code class="docutils literal"><span class="pre">float</span></code> argument, not an array.</p>
<p>Doing the import such that module functions must have a prefix
is generally recommended:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">u_e</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_e</span><span class="p">)</span>
</pre></div>
</div>
<p>The modules <code class="docutils literal"><span class="pre">numpy</span></code> and <code class="docutils literal"><span class="pre">matplotlib.pyplot</span></code> are frequently used,
and since their full names are quite tedious to write,
two standard abbreviations
have evolved in the Python scientific computing community:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">u_e</span> <span class="o">=</span> <span class="n">I</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u_e</span><span class="p">)</span>
</pre></div>
</div>
<p>The downside of prefixing functions by the module name is that
mathematical expressions like <span class="math">\(e^{-at}\sin(2\pi t)\)</span> get
cluttered with module names,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="c"># or</span>
<span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>Such an expression looks like <code class="docutils literal"><span class="pre">exp(-a*t)*sin(2*pi*t)</span></code> in most other
programming languages. Similarly, <code class="docutils literal"><span class="pre">np.linspace</span></code> and <code class="docutils literal"><span class="pre">plt.plot</span></code> look
less familiar to people who are used to MATLAB and who have not
adopted Python&#8217;s prefix style.  Whether to do <code class="docutils literal"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></code>
or <code class="docutils literal"><span class="pre">import</span> <span class="pre">module</span></code> depends on personal taste and the problem at
hand. In these writings we use <code class="docutils literal"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">*</span></code> in more basic,
shorter programs where similarity with MATLAB could be an
advantage. However, in reusable modules we prefix calls to module
functions by their function name, <em>or</em> do explicit import of the
needed functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">exp</span><span class="p">,</span> <span class="nb">sum</span><span class="p">,</span> <span class="n">sqrt</span>

<span class="k">def</span> <span class="nf">u_exact</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="n">error</span> <span class="o">=</span> <span class="n">u_exact</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition-prefixing-module-functions-or-not admonition">
<p class="first admonition-title">Prefixing module functions or not</p>
<p>It can be advantageous to do a combination: mathematical functions
in formulas are imported without prefix, while module functions
in general are called with a prefix. For the <code class="docutils literal"><span class="pre">numpy</span></code> package we
can do</p>
<div class="highlight-text"><div class="highlight"><pre>import numpy as np
from numpy import exp, sum, sqrt
</pre></div>
</div>
<p class="last">such that mathematical expression can apply <code class="docutils literal"><span class="pre">exp</span></code>, <code class="docutils literal"><span class="pre">sum</span></code>, and <code class="docutils literal"><span class="pre">sqrt</span></code>
and hence look as close to the mathematical formulas as possible
(without a disturbing prefix).
Other calls to <code class="docutils literal"><span class="pre">numpy</span></code> function are done with the prefix, as in
<code class="docutils literal"><span class="pre">np.linspace</span></code>.</p>
</div>
</div>
<div class="section" id="implementing-the-numerical-algorithm-in-a-function">
<span id="softeng1-basic-func"></span><h3>Implementing the numerical algorithm in a function<a class="headerlink" href="#implementing-the-numerical-algorithm-in-a-function" title="Permalink to this headline">¶</a></h3>
<p>The solution formula <a href="#equation-softeng1:utheta">(3)</a> is completely general and
should be available as a Python function <code class="docutils literal"><span class="pre">solver</span></code> with all input data as
function arguments and all output data returned to the calling code.
With this <code class="docutils literal"><span class="pre">solver</span></code> function we can solve all types of problems
<a href="#equation-softeng1:ode">(1)</a>-<a href="#equation-softeng1:u0">(2)</a>
by an easy-to-read one-line statement:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>Refactoring the numerical method in the previous flat program
in terms of a <code class="docutils literal"><span class="pre">solver</span></code> function and prefixing calls to
module functions by the module name leads to this code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Solve u&#39;=-a*u, u(0)=I, for t in (0,T] with steps of dt.&quot;&quot;&quot;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>               <span class="c"># avoid integer division</span>
    <span class="n">Nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">dt</span><span class="p">))</span>        <span class="c"># no of time intervals</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">Nt</span><span class="o">*</span><span class="n">dt</span>                    <span class="c"># adjust T to fit time step dt</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>           <span class="c"># array of u[n] values</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># time mesh</span>

    <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>                  <span class="c"># assign initial condition</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nt</span><span class="p">):</span>    <span class="c"># n=0,1,...,Nt-1</span>
        <span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">theta</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">t</span>
</pre></div>
</div>
<div class="admonition-tip-always-use-a-doc-string-to-document-a-function admonition">
<p class="first admonition-title">Tip: Always use a doc string to document a function</p>
<p class="last">Python has a convention for documenting the purpose and usage of
a function in a <em>doc string</em>: simply place the documentation
in a one- or multi-line triple-quoted string right after the
function header.</p>
</div>
<div class="admonition-be-careful-with-unintended-integer-division admonition">
<p class="first admonition-title">Be careful with unintended integer division</p>
<p class="last">Note that we in the <code class="docutils literal"><span class="pre">solver</span></code> function explicitly covert <code class="docutils literal"><span class="pre">dt</span></code> to a
<code class="docutils literal"><span class="pre">float</span></code> object. If not, the updating formula for <code class="docutils literal"><span class="pre">u[n+1]</span></code> may evaluate
to zero because of integer division when <code class="docutils literal"><span class="pre">theta</span></code>, <code class="docutils literal"><span class="pre">a</span></code>, and <code class="docutils literal"><span class="pre">dt</span></code> are integers!</p>
</div>
</div>
<div class="section" id="do-not-have-several-versions-of-a-code">
<h3>Do not have several versions of a code<a class="headerlink" href="#do-not-have-several-versions-of-a-code" title="Permalink to this headline">¶</a></h3>
<p>One of the most serious flaws in computational work is to have several
slightly different implementations of the same computational algorithms
lying around in various program files. This is very likely to happen,
because busy scientists often want to test a slight variation of a code to see
what happens. A quick copy-and-edit does the task, but such quick hacks tend
to survive. When a real correction is needed in the implementation,
it is difficult to ensure that the correction is done in all relevant files.
In fact, this is a general problem in programming, which has led to
an important principle.</p>
<div class="admonition-the-dry-principle-don-t-repeat-yourself admonition">
<p class="first admonition-title">The DRY principle: Don&#8217;t repeat yourself</p>
<p class="last">When implementing a particular functionality in a computer program, make sure
this functionality and its variations are implemented in just one piece
of code. That is, if you need to revise the implementation, there should be
<em>one and only one</em> place to edit. It follows that you should never
duplicate code (don&#8217;t repeat yourself!), and code snippets that are
similar should be factored into one piece (function) and parameterized (by
function arguments).</p>
</div>
<p>The DRY principle means that our <code class="docutils literal"><span class="pre">solver</span></code> function should not be
copied to a new file if we need some modifications. Instead, we
should try to extend <code class="docutils literal"><span class="pre">solver</span></code> such that the new and old needs are
met by a single function. Sometimes this process requires a new
refactoring, but having a numerical method in one and only one place
is a great advantage.</p>
</div>
<div class="section" id="making-a-module">
<span id="softeng1-basic-module"></span><h3>Making a module<a class="headerlink" href="#making-a-module" title="Permalink to this headline">¶</a></h3>
<p>As soon as you start making Python functions in a program, you should
make sure the program file fulfills the requirement of a module.
This means that you can import and reuse your functions in other
programs too. For example, if our <code class="docutils literal"><span class="pre">solver</span></code> function resides in a
module file <code class="docutils literal"><span class="pre">decay.py</span></code>, another program may reuse of the
function either by</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">decay</span> <span class="kn">import</span> <span class="n">solver</span>
<span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>or by a slightly different import statement, combined with a subsequent
prefix of the function name by the name of the module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">decay</span>
<span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">decay</span><span class="o">.</span><span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>The requirements for a program file to also qualify for a module are simple:</p>
<ol class="arabic simple">
<li>The filename without <code class="docutils literal"><span class="pre">.py</span></code> must be a valid Python variable name.</li>
<li>The main program must be executed (through statements or
a function call) in the <em>test block</em>.</li>
</ol>
<p>The <em>test block</em> is normally placed at the end of a module file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c"># Statements</span>
</pre></div>
</div>
<p>When the module file is executed as a stand-alone program, the if test
is true and the indented statements are run. If the module file
is imported, however, <code class="docutils literal"><span class="pre">__name__</span></code> equals the module name and the test block
is not executed.</p>
<p>To demonstrate the difference, consider the trivial module
file <code class="docutils literal"><span class="pre">hello.py</span></code> with one function and a call to this function as main program:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="s">&#39;World!&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Hello, &#39;</span> <span class="o">+</span> <span class="n">arg</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">hello</span><span class="p">()</span>
</pre></div>
</div>
<p>Without the test block, the code reads</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="s">&#39;World!&#39;</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;Hello, &#39;</span> <span class="o">+</span> <span class="n">arg</span>

<span class="n">hello</span><span class="p">()</span>
</pre></div>
</div>
<p>With this latter version of the file, any attempt to import <code class="docutils literal"><span class="pre">hello</span></code>
will, at the same time, execute the call <code class="docutils literal"><span class="pre">hello()</span></code> and hence write
&#8220;Hello, World!&#8221; to the screen.  Such output is not desired when
importing a module!  To make import and execution of code independent
for another program that wants to use the function <code class="docutils literal"><span class="pre">hello</span></code>, the module
<code class="docutils literal"><span class="pre">hello</span></code> must be written with a test block. Furthermore, running the
file itself as <code class="docutils literal"><span class="pre">python</span> <span class="pre">hello.py</span></code> will make the block active and lead
to the desired printing.</p>
<div class="admonition-all-coming-functions-are-placed-in-a-module admonition">
<p class="first admonition-title">All coming functions are placed in a module</p>
<p class="last">The many functions to be explained in the following text are
put in one module file <a class="reference external" href="http://tinyurl.com/ofkw6kc/softeng/decay.py">decay.py</a>.</p>
</div>
<p>What more than the <code class="docutils literal"><span class="pre">solver</span></code> function is needed in our <code class="docutils literal"><span class="pre">decay</span></code> module
to do everything we did in the previous, flat program?  We need import
statements for <code class="docutils literal"><span class="pre">numpy</span></code> and <code class="docutils literal"><span class="pre">matplotlib</span></code> as well as another function
for producing the plot. It can also be convenient to put the exact
solution in a Python function.  Our module <code class="docutils literal"><span class="pre">decay.py</span></code> then looks like
this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">u_exact</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">experiment_compare_numerical_and_exact</span><span class="p">():</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="n">T</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">;</span>  <span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>

    <span class="n">t_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>       <span class="c"># very fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">u_exact</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span>   <span class="n">u</span><span class="p">,</span>   <span class="s">&#39;r--o&#39;</span><span class="p">)</span>       <span class="c"># dashed red line with circles</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>         <span class="c"># blue line for u_e</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">)</span>
    <span class="n">plotfile</span> <span class="o">=</span> <span class="s">&#39;tmp&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span><span class="p">);</span>  <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>

    <span class="n">error</span> <span class="o">=</span> <span class="n">u_exact</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">print</span> <span class="s">&#39;Error norm:&#39;</span><span class="p">,</span> <span class="n">E</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">experiment_compare_numerical_and_exact</span><span class="p">()</span>
</pre></div>
</div>
<p>We could consider doing <code class="docutils literal"><span class="pre">from</span> <span class="pre">numpy</span> <span class="pre">import</span> <span class="pre">exp,</span> <span class="pre">sqrt,</span> <span class="pre">sum</span></code> to make
the mathematical expressions with these functions closer to the
mathematical formulas, but here we employed the prefix since the
formulas are so simple and easy to read.</p>
<p>This module file does exactly the same as the previous, flat program,
but now it becomes much easier to extend the code with more functions
that produce other plots, other experiments, etc. Even more important, though,
is that the numerical
algorithm is coded and tested once and for all in the <code class="docutils literal"><span class="pre">solver</span></code>
function, and any need to solve the mathematical problem is a matter
of one function call.</p>
</div>
<div class="section" id="example-on-extending-the-module-code">
<span id="softeng1-basic-experiment2"></span><h3>Example on extending the module code<a class="headerlink" href="#example-on-extending-the-module-code" title="Permalink to this headline">¶</a></h3>
<p>Let us specifically demonstrate one extension of the flat program in
the section <a class="reference internal" href="#softeng1-basic-impl1"><span class="std std-ref">A first, quick implementation</span></a> that would require substantial
editing of the flat code (the section <a class="reference internal" href="#softeng1-basic-impl2"><span class="std std-ref">A more decent program</span></a>), while in
a structured module (the section <a class="reference internal" href="#softeng1-basic-module"><span class="std std-ref">Making a module</span></a>), we can
simply add a new function without affecting the existing code.</p>
<p>Our example that illustrates the extension
is to make a comparison between the numerical solutions
for various schemes (<span class="math">\(\theta\)</span> values) and the exact solution:</p>
<div class="figure">
<a class="reference internal image-reference" href="_images/compare.png"><img alt="_images/compare.png" src="_images/compare.png" style="width: 600px;" /></a>
</div>
<div class="admonition-wait-a-minute admonition">
<p class="first admonition-title">Wait a minute</p>
<p class="last">Look at the flat program in
the section <a class="reference internal" href="#softeng1-basic-impl1"><span class="std std-ref">A first, quick implementation</span></a>,
and try to imagine which edits that are required to solve this new problem.</p>
</div>
<p>With the <code class="docutils literal"><span class="pre">solver</span></code> function at hand, we can simply create a function
with a loop over <code class="docutils literal"><span class="pre">theta</span></code> values and add the necessary plot statements:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">experiment_compare_schemes</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Compare theta=0,1,0.5 in the same plot.&quot;&quot;&quot;</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="n">T</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.4</span>
    <span class="n">legends</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]:</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="s">&#39;--o&#39;</span><span class="p">)</span>
        <span class="n">legends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">)</span>
    <span class="n">t_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>        <span class="c"># very fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">u_exact</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>
    <span class="n">legends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;exact&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legends</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">plotfile</span> <span class="o">=</span> <span class="s">&#39;tmp&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span><span class="p">);</span>  <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A call to this <code class="docutils literal"><span class="pre">experiment_compare_schemes</span></code> function must be placed
in the test block, or you can run the program from IPython instead:</p>
<div class="highlight-ipy"><div class="highlight"><pre><span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">decay</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">experiment_compare_schemes</span><span class="p">()</span>
</pre></div>
</div>
<p>We do not present how the flat program from
the section <a class="reference internal" href="#softeng1-basic-impl2"><span class="std std-ref">A more decent program</span></a> must be refactored to produce the
desired plots, but simply state that the danger of introducing bugs
is significantly larger than when just writing an additional function
in the <code class="docutils literal"><span class="pre">decay</span></code> module.</p>
</div>
<div class="section" id="documenting-functions-and-modules">
<span id="softeng1-basic-docstring"></span><h3>Documenting functions and modules<a class="headerlink" href="#documenting-functions-and-modules" title="Permalink to this headline">¶</a></h3>
<p>We have already emphasized the importance of documenting functions with
a doc string (see the section <a class="reference internal" href="#softeng1-basic-func"><span class="std std-ref">Implementing the numerical algorithm in a function</span></a>). Now it is time
to show how doc strings should be structured in order to take advantage
of the documentation utilities in the <code class="docutils literal"><span class="pre">numpy</span></code> module. The idea is
to follow a convention that in itself makes a good pure text doc string
in the terminal window
and at the same time can be translated to beautiful HTML manuals for
the web.</p>
<p>The conventions for <code class="docutils literal"><span class="pre">numpy</span></code> style doc strings are well
<a class="reference external" href="https://github.com/numpy/numpy/blob/master/doc/HOWTO_DOCUMENT.rst.txt">documented</a>, so here we just present a basic example that the reader can adopt.
Input arguments to a function are listed under the heading <code class="docutils literal"><span class="pre">Parameters</span></code>,
while returned values are listed under <code class="docutils literal"><span class="pre">Returns</span></code>. It is a good idea to
also add an <code class="docutils literal"><span class="pre">Examples</span></code> section on the usage of the function.
More complicated software may have additional sections, see <code class="docutils literal"><span class="pre">pydoc</span> <span class="pre">numpy.load</span></code>
for an example. The markup language available for doc strings is
Sphinx-extended reStructuredText. The example below shows typical
constructs: 1) how inline
mathematics is written with the <code class="docutils literal"><span class="pre">:math:</span></code> directive, 2) how arguments
to the functions are referred to using single backticks
(inline monospace font for code applies double backticks), and 3) how
arguments and return values are listed with types and explanation.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve  \( u&#39;=-au \)  with  \( u(0)=I \)  for  \( t \in (0,T] \) </span>
<span class="sd">    with steps of `dt` and the method implied by `theta`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    I: float</span>
<span class="sd">        Initial condition.</span>
<span class="sd">    a: float</span>
<span class="sd">        Parameter in the differential equation.</span>
<span class="sd">    T: float</span>
<span class="sd">        Total simulation time.</span>
<span class="sd">    theta: float, int</span>
<span class="sd">        Parameter in the numerical scheme. 0 gives</span>
<span class="sd">        Forward Euler, 1 Backward Euler, and 0.5</span>
<span class="sd">        the centered Crank-Nicolson scheme.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    `u`: array</span>
<span class="sd">        Solution array.</span>
<span class="sd">    `t`: array</span>
<span class="sd">        Array with time points corresponding to `u`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Solve  \( u&#39; = -\\frac{1}{2}u, u(0)=1.5 \) </span>
<span class="sd">    with the Crank-Nicolson method:</span>

<span class="sd">    &gt;&gt;&gt; u, t = solver(I=1.5, a=0.5, T=9, theta=0.5)</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; plt.plot(t, u)</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>If you follow such doc string conventions in your software, you can
easily produce nice manuals that meet the standard expected within
the Python scientific computing community.</p>
<p><a class="reference external" href="http://sphinx-doc.org/">Sphinx</a> requires quite a number of manual steps to
prepare a manual, so it is
recommended to use a <a class="reference external" href="http://tinyurl.com/ofkw6kc/softeng/make_sphinx_api.py">premade script</a> to automate the steps. (By default,
the script generates documentation for all <code class="docutils literal"><span class="pre">*.py</span></code> files in the
current directory.
You need to do a <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span></code> of <code class="docutils literal"><span class="pre">sphinx</span></code> and <code class="docutils literal"><span class="pre">numpydoc</span></code> to make the
script work.)
Figure <a class="reference internal" href="#softeng1-basic-docstring-fig"><span class="std std-ref">Example on Sphinx API manual in HTML</span></a> provides an example of what
the above doc strings look like when Sphinx has transformed them to HTML.</p>
<div class="figure" id="id7">
<span id="softeng1-basic-docstring-fig"></span><a class="reference internal image-reference" href="_images/selfdoc_numpy.png"><img alt="_images/selfdoc_numpy.png" src="_images/selfdoc_numpy.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-text"><em>Example on Sphinx API manual in HTML</em></span></p>
</div>
</div>
</div>
<div class="section" id="user-interfaces">
<span id="softeng1-basic-ui"></span><h2>User interfaces<a class="headerlink" href="#user-interfaces" title="Permalink to this headline">¶</a></h2>
<p>It is good programming practice to let programs read input from
some <em>user interface</em>, rather than requiring users to <em>edit</em>
parameter values in the source code. With effective user interfaces
it becomes easier and safer to apply the code for scientific investigations and
in particular to automate large-scale investigations by other programs
(see the section <a class="reference internal" href="#softeng1-experiments"><span class="std std-ref">Automating scientific experiments</span></a>).</p>
<p>Reading input data can be done in many ways. We have to decide on the
functionality of the user interface, i.e., how we want to operate the
program when providing input. Thereafter, we use appropriate tools to
implement that particular user interface. There are four basic types
of user interface, listed here according to implementational
complexity, from lowest to highest:</p>
<ol class="arabic simple">
<li>Questions and answers in the terminal window</li>
<li>Command-line arguments</li>
<li>Reading data from files</li>
<li>Graphical user interfaces (GUIs)</li>
</ol>
<p>Personal preferences of user interfaces differ substantially, and it is
difficult to present recommendations or pros and cons.
Alternatives 2 and 4 are most popular and will be addressed next.
The goal is to make it easy for the user to
set physical and numerical parameters in
our <code class="docutils literal"><span class="pre">decay.py</span></code> program. We use  a little toy program, called
<code class="docutils literal"><span class="pre">prog.py</span></code>, as introductory
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">delta</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">2</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">exp</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">delta</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">)</span>
<span class="k">print</span> <span class="n">result</span>
</pre></div>
</div>
<p>The essential content is that <code class="docutils literal"><span class="pre">prog.py</span></code> has two input parameters: <code class="docutils literal"><span class="pre">delta</span></code>
and <code class="docutils literal"><span class="pre">p</span></code>. A user interface will replace the first two assignments to
<code class="docutils literal"><span class="pre">delta</span></code> and <code class="docutils literal"><span class="pre">p</span></code>.</p>
<div class="section" id="command-line-arguments">
<h3>Command-line arguments<a class="headerlink" href="#command-line-arguments" title="Permalink to this headline">¶</a></h3>
<p>The command-line arguments are all the words that appear on the
command line after the program name. Running a program <code class="docutils literal"><span class="pre">prog.py</span></code>
as <code class="docutils literal"><span class="pre">python</span> <span class="pre">prog.py</span> <span class="pre">arg1</span> <span class="pre">arg2</span></code> means that there are two command-line arguments
(separated by white space): <code class="docutils literal"><span class="pre">arg1</span></code> and <code class="docutils literal"><span class="pre">arg2</span></code>.
Python stores all command-line arguments in
a special list <code class="docutils literal"><span class="pre">sys.argv</span></code>. (The name <code class="docutils literal"><span class="pre">argv</span></code> stems from the C language and
stands for &#8220;argument values&#8221;. In C there is also an integer variable
called <code class="docutils literal"><span class="pre">argc</span></code> reflecting the number of arguments, or &#8220;argument counter&#8221;.
A lot of programming languages have adopted the variable name <code class="docutils literal"><span class="pre">argv</span></code> for
the command-line arguments.)
Here is an example on a
program <code class="docutils literal"><span class="pre">what_is_sys_argv.py</span></code> that can show us what the command-line arguments
are</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="k">print</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
</pre></div>
</div>
<p>A sample run goes like</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python what_is_sys_argv.py 5.0 &#39;two words&#39; -1E+4
[&#39;what_is_sys_argv.py&#39;, &#39;5.0&#39;, &#39;two words&#39;, &#39;-1E+4&#39;]
</pre></div>
</div>
<p>We make two observations:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">sys.argv[0]</span></code> is the name of the program,
and the sublist <code class="docutils literal"><span class="pre">sys.argv[1:]</span></code> contains all the command-line arguments.</li>
<li>Each command-line argument is available as a string. A conversion to
<code class="docutils literal"><span class="pre">float</span></code> is necessary if we want to compute with the numbers 5.0 and
<span class="math">\(10^4\)</span>.</li>
</ul>
</div></blockquote>
<p>There are, in principle, two ways of programming with
command-line arguments in Python:</p>
<blockquote>
<div><ul class="simple">
<li><strong>Positional arguments:</strong> Decide upon a sequence of parameters
on the command line and read
their values directly from the <code class="docutils literal"><span class="pre">sys.argv[1:]</span></code> list.</li>
<li><strong>Option-value pairs:</strong>  Use <code class="docutils literal"><span class="pre">--option</span> <span class="pre">value</span></code> on
the command line to replace the default value of an input parameter
<code class="docutils literal"><span class="pre">option</span></code> by <code class="docutils literal"><span class="pre">value</span></code> (and utilize the <code class="docutils literal"><span class="pre">argparse.ArgumentParser</span></code> tool
for implementation).</li>
</ul>
</div></blockquote>
<p>Suppose we want to run some program <code class="docutils literal"><span class="pre">prog.py</span></code> with
specification of two parameters <code class="docutils literal"><span class="pre">p</span></code> and <code class="docutils literal"><span class="pre">delta</span></code> on the command line.
With positional command-line arguments we write</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python prog.py 2 0.5
</pre></div>
</div>
<p>and must know that the first argument <code class="docutils literal"><span class="pre">2</span></code> represents <code class="docutils literal"><span class="pre">p</span></code> and the
next <code class="docutils literal"><span class="pre">0.5</span></code> is the value of <code class="docutils literal"><span class="pre">delta</span></code>.
With option-value pairs we can run</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python prog.py --delta 0.5 --p 2
</pre></div>
</div>
<p>Now, both <code class="docutils literal"><span class="pre">p</span></code> and <code class="docutils literal"><span class="pre">delta</span></code> are supposed to have default values in the program,
so we need to specify only the parameter that is to be changed from
its default value, e.g.,</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python prog.py --p 2         # p=2, default delta
Terminal&gt; python prog.py --delta 0.7   # delta-0.7, default a
Terminal&gt; python prog.py               # default a and delta
</pre></div>
</div>
<p>How do we extend the <code class="docutils literal"><span class="pre">prog.py</span></code> code for positional arguments
and option-value pairs? Positional arguments require very simple
code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">p</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">delta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">exp</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">delta</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">)</span>
<span class="k">print</span> <span class="n">result</span>
</pre></div>
</div>
<p>If the user forgets to supply two command-line arguments, Python will
raise an <code class="docutils literal"><span class="pre">IndexError</span></code> exception and produce a long error message.
To avoid that, we should use a <code class="docutils literal"><span class="pre">try-except</span></code> construction:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;Usage: </span><span class="si">%s</span><span class="s"> p delta&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">exp</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">delta</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">)</span>
<span class="k">print</span> <span class="n">result</span>
</pre></div>
</div>
<p>Using <code class="docutils literal"><span class="pre">sys.exit(1)</span></code> aborts the program. The value 1 (actually any
value different from 0) notifies the operating system that the
program failed.</p>
<div class="admonition-command-line-arguments-are-strings admonition">
<p class="first admonition-title">Command-line arguments are strings</p>
<p class="last">Note that all elements in <code class="docutils literal"><span class="pre">sys.argv</span></code> are string objects.
If the values will enter mathematical computations, we need
to explicitly convert the strings to numbers.</p>
</div>
<p>Option-value pairs requires more programming and is actually
better explained in a more comprehensive example below.
Minimal code for our <code class="docutils literal"><span class="pre">prog.py</span></code> program reads</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--p&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--delta&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">p</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">delta</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">exp</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">delta</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">)</span>
<span class="k">print</span> <span class="n">result</span>
</pre></div>
</div>
<p>Because the default values of <code class="docutils literal"><span class="pre">delta</span></code> and <code class="docutils literal"><span class="pre">p</span></code> are float numbers,
the <code class="docutils literal"><span class="pre">args.delta</span></code> and <code class="docutils literal"><span class="pre">args.p</span></code> variable are automatically of type <code class="docutils literal"><span class="pre">float</span></code>.</p>
<p>Our next task is to use these basic code constructs to equip our
<code class="docutils literal"><span class="pre">decay.py</span></code> module with command-line interfaces.</p>
</div>
<div class="section" id="positional-command-line-arguments">
<h3>Positional command-line arguments<a class="headerlink" href="#positional-command-line-arguments" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-2"></span><span class="target" id="index-3"></span><p id="index-4">For our <code class="docutils literal"><span class="pre">decay.py</span></code> module file, we want include functionality such
that we can read <span class="math">\(I\)</span>, <span class="math">\(a\)</span>, <span class="math">\(T\)</span>, <span class="math">\(\theta\)</span>, and a range of <span class="math">\(\Delta t\)</span>
values from the command line.  A plot is then to be made, comparing
the different numerical solutions for different <span class="math">\(\Delta t\)</span> values
against the exact solution. The technical details of getting the
command-line information into the program is covered in the next
two sections.</p>
<p>The simplest way of reading the input parameters is to
decide on their sequence on the command line and just index
the <code class="docutils literal"><span class="pre">sys.argv</span></code> list accordingly.
Say the sequence of input data for some functionality in
<code class="docutils literal"><span class="pre">decay.py</span></code> is <span class="math">\(I\)</span>, <span class="math">\(a\)</span>, <span class="math">\(T\)</span>, <span class="math">\(\theta\)</span> followed by an
arbitrary number of <span class="math">\(\Delta t\)</span> values. This code extracts
these <em>positional</em> command-line arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">read_command_line_positional</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Usage: </span><span class="si">%s</span><span class="s"> I a T on/off BE/FE/CN dt1 dt2 dt3 ...&#39;</span> <span class="o">%</span> \
              <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># abort</span>

    <span class="n">I</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">T</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
    <span class="n">dt_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">5</span><span class="p">:]]</span>

    <span class="k">return</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt_values</span>
</pre></div>
</div>
<p>Note that we may use a <code class="docutils literal"><span class="pre">try-except</span></code> construction instead of the if test.</p>
<p>A run like</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python decay.py 1 0.5 4 0.5 1.5 0.75 0.1
</pre></div>
</div>
<p>results in</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;decay.py&#39;</span><span class="p">,</span> <span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;0.5&#39;</span><span class="p">,</span> <span class="s">&#39;4&#39;</span><span class="p">,</span> <span class="s">&#39;0.5&#39;</span><span class="p">,</span> <span class="s">&#39;1.5&#39;</span><span class="p">,</span> <span class="s">&#39;0.75&#39;</span><span class="p">,</span> <span class="s">&#39;0.1&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>and consequently the assignments <code class="docutils literal"><span class="pre">I=1.0</span></code>, <code class="docutils literal"><span class="pre">a=0.5</span></code>, <code class="docutils literal"><span class="pre">T=4.0</span></code>, <code class="docutils literal"><span class="pre">thet=0.5</span></code>,
and <code class="docutils literal"><span class="pre">dt_values</span> <span class="pre">=</span> <span class="pre">[1.5,</span> <span class="pre">0.75,</span> <span class="pre">0.1]</span></code>.</p>
<p>Instead of specifying the <span class="math">\(\theta\)</span> value, we could be a bit more
sophisticated and let the user write the name of the scheme:
<code class="docutils literal"><span class="pre">BE</span></code> for Backward Euler, <code class="docutils literal"><span class="pre">FE</span></code> for Forward Euler, and <code class="docutils literal"><span class="pre">CN</span></code>
for Crank-Nicolson. Then we must map this string to the proper
<span class="math">\(\theta\)</span> value, an operation elegantly done by a dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">scheme</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="n">scheme2theta</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;BE&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;CN&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s">&#39;FE&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="k">if</span> <span class="n">scheme</span> <span class="ow">in</span> <span class="n">scheme2theta</span><span class="p">:</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">scheme2theta</span><span class="p">[</span><span class="n">scheme</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;Invalid scheme name:&#39;</span><span class="p">,</span> <span class="n">scheme</span><span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can do</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python decay.py 1 0.5 4 CN 1.5 0.75 0.1
</pre></div>
</div>
<p>and get <a href="#id1"><span class="problematic" id="id2">`</span></a>theta=0.5`in the code.</p>
</div>
<div class="section" id="option-value-pairs-on-the-command-line">
<h3>Option-value pairs on the command line<a class="headerlink" href="#option-value-pairs-on-the-command-line" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-5"></span><span class="target" id="index-6"></span><span class="target" id="index-7"></span><span class="target" id="index-8"></span><p id="index-9">Now we want to specify option-value pairs on the command line,
using <code class="docutils literal"><span class="pre">--I</span></code> for <code class="docutils literal"><span class="pre">I</span></code> (<span class="math">\(I\)</span>), <code class="docutils literal"><span class="pre">--a</span></code> for <code class="docutils literal"><span class="pre">a</span></code> (<span class="math">\(a\)</span>), <code class="docutils literal"><span class="pre">--T</span></code> for <code class="docutils literal"><span class="pre">T</span></code> (<span class="math">\(T\)</span>),
<code class="docutils literal"><span class="pre">--scheme</span></code> for the scheme name (<code class="docutils literal"><span class="pre">BE</span></code>, <code class="docutils literal"><span class="pre">FE</span></code>, <code class="docutils literal"><span class="pre">CN</span></code>),
and <code class="docutils literal"><span class="pre">--dt</span></code> for the sequence of <code class="docutils literal"><span class="pre">dt</span></code> (<span class="math">\(\Delta t\)</span>) values.
Each parameter must have a sensible default value so
that we specify the option on the command line only when the default
value is not suitable. Here is a typical run:</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python decay.py --I 2.5 --dt 0.1 0.2 0.01 --a 0.4
</pre></div>
</div>
<p>Observe the major advantage over positional command-line arguments:
the input is much easier to read and much easier to write.
With positional arguments it is easy to mess up the sequence of
the input parameters and quite challenging to detect errors too,
unless there are just a couple of arguments.</p>
<p>Python&#8217;s <code class="docutils literal"><span class="pre">ArgumentParser</span></code> tool in the <code class="docutils literal"><span class="pre">argparse</span></code> module makes it easy
to create a professional command-line interface to any program. The
documentation of <a class="reference external" href="http://docs.python.org/library/argparse.html">ArgumentParser</a> demonstrates its
versatile applications, so we shall here just list an example
containing the most basic features. It always pays off to use <code class="docutils literal"><span class="pre">ArgumentParser</span></code>
rather than trying to manually inspect and interpret option-value pairs
in <code class="docutils literal"><span class="pre">sys.argv</span></code>!</p>
<p>The use of <code class="docutils literal"><span class="pre">ArgumentParser</span></code> typically involves three steps:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">argparse</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

<span class="c"># Step 1: add arguments</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--option_name&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>

<span class="c"># Step 2: interpret the command line</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="c"># Step 3: extract values</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">option_name</span>
</pre></div>
</div>
<p>A function for setting up all the options is handy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">define_command_line_options</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">argparse</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--I&#39;</span><span class="p">,</span> <span class="s">&#39;--initial_condition&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;initial condition, u(0)&#39;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;I&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--a&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;coefficient in ODE&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--T&#39;</span><span class="p">,</span> <span class="s">&#39;--stop_time&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;end time of simulation&#39;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;T&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--scheme&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;CN&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&#39;FE, BE, or CN&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s">&#39;--dt&#39;</span><span class="p">,</span> <span class="s">&#39;--time_step_values&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;time step values&#39;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;dt&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;dt_values&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span>
</pre></div>
</div>
<p>Each command-line option is defined through the <code class="docutils literal"><span class="pre">parser.add_argument</span></code>
method <a class="footnote-reference" href="#class-method" id="id3">[1]</a>. Alternative options, like the short <code class="docutils literal"><span class="pre">--I</span></code> and the more
explaining version <code class="docutils literal"><span class="pre">--initial_condition</span></code> can be defined. Other arguments
are <code class="docutils literal"><span class="pre">type</span></code> for the Python object type, a default value, and a help
string, which gets printed if the command-line argument <code class="docutils literal"><span class="pre">-h</span></code> or <code class="docutils literal"><span class="pre">--help</span></code> is
included. The <code class="docutils literal"><span class="pre">metavar</span></code> argument specifies the value associated with
the option when the help string is printed. For example, the option for
<span class="math">\(I\)</span> has this help output:</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python decay.py -h
  ...
  --I I, --initial_condition I
                        initial condition, u(0)
  ...
</pre></div>
</div>
<p>The structure of this output is</p>
<div class="highlight-text"><div class="highlight"><pre>--I metavar, --initial_condition metavar
                      help-string
</pre></div>
</div>
<table class="docutils footnote" frame="void" id="class-method" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[1]</a></td><td>We use the expression <em>method</em> here, because <code class="docutils literal"><span class="pre">parser</span></code>
is a class variable and functions in classes are known as methods in Python
and many other languages.
Readers not familiar with class programming can just substitute
this use of <em>method</em> by <em>function</em>.</td></tr>
</tbody>
</table>
<p>Finally, the <code class="docutils literal"><span class="pre">--dt</span></code> option demonstrates how to allow for more than one
value (separated by blanks) through the <code class="docutils literal"><span class="pre">nargs='+'</span></code> keyword argument.
After the command line is parsed, we get an object where the values of
the options are stored as attributes. The attribute name is specified
by the <code class="docutils literal"><span class="pre">dist</span></code> keyword argument, which for the <code class="docutils literal"><span class="pre">--dt</span></code> option is
<code class="docutils literal"><span class="pre">dt_values</span></code>. Without the <code class="docutils literal"><span class="pre">dest</span></code> argument, the value of an option <code class="docutils literal"><span class="pre">--opt</span></code>
is stored as the attribute <code class="docutils literal"><span class="pre">opt</span></code>.</p>
<p>The code below demonstrates how to read the command line and extract
the values for each option:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">read_command_line_argparse</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">define_command_line_options</span><span class="p">()</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">scheme2theta</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;BE&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;CN&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s">&#39;FE&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">scheme2theta</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">scheme</span><span class="p">],</span>
            <span class="n">args</span><span class="o">.</span><span class="n">dt_values</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
<p>As seen, the values of the command-line options are available as
attributes in <code class="docutils literal"><span class="pre">args</span></code>: <code class="docutils literal"><span class="pre">args.opt</span></code> holds the value of option <code class="docutils literal"><span class="pre">--opt</span></code>, unless
we used the <code class="docutils literal"><span class="pre">dest</span></code> argument (as for <code class="docutils literal"><span class="pre">--dt_values</span></code>) for specifying the
attribute name. The <code class="docutils literal"><span class="pre">args.opt</span></code> attribute has the object type specified
by <code class="docutils literal"><span class="pre">type</span></code> (<code class="docutils literal"><span class="pre">str</span></code> by default).</p>
<p>The making of the plot is not dependent on whether we read data from
the command line as positional arguments or option-value pairs:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">experiment_compare_dt</span><span class="p">(</span><span class="n">option_value_pairs</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt_values</span> <span class="o">=</span> \
       <span class="n">read_command_line_argparse</span><span class="p">()</span> <span class="k">if</span> <span class="n">option_value_pairs</span> <span class="k">else</span> \
       <span class="n">read_command_line_positional</span><span class="p">()</span>

    <span class="n">legends</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dt_values</span><span class="p">:</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
        <span class="n">legends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;dt=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">dt</span><span class="p">)</span>
    <span class="n">t_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>       <span class="c"># very fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">u_exact</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">legends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;exact&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legends</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">)</span>
    <span class="n">plotfile</span> <span class="o">=</span> <span class="s">&#39;tmp&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span><span class="p">);</span>  <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-graphical-web-user-interface">
<h3>Creating a graphical web user interface<a class="headerlink" href="#creating-a-graphical-web-user-interface" title="Permalink to this headline">¶</a></h3>
<p>The Python package <a class="reference external" href="https://github.com/hplgit/parampool">Parampool</a>
can be used to automatically generate a web-based <em>graphical user interface</em>
(GUI) for our simulation program. Although the programming technique
dramatically simplifies the efforts to create a GUI, the forthcoming
material on equipping our <code class="docutils literal"><span class="pre">decay</span></code> module with a GUI is quite technical
and of significantly less importance than knowing how to make
a command-line interface.</p>
<div class="section" id="making-a-compute-function">
<h4>Making a compute function<a class="headerlink" href="#making-a-compute-function" title="Permalink to this headline">¶</a></h4>
<p>The first step is to identify a function
that performs the computations and that takes the necessary input
variables as arguments. This is called the <em>compute function</em> in
Parampool terminology. The purpose of this function is to take
values of <span class="math">\(I\)</span>, <span class="math">\(a\)</span>, <span class="math">\(T\)</span> together with a sequence of <span class="math">\(\Delta t\)</span> values
and a sequence of <span class="math">\(\theta\)</span> and plot the numerical against the
exact solution for each pair of <span class="math">\((\theta, \Delta t)\)</span>.
The plots can be arranged as a table with the columns being scheme type
(<span class="math">\(\theta\)</span> value) and the rows reflecting the discretization parameter
(<span class="math">\(\Delta t\)</span> value). Figure <a class="reference internal" href="#softeng1-fig-gui"><span class="std std-ref">Automatically generated graphical web interface</span></a> displays what the
graphical web interface may look like after results are computed
(there are <span class="math">\(3\times 3\)</span> plots in the GUI, but only <span class="math">\(2\times 2\)</span> are
visible in the figure).</p>
<div class="figure" id="id8">
<span id="softeng1-fig-gui"></span><a class="reference internal image-reference" href="_images/web_GUI.png"><img alt="_images/web_GUI.png" src="_images/web_GUI.png" style="width: 800px;" /></a>
<p class="caption"><span class="caption-text"><em>Automatically generated graphical web interface</em></span></p>
</div>
<p>To tell Parampool what type of input data we have,
we assign default values of the right type to all arguments in the
compute function, here called <code class="docutils literal"><span class="pre">main_GUI</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">main_GUI</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">a</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
             <span class="n">dt_values</span><span class="o">=</span><span class="p">[</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
             <span class="n">theta_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
</pre></div>
</div>
<p>The compute function must return the HTML code we want for displaying
the result in a web page. Here we want to show a
table of plots.
Assume for now that the HTML code for one plot and the value of the
norm of the error can be computed by some other function <code class="docutils literal"><span class="pre">compute4web</span></code>.
The <code class="docutils literal"><span class="pre">main_GUI</span></code> function can then loop over <span class="math">\(\Delta t\)</span> and <span class="math">\(\theta\)</span>
values and put each plot in an HTML table. Appropriate code goes like</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">main_GUI</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">a</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span>
             <span class="n">dt_values</span><span class="o">=</span><span class="p">[</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
             <span class="n">theta_values</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
    <span class="c"># Build HTML code for web page. Arrange plots in columns</span>
    <span class="c"># corresponding to the theta values, with dt down the rows</span>
    <span class="n">theta2name</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s">&#39;FE&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s">&#39;BE&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">:</span> <span class="s">&#39;CN&#39;</span><span class="p">}</span>
    <span class="n">html_text</span> <span class="o">=</span> <span class="s">&#39;&lt;table&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dt_values</span><span class="p">:</span>
        <span class="n">html_text</span> <span class="o">+=</span> <span class="s">&#39;&lt;tr&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">theta_values</span><span class="p">:</span>
            <span class="n">E</span><span class="p">,</span> <span class="n">html</span> <span class="o">=</span> <span class="n">compute4web</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
            <span class="n">html_text</span> <span class="o">+=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">&lt;td&gt;</span>
<span class="s">&lt;center&gt;&lt;b&gt;</span><span class="si">%s</span><span class="s">, dt=</span><span class="si">%g</span><span class="s">, error: </span><span class="si">%.3E</span><span class="s">&lt;/b&gt;&lt;/center&gt;&lt;br&gt;</span>
<span class="si">%s</span><span class="s"></span>
<span class="s">&lt;/td&gt;</span>
<span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">theta2name</span><span class="p">[</span><span class="n">theta</span><span class="p">],</span> <span class="n">dt</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
        <span class="n">html_text</span> <span class="o">+=</span> <span class="s">&#39;&lt;/tr&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">html_text</span> <span class="o">+=</span> <span class="s">&#39;&lt;/table&gt;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">return</span> <span class="n">html_text</span>
</pre></div>
</div>
<p>Making one plot is done in <code class="docutils literal"><span class="pre">compute4web</span></code>. The statements should be
straightforward from earlier examples, but there is one new feature:
we use a tool in Parampool to embed the PNG code for a plot file
directly in an HTML image tag. The details are hidden from the
programmer, who can just rely on
relevant HTML code in the string <code class="docutils literal"><span class="pre">html_text</span></code>. The function looks like</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">compute4web</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run a case with the solver, compute error measure,</span>
<span class="sd">    and plot the numerical and exact solutions in a PNG</span>
<span class="sd">    plot whose data are embedded in an HTML image tag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">u_exact</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">u_e</span> <span class="o">-</span> <span class="n">u</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">t_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>    <span class="c"># fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">u_exact</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span>   <span class="n">u</span><span class="p">,</span>   <span class="s">&#39;r--o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical&#39;</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;theta=</span><span class="si">%g</span><span class="s">, dt=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">dt</span><span class="p">))</span>
    <span class="c"># Save plot to HTML img tag with PNG code as embedded data</span>
    <span class="kn">from</span> <span class="nn">parampool.utils</span> <span class="kn">import</span> <span class="n">save_png_to_str</span>
    <span class="n">html_text</span> <span class="o">=</span> <span class="n">save_png_to_str</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="n">plotwidth</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">E</span><span class="p">,</span> <span class="n">html_text</span>
</pre></div>
</div>
</div>
<div class="section" id="generating-the-user-interface">
<h4>Generating the user interface<a class="headerlink" href="#generating-the-user-interface" title="Permalink to this headline">¶</a></h4>
<p>The web GUI is automatically generated by
the following code, placed in the file <a class="reference external" href="http://tinyurl.com/ofkw6kc/softeng/decay_GUI_generate.py">decay_GUI_generate.py</a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">parampool.generator.flask</span> <span class="kn">import</span> <span class="n">generate</span>
<span class="kn">from</span> <span class="nn">decay</span> <span class="kn">import</span> <span class="n">main_GUI</span>
<span class="n">generate</span><span class="p">(</span><span class="n">main_GUI</span><span class="p">,</span>
         <span class="n">filename_controller</span><span class="o">=</span><span class="s">&#39;decay_GUI_controller.py&#39;</span><span class="p">,</span>
         <span class="n">filename_template</span><span class="o">=</span><span class="s">&#39;decay_GUI_view.py&#39;</span><span class="p">,</span>
         <span class="n">filename_model</span><span class="o">=</span><span class="s">&#39;decay_GUI_model.py&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Running the <code class="docutils literal"><span class="pre">decay_GUI_generate.py</span></code> program results in three new
files whose names are specified in the call to <code class="docutils literal"><span class="pre">generate</span></code>:</p>
<blockquote>
<div><ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">decay_GUI_model.py</span></code> defines HTML widgets to be used to set
input data in the web interface,</li>
<li><code class="docutils literal"><span class="pre">templates/decay_GUI_views.py</span></code> defines the layout of the web page,</li>
<li><code class="docutils literal"><span class="pre">decay_GUI_controller.py</span></code> runs the web application.</li>
</ol>
</div></blockquote>
<p>We only need to run the last program, and there is no need to look into
these files.</p>
</div>
<div class="section" id="running-the-web-application">
<h4>Running the web application<a class="headerlink" href="#running-the-web-application" title="Permalink to this headline">¶</a></h4>
<p>The web GUI is started by</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python decay_GUI_controller.py
</pre></div>
</div>
<p>Open a web browser at the location <code class="docutils literal"><span class="pre">127.0.0.1:5000</span></code>. Input fields for
<code class="docutils literal"><span class="pre">I</span></code>, <code class="docutils literal"><span class="pre">a</span></code>, <code class="docutils literal"><span class="pre">T</span></code>, <code class="docutils literal"><span class="pre">dt_values</span></code>, and <code class="docutils literal"><span class="pre">theta_values</span></code> are presented.  Figure
<a class="reference internal" href="#softeng1-fig-gui"><span class="std std-ref">Automatically generated graphical web interface</span></a> shows a part of the resulting page if we run
with the default values for the input parameters.
With the techniques demonstrated here, one can
easily create a tailored web GUI for a particular type of application
and use it to interactively explore physical and numerical effects.</p>
</div>
</div>
</div>
<div class="section" id="tests-for-verifying-implementations">
<h2>Tests for verifying implementations<a class="headerlink" href="#tests-for-verifying-implementations" title="Permalink to this headline">¶</a></h2>
<p>Any module with functions should have a set of tests that can
check the
correctness of the implementations.
There exists
well-established procedures and corresponding tools for automating
the execution of such tests. These tools allow large test sets to be
run with a one-line command, making it easy to check of the
still software works (as far as the
tests tell!). Here we shall illustrate two important
software testing techniques: <em>doctest</em> and <em>unit testing</em>.
The first one is Python specific, while unit testing is the dominating
test technique in the software industry today.</p>
<div class="section" id="doctests">
<h3>Doctests<a class="headerlink" href="#doctests" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-10"></span><p id="index-11">A doc string, the first string after the function header, is used to
document the purpose of functions and their arguments
(see the section <a class="reference internal" href="#softeng1-basic-func"><span class="std std-ref">Implementing the numerical algorithm in a function</span></a>). Very often it
is instructive to include an example in the doc string
on how to use the function.
Interactive examples in the Python shell are most illustrative as
we can see the output resulting from the statements and expressions.
For example,
in the <code class="docutils literal"><span class="pre">solver</span></code> function, we can include an example on calling
this function and printing the computed <code class="docutils literal"><span class="pre">u</span></code> and <code class="docutils literal"><span class="pre">t</span></code> arrays:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Solve u&#39;=-a*u, u(0)=I, for t in (0,T] with steps of dt.</span>


<span class="sd">    &gt;&gt;&gt; u, t = solver(I=0.8, a=1.2, T=1.5, dt=0.5, theta=0.5)</span>
<span class="sd">    &gt;&gt;&gt; for n in range(len(t)):</span>
<span class="sd">    ...     print &#39;t=%.1f, u=%.14f&#39; % (t[n], u[n])</span>
<span class="sd">    t=0.0, u=0.80000000000000</span>
<span class="sd">    t=0.5, u=0.43076923076923</span>
<span class="sd">    t=1.0, u=0.23195266272189</span>
<span class="sd">    t=1.5, u=0.12489758761948</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>When such interactive demonstrations are inserted in doc strings,
Python&#8217;s <a class="reference external" href="http://docs.python.org/library/doctest.html">doctest</a>
module can be used to automate running all commands
in interactive sessions and compare new output with the output
appearing in the doc string.  All we have to do in the current example
is to run the module file <code class="docutils literal"><span class="pre">decay.py</span></code> with</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Terminal</span><span class="o">&gt;</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">doctest</span> <span class="n">decay</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This command imports the <code class="docutils literal"><span class="pre">doctest</span></code> module, which runs all
doctests found in the file and reports discrepancies between
expected and computed output.
Alternatively, the test block in a module may run all doctests
by</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>
</div>
<p>Doctests can also be embedded in nose/pytest unit tests
as explained in the next section.</p>
<div class="admonition-doctests-prevent-command-line-arguments admonition">
<p class="first admonition-title">Doctests prevent command-line arguments</p>
<p>No additional command-line argument is allowed when running doctests.
If your program relies on command-line input, make sure the doctests
can be run <em>without</em> such input on the command line.</p>
<p>However, you can simulate command-line input by filling <code class="docutils literal"><span class="pre">sys.argv</span></code>
with values, e.g.,</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span><span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="s">&#39;--I 1.0 --a 5&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>The execution command above will report any problem if a test fails.
As an illustration, let us alter the <code class="docutils literal"><span class="pre">u</span></code> value at <code class="docutils literal"><span class="pre">t=1.5</span></code> in
the output of the doctest by replacing the last digit <code class="docutils literal"><span class="pre">8</span></code> by <code class="docutils literal"><span class="pre">7</span></code>.
This edit triggers a report:</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python -m doctest decay.py
********************************************************
File &quot;decay.py&quot;, line ...
Failed example:
    for n in range(len(t)):
        print &#39;t=%.1f, u=%.14f&#39; % (t[n], u[n])
Expected:
    t=0.0, u=0.80000000000000
    t=0.5, u=0.43076923076923
    t=1.0, u=0.23195266272189
    t=1.5, u=0.12489758761948
Got:
    t=0.0, u=0.80000000000000
    t=0.5, u=0.43076923076923
    t=1.0, u=0.23195266272189
    t=1.5, u=0.12489758761947
</pre></div>
</div>
<div class="admonition-pay-attention-to-the-number-of-digits-in-doctest-results admonition">
<p class="first admonition-title">Pay attention to the number of digits in doctest results</p>
<p class="last">Note that in the output of <code class="docutils literal"><span class="pre">t</span></code> and <code class="docutils literal"><span class="pre">u</span></code> we write <code class="docutils literal"><span class="pre">u</span></code> with 14 digits.
Writing all 16 digits is not a good idea: if the tests are run on
different hardware, round-off errors might be different, and
the <code class="docutils literal"><span class="pre">doctest</span></code> module detects that the numbers are not precisely the same
and reports failures. In the present application, where <span class="math">\(0 &lt; u(t) \leq 0.8\)</span>,
we expect round-off errors to be of size <span class="math">\(10^{-16}\)</span>, so comparing 15
digits would probably be reliable, but we compare 14 to be on the
safe side. On the other hand, comparing a small number of digits may
hide software errors.</p>
</div>
<p>Doctests are highly encouraged as they do two things: 1) demonstrate
how a function is used and 2) test that the function works.</p>
</div>
<div class="section" id="unit-tests-and-test-functions">
<h3>Unit tests and test functions<a class="headerlink" href="#unit-tests-and-test-functions" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-12"></span><span class="target" id="index-13"></span><span class="target" id="index-14"></span><span class="target" id="index-15"></span><p id="index-16">The unit testing technique consists of identifying smaller units
of code and writing one or more tests for
each unit. One unit can typically be a function.
Each test should, ideally, not depend on the outcome of
other tests. The recommended practice is actually to
design and write the unit tests first and <em>then</em> implement the functions!</p>
<p>In scientific computing it is not always obvious how to best perform
unit testing. The units are naturally larger than in non-scientific
software. Very often the solution procedure of a mathematical problem
identifies a unit, such as our <code class="docutils literal"><span class="pre">solver</span></code> function.</p>
<span class="target" id="index-17"></span><div class="section" id="two-python-test-frameworks-nose-and-pytest">
<span id="index-18"></span><h4>Two Python test frameworks: nose and pytest<a class="headerlink" href="#two-python-test-frameworks-nose-and-pytest" title="Permalink to this headline">¶</a></h4>
<p>Python offers two very easy-to-use software frameworks for implementing
unit tests: nose and pytest. These work (almost) in the same way,
but our recommendation is to go for pytest.</p>
</div>
<div class="section" id="test-function-requirements">
<h4>Test function requirements<a class="headerlink" href="#test-function-requirements" title="Permalink to this headline">¶</a></h4>
<p>For a test to qualify as a <em>test function</em> in nose or pytest, three
rules must be followed:</p>
<blockquote>
<div><ol class="arabic simple">
<li>The function name must start with <code class="docutils literal"><span class="pre">test_</span></code>.</li>
<li>Function arguments are not allowed.</li>
<li>An <code class="docutils literal"><span class="pre">AssertionError</span></code> exception must be raised if the test fails.</li>
</ol>
</div></blockquote>
<p>A specific example might be illustrative before proceeding.
We have the following function that we want to test:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">double</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">n</span>
</pre></div>
</div>
<p>The corresponding test function could, in principle, have been written
as</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_double</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Test that double(n) works for one specific n.&quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mi">4</span>
    <span class="n">computed</span> <span class="o">=</span> <span class="n">double</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">expected</span> <span class="o">!=</span> <span class="n">computed</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span>
</pre></div>
</div>
<p>The last two lines, however, are never written like this in test functions.
Instead, Python&#8217;s <code class="docutils literal"><span class="pre">assert</span></code> statement is used: <code class="docutils literal"><span class="pre">assert</span> <span class="pre">success,</span> <span class="pre">msg</span></code>, where
<code class="docutils literal"><span class="pre">success</span></code> is a boolean variable, which is <code class="docutils literal"><span class="pre">False</span></code> if the test fails, and
<code class="docutils literal"><span class="pre">msg</span></code> is <em>an optional</em> message string that is printed when the test fails.
A better version of the test function is therefore</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_double</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Test that double(n) works for one specific n.&quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mi">4</span>
    <span class="n">computed</span> <span class="o">=</span> <span class="n">double</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;expected </span><span class="si">%g</span><span class="s">, computed </span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">computed</span><span class="p">)</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">computed</span>
    <span class="k">assert</span> <span class="n">success</span><span class="p">,</span> <span class="n">msg</span>
</pre></div>
</div>
</div>
<div class="section" id="comparison-of-real-numbers">
<h4>Comparison of real numbers<a class="headerlink" href="#comparison-of-real-numbers" title="Permalink to this headline">¶</a></h4>
<p>Because of the finite precision arithmetics on a computer, which gives
rise to round-off errors, the <code class="docutils literal"><span class="pre">==</span></code> operator is not suitable for
checking whether two real numbers are equal. Obviously, this principle
also applies to tests in test functions.
We must therefore replace <code class="docutils literal"><span class="pre">a</span> <span class="pre">==</span> <span class="pre">b</span></code> by a comparison
based on a tolerance <code class="docutils literal"><span class="pre">tol</span></code>: <code class="docutils literal"><span class="pre">abs(a-b)</span> <span class="pre">&lt;</span> <span class="pre">tol</span></code>. The next example illustrates
the problem and its solution.</p>
<p>Here is a slightly different function that
we want to test:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">third</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">/</span><span class="mf">3.</span>
</pre></div>
</div>
<p>We write a test function where the expected result is computed as
<span class="math">\(\frac{1}{3}x\)</span> rather than <span class="math">\(x/3\)</span>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_third</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Check that third(x) works for many x values.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">):</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span><span class="o">*</span><span class="n">x</span>
        <span class="n">computed</span> <span class="o">=</span> <span class="n">third</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">success</span> <span class="o">=</span> <span class="n">expected</span> <span class="o">==</span> <span class="n">computed</span>
        <span class="k">assert</span> <span class="n">success</span>
</pre></div>
</div>
<p>This <code class="docutils literal"><span class="pre">test_third</span></code> function executes silently, i.e., no failure,
until <code class="docutils literal"><span class="pre">x</span></code> becomes 0.15. Then round-off errors make the <code class="docutils literal"><span class="pre">==</span></code> comparison
<code class="docutils literal"><span class="pre">False</span></code>. In fact, seven of the <code class="docutils literal"><span class="pre">x</span></code> values above face this problem.
The solution is to compare <code class="docutils literal"><span class="pre">expected</span></code> and <code class="docutils literal"><span class="pre">computed</span></code>
with a small tolerance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_third</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Check that third(x) works for many x values.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">):</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span><span class="o">*</span><span class="n">x</span>
        <span class="n">computed</span> <span class="o">=</span> <span class="n">third</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="mf">1E-15</span>
        <span class="n">success</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">expected</span> <span class="o">-</span> <span class="n">computed</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span>
        <span class="k">assert</span> <span class="n">success</span>
</pre></div>
</div>
<div class="admonition-always-compare-real-numbers-with-a-tolerance admonition">
<p class="first admonition-title">Always compare real numbers with a tolerance</p>
<p>Real numbers should never be compared with the <code class="docutils literal"><span class="pre">==</span></code> operator, but always
with the absolute value of the difference and a tolerance.
So, replace <code class="docutils literal"><span class="pre">a</span> <span class="pre">==</span> <span class="pre">b</span></code>, if <code class="docutils literal"><span class="pre">a</span></code> and/or <code class="docutils literal"><span class="pre">b</span></code> is <code class="docutils literal"><span class="pre">float</span></code>, by</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">tol</span> <span class="o">=</span> <span class="mf">1E-14</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span>
</pre></div>
</div>
<p class="last">The suitable size of <code class="docutils literal"><span class="pre">tol</span></code> depends on the size of <code class="docutils literal"><span class="pre">a</span></code> and <code class="docutils literal"><span class="pre">b</span></code>
(see <a class="reference internal" href="#softeng1-exer-tol"><span class="std std-ref">Problem 43: Experiment with tolerances in comparisons</span></a>).</p>
</div>
</div>
<div class="section" id="special-assert-functions-from-nose">
<h4>Special assert functions from nose<a class="headerlink" href="#special-assert-functions-from-nose" title="Permalink to this headline">¶</a></h4>
<p>Test frameworks often contain more tailored
<em>assert functions</em> that can be called instead of using the <code class="docutils literal"><span class="pre">assert</span></code>
statement. For example, comparing two objects within
a tolerance, as in the present
case, can be done by the <code class="docutils literal"><span class="pre">assert_almost_equal</span></code> from the nose
framework:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">nose.tools</span> <span class="kn">as</span> <span class="nn">nt</span>

<span class="k">def</span> <span class="nf">test_third</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mf">0.15</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span><span class="o">*</span><span class="n">x</span>
    <span class="n">computed</span> <span class="o">=</span> <span class="n">third</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">nt</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span>
        <span class="n">expected</span><span class="p">,</span> <span class="n">computed</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">1E-15</span><span class="p">,</span>
        <span class="n">msg</span><span class="o">=</span><span class="s">&#39;diff=</span><span class="si">%.17E</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">expected</span> <span class="o">-</span> <span class="n">computed</span><span class="p">))</span>
</pre></div>
</div>
<p>Whether to use the plain <code class="docutils literal"><span class="pre">assert</span></code> statement with a comparison based on
a tolerance or to use the ready-made function <code class="docutils literal"><span class="pre">assert_almost_equal</span></code>
depends on the programmer&#8217;s preference. The examples used in the
documentation of the pytest framework stick to the plain <code class="docutils literal"><span class="pre">assert</span></code>
statement.</p>
</div>
<div class="section" id="locating-test-functions">
<h4>Locating test functions<a class="headerlink" href="#locating-test-functions" title="Permalink to this headline">¶</a></h4>
<p>Test functions can reside in a module together with the functions they
are supposed to verify, or the test functions can be collected in
separate files having names starting with <code class="docutils literal"><span class="pre">test</span></code>. Actually,
nose and pytest can recursively run all test functions
in all <code class="docutils literal"><span class="pre">test*.py</span></code>
files in the current directory, as well as in all subdirectories!</p>
<p>The <a class="reference external" href="http://tinyurl.com/ofkw6kc/softeng/decay.py">decay.py</a> module file features
test functions in the module, but we could equally well have made
a subdirectory <code class="docutils literal"><span class="pre">tests</span></code> and put the test functions in
<a class="reference external" href="http://tinyurl.com/ofkw6kc/softeng/tests/test_decay.py">tests/test_decay.py</a>.</p>
</div>
<div class="section" id="running-tests">
<h4>Running tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h4>
<p>To run all test functions in the file <code class="docutils literal"><span class="pre">decay.py</span></code> do</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; nosetests -s -v decay.py
Terminal&gt; py.test -s -v decay.py
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">-s</span></code> option ensures that output from the test functions is printed
in the terminal window, while <code class="docutils literal"><span class="pre">-v</span></code> prints the outcome of each individual
test function.</p>
<p>Alternatively, if the test functions are located in some separate
<code class="docutils literal"><span class="pre">test*.py</span></code> files,
we can just write</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; py.test -s -v
</pre></div>
</div>
<p>to <em>recursively</em> run <em>all</em> test functions in the current
directory tree. The corresponding</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; nosetests -s -v
</pre></div>
</div>
<p>command does the same, but requires subdirectory names to start
with <code class="docutils literal"><span class="pre">test</span></code> or end with <code class="docutils literal"><span class="pre">_test</span></code> or <code class="docutils literal"><span class="pre">_tests</span></code> (which is a good habit anyway).
An example of a <code class="docutils literal"><span class="pre">tests</span></code> directory with a <code class="docutils literal"><span class="pre">test*.py</span></code>
file is found in <a class="reference external" href="http://tinyurl.com/ofkw6kc/softeng/tests">src/softeng/tests</a>.</p>
</div>
<div class="section" id="embedding-doctests-in-a-test-function">
<span id="index-19"></span><h4>Embedding doctests in a test function<a class="headerlink" href="#embedding-doctests-in-a-test-function" title="Permalink to this headline">¶</a></h4>
<p>Doctests can also be executed from nose/pytest unit tests. Here is an
example of a file <a class="reference external" href="http://tinyurl.com/ofkw6kc/softeng/tests/test_decay_doctest.py">test_decay_doctest.py</a> where we in the test
block run all the doctests in the imported module <code class="docutils literal"><span class="pre">decay</span></code>, but we also
include a local test function that does the same:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">decay</span>
<span class="kn">import</span> <span class="nn">doctest</span>

<span class="k">def</span> <span class="nf">test_decay_module_with_doctest</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Doctest embedded in a nose/pytest unit test.&quot;&quot;&quot;</span>
    <span class="c"># Test all functions with doctest in module decay</span>
    <span class="n">failure_count</span><span class="p">,</span> <span class="n">test_count</span> <span class="o">=</span> <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">decay</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">failure_count</span> <span class="o">==</span> <span class="mi">0</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c"># Run all functions with doctests in this module</span>
    <span class="n">failure_count</span><span class="p">,</span> <span class="n">test_count</span> <span class="o">=</span> <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">decay</span><span class="p">)</span>
</pre></div>
</div>
<p>Running this file as a program from the command line
triggers the <code class="docutils literal"><span class="pre">doctest.testmod</span></code> call
in the test block, while applying <code class="docutils literal"><span class="pre">py.test</span></code> or <code class="docutils literal"><span class="pre">nosetests</span></code> to the file triggers
an import of the file and execution of the test function
<code class="docutils literal"><span class="pre">test_decay_modue_with_doctest</span></code>.</p>
</div>
<div class="section" id="installing-nose-and-pytest">
<h4>Installing nose and pytest<a class="headerlink" href="#installing-nose-and-pytest" title="Permalink to this headline">¶</a></h4>
<p>With <code class="docutils literal"><span class="pre">pip</span></code> available, it is trivial to install nose and/or pytest:
<code class="docutils literal"><span class="pre">sudo</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">nose</span></code> and <code class="docutils literal"><span class="pre">sudo</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pytest</span></code>.</p>
</div>
</div>
<div class="section" id="test-function-for-the-solver">
<h3>Test function for the solver<a class="headerlink" href="#test-function-for-the-solver" title="Permalink to this headline">¶</a></h3>
<p>Finding good test problems for verifying the implementation of numerical
methods is a topic on its own. The challenge is that we very seldom know
what the numerical errors are. For the present model problem
<a href="#equation-softeng1:ode">(1)</a>-<a href="#equation-softeng1:u0">(2)</a> solved by
<a href="#equation-softeng1:utheta">(3)</a> one can, fortunately, derive a formula for
the numerical approximation:</p>
<div class="math">
\[u^n = I\left(
\frac{1 - (1-\theta) a\Delta t}{1 + \theta a \Delta t}
\right)^n{\thinspace .}\]</div>
<p>Then we know that the implementation should
produce numbers that agree with this formula to machine precision.
The formula for <span class="math">\(u^n\)</span> is known as an <em>exact discrete solution</em> of the
problem and can be coded as</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">u_discrete_exact</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return exact discrete solution of the numerical schemes.&quot;&quot;&quot;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>  <span class="c"># avoid integer division</span>
    <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">theta</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">A</span><span class="o">**</span><span class="n">n</span>
</pre></div>
</div>
<p>A test function can evaluate this solution on a time mesh
and check that the <code class="docutils literal"><span class="pre">u</span></code> values produced by the <code class="docutils literal"><span class="pre">solver</span></code> function
do not deviate with more than a small tolerance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_u_discrete_exact</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Check that solver reproduces the exact discr. sol.&quot;&quot;&quot;</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">I</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.8</span>
    <span class="n">Nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">8</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>  <span class="c"># no of steps</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">Nt</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">)</span>

    <span class="c"># Evaluate exact discrete solution on the mesh</span>
    <span class="n">u_de</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">u_discrete_exact</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>

    <span class="c"># Find largest deviation</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u_de</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="mf">1E-14</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="n">tol</span>
    <span class="k">assert</span> <span class="n">success</span>
</pre></div>
</div>
<p>Among important things to consider when constructing test functions
is testing the effect of wrong input to the function being tested.
In our <code class="docutils literal"><span class="pre">solver</span></code> function, for example, integer values of <span class="math">\(a\)</span>, <span class="math">\(\Delta t\)</span>, and
<span class="math">\(\theta\)</span> may cause unintended integer
division. We should therefore add a test to make sure our <code class="docutils literal"><span class="pre">solver</span></code>
function does not fall into this potential trap:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_potential_integer_division</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Choose variables that can trigger integer division.&quot;&quot;&quot;</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">I</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">dt</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">Nt</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">Nt</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">u_de</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">u_discrete_exact</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u_de</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="mf">1E-14</span>
</pre></div>
</div>
<p>In more complicated problems where there is no exact solution of the
numerical problem solved by the software, one must use the method
of manufactured solutions, compute convergence rates for a series
of <span class="math">\(\Delta t\)</span> values, and check that the rates converges to the
expected ones (from theory).
This type of testing is fully explained in
the section <a class="reference internal" href="._book006.html#decay-convergence-rate"><span class="std std-ref">Computing convergence rates</span></a>.</p>
</div>
<div class="section" id="test-function-for-reading-positional-command-line-arguments">
<h3>Test function for reading positional command-line arguments<a class="headerlink" href="#test-function-for-reading-positional-command-line-arguments" title="Permalink to this headline">¶</a></h3>
<p>The function <code class="docutils literal"><span class="pre">read_command_line_positional</span></code> extracts numbers from the
command line. To test it, we must decide on a set of values for
the input data, fill <code class="docutils literal"><span class="pre">sys.argv</span></code>
accordingly, and check that we get the expected values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_read_command_line_positional</span><span class="p">():</span>
    <span class="c"># Decide on a data set of input parameters</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mf">1.6</span><span class="p">;</span>  <span class="n">a</span> <span class="o">=</span> <span class="mf">1.8</span><span class="p">;</span>  <span class="n">T</span> <span class="o">=</span> <span class="mf">2.2</span><span class="p">;</span>  <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">dt_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">]</span>
    <span class="c"># Expected return from read_command_line_positional</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt_values</span><span class="p">]</span>
    <span class="c"># Construct corresponding sys.argv array</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">I</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="s">&#39;CN&#39;</span><span class="p">]</span> <span class="o">+</span> \
               <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dt_values</span><span class="p">]</span>
    <span class="n">computed</span> <span class="o">=</span> <span class="n">read_command_line_positional</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">expected_arg</span><span class="p">,</span> <span class="n">computed_arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">computed</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">expected_arg</span> <span class="o">==</span> <span class="n">computed_arg</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal"><span class="pre">sys.argv[0]</span></code> is always the program name and that we have to
copy that string from the original <code class="docutils literal"><span class="pre">sys.argv</span></code> array to the new one we
construct in the test function. (Actually, this test function destroys
the original <code class="docutils literal"><span class="pre">sys.argv</span></code> that Python fetched from the command line.)</p>
<p>Any numerical code writer should always be skeptical to the use of the exact
equality operator <code class="docutils literal"><span class="pre">==</span></code> in test functions, since round-off errors often
come into play. Here, however, we set some real values, convert them
to strings and convert back again to real numbers (of the same precision).
This string-number conversion does not involve any finite precision
arithmetics effects so we
can safely use <code class="docutils literal"><span class="pre">==</span></code> in tests. Note also that the last element in
<code class="docutils literal"><span class="pre">expected</span></code> and <code class="docutils literal"><span class="pre">computed</span></code> is the list <code class="docutils literal"><span class="pre">dt_values</span></code>, and <code class="docutils literal"><span class="pre">==</span></code> works
for comparing two lists as well.</p>
</div>
<div class="section" id="test-function-for-reading-option-value-pairs">
<h3>Test function for reading option-value pairs<a class="headerlink" href="#test-function-for-reading-option-value-pairs" title="Permalink to this headline">¶</a></h3>
<p>The function <code class="docutils literal"><span class="pre">read_command_line_argparse</span></code> can be verified with a
test function that has the same setup as <code class="docutils literal"><span class="pre">test_read_command_line_positional</span></code>
above.
However, the construction of the command line is a bit more complicated.
We find it convenient to construct the line as a string and then
split the line into words to get the desired list <code class="docutils literal"><span class="pre">sys.argv</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_read_command_line_argparse</span><span class="p">():</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mf">1.6</span><span class="p">;</span>  <span class="n">a</span> <span class="o">=</span> <span class="mf">1.8</span><span class="p">;</span>  <span class="n">T</span> <span class="o">=</span> <span class="mf">2.2</span><span class="p">;</span>  <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">dt_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">]</span>
    <span class="c"># Expected return from read_command_line_argparse</span>
    <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt_values</span><span class="p">]</span>
    <span class="c"># Construct corresponding sys.argv array</span>
    <span class="n">command_line</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> --a </span><span class="si">%s</span><span class="s"> --I </span><span class="si">%s</span><span class="s"> --T </span><span class="si">%s</span><span class="s"> --scheme CN --dt &#39;</span> <span class="o">%</span> \
                   <span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    <span class="n">command_line</span> <span class="o">+=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dt_values</span><span class="p">])</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="n">command_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">computed</span> <span class="o">=</span> <span class="n">read_command_line_argparse</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">expected_arg</span><span class="p">,</span> <span class="n">computed_arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">computed</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">expected_arg</span> <span class="o">==</span> <span class="n">computed_arg</span>
</pre></div>
</div>
<p>Recall that the Python function <code class="docutils literal"><span class="pre">zip</span></code> enables iteration over
several lists, tuples, or arrays at the same time.</p>
<div class="admonition-let-silent-test-functions-speak-up-during-development admonition">
<p class="first admonition-title">Let silent test functions speak up during development</p>
<p>When you develop test functions in a module, it is common to use IPython
for interactive experimentation:</p>
<div class="highlight-ipy"><div class="highlight"><pre><span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">decay</span>

<span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">decay</span><span class="o">.</span><span class="n">test_read_command_line_argparse</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that a working test function is completely silent! Many
find it psychologically annoying to convince themselves that a
completely silent function is doing the right things. It can therefore,
during development of a test function, be convenient to insert
print statements in the function to monitor that the function body
is indeed executed. For example, one can print the expected and
computed values in the terminal window:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_read_command_line_argparse</span><span class="p">():</span>
    <span class="o">...</span>
    <span class="k">for</span> <span class="n">expected_arg</span><span class="p">,</span> <span class="n">computed_arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">computed</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">expected_arg</span><span class="p">,</span> <span class="n">computed_arg</span>
        <span class="k">assert</span> <span class="n">expected_arg</span> <span class="o">==</span> <span class="n">computed_arg</span>
</pre></div>
</div>
<p>After performing this edit, we want to run the test again, but
in IPython the module must first be reloaded (reimported):</p>
<div class="highlight-ipy"><div class="highlight"><pre><span class="n">In</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">reload</span><span class="p">(</span><span class="n">decay</span><span class="p">)</span>  <span class="c"># force new import</span>

<span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">decay</span><span class="o">.</span><span class="n">test_read_command_line_argparse</span><span class="p">()</span>
<span class="mf">1.6</span> <span class="mf">1.6</span>
<span class="mf">1.8</span> <span class="mf">1.8</span>
<span class="mf">2.2</span> <span class="mf">2.2</span>
<span class="mf">0.5</span> <span class="mf">0.5</span>
<span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">]</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">]</span>
</pre></div>
</div>
<p class="last">Now we clearly see the objects that are compared.</p>
</div>
</div>
<div class="section" id="classical-class-based-unit-testing">
<span id="softeng1-basic-unittest"></span><h3>Classical class-based unit testing<a class="headerlink" href="#classical-class-based-unit-testing" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-20"></span><span class="target" id="index-21"></span><p id="index-22">The test functions written for the nose and pytest frameworks are
very straightforward and to the point, with no framework-required boilerplate
code. We just write the statements we need to get the computations and
comparisons done, before applying the required <code class="docutils literal"><span class="pre">assert</span></code>.</p>
<p>The classical way of implementing unit tests (which derives from the
JUnit object-oriented tool in Java) leads to much more comprehensive
implementations with a lot of boilerplate code.  Python comes with a
built-in module <code class="docutils literal"><span class="pre">unittest</span></code> for doing this type of classical unit
tests. Although nose or pytest are much more convenient to use than
<code class="docutils literal"><span class="pre">unittest</span></code>, class-based unit testing in the style of <code class="docutils literal"><span class="pre">unittest</span></code> has a
very strong position in computer science and is so widespread in
the software industry that
even computational scientists should have an idea how such unit test
code is written. A short demo of <code class="docutils literal"><span class="pre">unittest</span></code> is therefore included
next. (Readers who are not familiar with object-oriented programming
in Python may find the text hard to understand, but one can safely
jump to the next section.)</p>
<span class="target" id="index-23"></span><p id="index-24">Suppose we have a function <code class="docutils literal"><span class="pre">double(x)</span></code> in a module file <code class="docutils literal"><span class="pre">mymod.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">double</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>
</pre></div>
</div>
<p>Unit testing with the aid of the <code class="docutils literal"><span class="pre">unittest</span></code> module
consists of writing a file <code class="docutils literal"><span class="pre">test_mymod.py</span></code> for testing the functions
in <code class="docutils literal"><span class="pre">mymod.py</span></code>. The individual tests must be methods with names
starting with <code class="docutils literal"><span class="pre">test_</span></code> in a class derived from class <code class="docutils literal"><span class="pre">TestCase</span></code> in
<code class="docutils literal"><span class="pre">unittest</span></code>. With one test method for the function <code class="docutils literal"><span class="pre">double</span></code>, the
<code class="docutils literal"><span class="pre">test_mymod.py</span></code> file becomes</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">mymod</span>

<span class="k">class</span> <span class="nc">TestMyCode</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_double</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>
        <span class="n">computed</span> <span class="o">=</span> <span class="n">mymod</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">computed</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>The test is run by executing the test file <code class="docutils literal"><span class="pre">test_mymod.py</span></code> as a standard
Python program. There is no support in <code class="docutils literal"><span class="pre">unittest</span></code> for automatically
locating and running all tests in all test files in a directory tree.</p>
<p>We could use the basic <code class="docutils literal"><span class="pre">assert</span></code> statement as we did with nose and pytest
functions, but those who write code based on <code class="docutils literal"><span class="pre">unittest</span></code> almost
exclusively use the wide range of built-in assert functions such
as <code class="docutils literal"><span class="pre">assertEqual</span></code>, <code class="docutils literal"><span class="pre">assertNotEqual</span></code>, <code class="docutils literal"><span class="pre">assertAlmostEqual</span></code>, to mention
some of them.</p>
<p>Translation of the test functions from the previous sections
to <code class="docutils literal"><span class="pre">unittest</span></code> means making a new file <code class="docutils literal"><span class="pre">test_decay.py</span></code> file with a
test class <code class="docutils literal"><span class="pre">TestDecay</span></code> where the stand-alone functions for
nose/pytest now become methods in this class.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">decay</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">u_discrete_exact</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">class</span> <span class="nc">TestDecay</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_exact_discrete_solution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">;</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">I</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.8</span>
        <span class="n">Nt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">8</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span>  <span class="c"># no of steps</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">decay</span><span class="o">.</span><span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">Nt</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="n">theta</span><span class="p">)</span>
        <span class="c"># Evaluate exact discrete solution on the mesh</span>
        <span class="n">u_de</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">u_discrete_exact</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nt</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">u_de</span> <span class="o">-</span> <span class="n">u</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>  <span class="c"># largest deviation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">1E-14</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_potential_integer_division</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">1E-14</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_read_command_line_positional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="k">for</span> <span class="n">expected_arg</span><span class="p">,</span> <span class="n">computed_arg</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">computed</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_arg</span><span class="p">,</span> <span class="n">computed_arg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_read_command_line_argparse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="o">...</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="sharing-the-software-with-other-users">
<span id="softeng1-prog-se-git"></span><h2>Sharing the software with other users<a class="headerlink" href="#sharing-the-software-with-other-users" title="Permalink to this headline">¶</a></h2>
<p>As soon as you have some working software that you intend to share
with others, you should package your software in a standard way such
that users can easily download your software, install it, improve it,
and ask you to approve their improvements in new versions of the software.
During recent years, the software development community has established
quite firm tools and rules for how all this is done. The following
subsections cover three steps in sharing software:</p>
<ol class="arabic simple">
<li>Organizing the software for public distribution.</li>
<li>Uploading the software to a cloud service (here GitHub).</li>
<li>Downloading and installing the software.</li>
</ol>
<div class="section" id="organizing-the-software-directory-tree">
<h3>Organizing the software directory tree<a class="headerlink" href="#organizing-the-software-directory-tree" title="Permalink to this headline">¶</a></h3>
<p>We start with organizing our software as a directory tree. Our
software consists of one module file, <code class="docutils literal"><span class="pre">decay.py</span></code>, and possibly some
unit tests in a separate file located in a directory <code class="docutils literal"><span class="pre">tests</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">decay.py</span></code> can be used as a module or as a program. For distribution
to other users who install the program <code class="docutils literal"><span class="pre">decay.py</span></code> in system directories,
we need to insert the following line at the top of the file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
</pre></div>
</div>
<p>This line makes it possible to write just the filename and get the
file executed by the <code class="docutils literal"><span class="pre">python</span></code> program (or more precisely, the first
<code class="docutils literal"><span class="pre">python</span></code> program found in the directories in the <code class="docutils literal"><span class="pre">PATH</span></code> environment
variable).</p>
<div class="section" id="distributing-just-a-module-file">
<h4>Distributing just a module file<a class="headerlink" href="#distributing-just-a-module-file" title="Permalink to this headline">¶</a></h4>
<p>Let us start out with the minimum solution alternative: distributing
just the <code class="docutils literal"><span class="pre">decay.py</span></code> file. Then the software is just one file and all
we need is a directory with this file.  Users will also this directory
to contain an installation script <code class="docutils literal"><span class="pre">setup.py</span></code> and a <code class="docutils literal"><span class="pre">README</span></code> file
telling what the software is about, the author&#8217;s email address, a URL
for downloading the software, and other useful information.</p>
<p id="index-25">The <code class="docutils literal"><span class="pre">setup.py</span></code> file can be as short as</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">distutils.core</span> <span class="kn">import</span> <span class="n">setup</span>
<span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;decay&#39;</span><span class="p">,</span>
      <span class="n">version</span><span class="o">=</span><span class="s">&#39;0.1&#39;</span><span class="p">,</span>
      <span class="n">py_modules</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;decay&#39;</span><span class="p">],</span>
      <span class="n">scripts</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;decay.py&#39;</span><span class="p">],</span>
      <span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">py_modules</span></code> argument specifies a list of modules to be installed, while
<code class="docutils literal"><span class="pre">scripts</span></code> specifies stand-alone programs. Our <code class="docutils literal"><span class="pre">decay.py</span></code> can be used
either as a module or as an executable program, so we want users to
have both possibilities.</p>
</div>
<div class="section" id="distributing-a-package">
<h4>Distributing a package<a class="headerlink" href="#distributing-a-package" title="Permalink to this headline">¶</a></h4>
<p>If the software consists of more files than one or two modules, one
should make a Python <em>package</em> out of it. In our case we make a
package <code class="docutils literal"><span class="pre">decay</span></code> containing one module, also called <code class="docutils literal"><span class="pre">decay</span></code>.</p>
<p>To make a package <code class="docutils literal"><span class="pre">decay</span></code>, create a directory <code class="docutils literal"><span class="pre">decay</span></code> and an empty
file in it with name <code class="docutils literal"><span class="pre">__init__.py</span></code>.
A <code class="docutils literal"><span class="pre">setup.py</span></code> script must now specify the directory name of the package
and also an executable program (<code class="docutils literal"><span class="pre">scripts=</span></code>)
in case we want to run <code class="docutils literal"><span class="pre">decay.py</span></code> as a stand-alone application:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">distutils.core</span> <span class="kn">import</span> <span class="n">setup</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;decay&#39;</span><span class="p">,</span>
      <span class="n">version</span><span class="o">=</span><span class="s">&#39;0.1&#39;</span><span class="p">,</span>
      <span class="n">author</span><span class="o">=</span><span class="s">&#39;Hans Petter Langtangen&#39;</span><span class="p">,</span>
      <span class="n">author_email</span><span class="o">=</span><span class="s">&#39;hpl@simula.no&#39;</span><span class="p">,</span>
      <span class="n">url</span><span class="o">=</span><span class="s">&#39;https://github.com/hplgit/decay-package/&#39;</span><span class="p">,</span>
      <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;decay&#39;</span><span class="p">],</span>
      <span class="n">scripts</span><span class="o">=</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;decay&#39;</span><span class="p">,</span> <span class="s">&#39;decay.py&#39;</span><span class="p">)]</span>
     <span class="p">)</span>
</pre></div>
</div>
<p>We have also added some author and download information.
The reader is referred to the <a class="reference external" href="https://docs.python.org/2/distutils/setupscript.html">Distutils documentation</a> for more information on how to
write <code class="docutils literal"><span class="pre">setup.py</span></code> scripts.</p>
<div class="admonition-remark-about-the-executable-file admonition" id="index-26">
<p class="first admonition-title">Remark about the executable file</p>
<p>The executable program, <code class="docutils literal"><span class="pre">decay.py</span></code>, is above taken to be the complete
module file <code class="docutils literal"><span class="pre">decay.py</span></code>. It would normally be preferred to instead
write a very short script essentially importing <code class="docutils literal"><span class="pre">decay</span></code> and running
the test block in <code class="docutils literal"><span class="pre">decay.py</span></code>.  In this way, we distribute a module and
a very short file, say <code class="docutils literal"><span class="pre">decay-main.py</span></code>, as an executable program:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">decay</span>
<span class="n">decay</span><span class="o">.</span><span class="n">decay</span><span class="o">.</span><span class="n">experiment_compare_dt</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">decay</span><span class="o">.</span><span class="n">decay</span><span class="o">.</span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>In this package example, we move the unit tests out of the <code class="docutils literal"><span class="pre">decay.py</span></code>
module to a separate file, <code class="docutils literal"><span class="pre">test_decay.py</span></code>, and place this file in a
directory <code class="docutils literal"><span class="pre">tests</span></code>. Then the <code class="docutils literal"><span class="pre">nosetests</span></code> and <code class="docutils literal"><span class="pre">py.test</span></code> programs will
automatically find and execute the tests.</p>
<p>The complete directory structure reads</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; /bin/ls -R
.:
decay  README  setup.py

./decay:
decay.py  __init__.py  tests

./decay/tests:
test_decay.py
</pre></div>
</div>
</div>
</div>
<div class="section" id="publishing-the-software-at-github">
<h3>Publishing the software at GitHub<a class="headerlink" href="#publishing-the-software-at-github" title="Permalink to this headline">¶</a></h3>
<p id="index-27">The leading site today for publishing open source software projects is
GitHub at <a class="reference external" href="http://github.com">http://github.com</a>, provided you want your software to
be open to the world. With a paid GitHub account, you can have private
projects too.</p>
<p>Sign up for a GitHub account if you do not already have one.
Go to your account settings and provide an SSH key (typically
the file <code class="docutils literal"><span class="pre">~/.ssh/id_rsa.pub</span></code>) such that
you can communicate with GitHub without being prompted for your password.
All communication between your computer and GitHub goes via the version
control system Git. This may at first sight look tedious, but
this is the way professionals work with software today. With Git you
have full control of the history of your files, i.e., &#8220;who did what when&#8221;.
The technology makes Git superior to simpler alternatives
like Dropbox and Google Drive,
especially when you collaborate with others.
There is a reason why Git has gained the position it has,
and there is no reason why you should not adopt this tool.</p>
<p>To create a new project, click on <em>New repository</em> on the main page and
fill out a project name. Click on the check button <em>Initialize this
repository with a README</em>, and click on <em>Create repository</em>. The next
step is to clone (copy) the GitHub repo (short for repository) to
your own computer(s) and fill it with files. The typical clone command is</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; git clone git://github.com:username/projname.git
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">username</span></code> is your GitHub username and <code class="docutils literal"><span class="pre">projname</span></code> is the
name of the repo (project). The result of <code class="docutils literal"><span class="pre">git</span> <span class="pre">clone</span></code> is a
directory <code class="docutils literal"><span class="pre">projname</span></code>. Go to this directory and add files.
As soon as the repo directory is populated with files, run</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; git add .
Terminal&gt; git commit -am &#39;First registration of project files&#39;
Terminal&gt; git push origin master
</pre></div>
</div>
<p>The above <code class="docutils literal"><span class="pre">git</span></code> commands look cryptic, but these commands plus
2-3 more are the essence of what you need in your daily work with
files in small or big
software projects. I strongly encourage you to
learn more about <a class="reference external" href="http://hplgit.github.io/teamods/bitgit/html/">version control systems and project hosting
sites</a>
<a class="reference internal" href="._book009.html#ref11" id="id4">[Ref11]</a>.</p>
<p>Your project files are now stored in the cloud at
<a class="reference external" href="https://github.com/username/projname">https://github.com/username/projname</a>. Anyone can
get the software by the listed <code class="docutils literal"><span class="pre">git</span> <span class="pre">clone</span></code> command you used above,
or by clicking on the links for zip and tar files.</p>
<p>Every time you update the project files, you need to register
the update at GitHub by</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; git commit -am &#39;Description of the changes you made...&#39;
Terminal&gt; git push origin master
</pre></div>
</div>
<p>The files at GitHub are now synchronized with your local ones.
Similarly, every time you start working on files in this project,
make sure you have the latest version:
<code class="docutils literal"><span class="pre">git</span> <span class="pre">pull</span> <span class="pre">origin</span> <span class="pre">master</span></code>.</p>
<p>You are recommended to read <a class="reference external" href="http://hplgit.github.io/teamods/bitgit/html/">a quick intro</a> that makes you
up and going with this style of
professional work. And you should put all your writings and programming
projects in repositories in the cloud!</p>
</div>
<div class="section" id="downloading-and-installing-the-software">
<h3>Downloading and installing the software<a class="headerlink" href="#downloading-and-installing-the-software" title="Permalink to this headline">¶</a></h3>
<p>Users of your software go to the Git repo at <code class="docutils literal"><span class="pre">github.com</span></code> and
clone the repository. One can use either SSH or HTTP for communication.
Most users will use the latter, typically</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; git clone https://github.com/username/projname.git
</pre></div>
</div>
<p>The result is a directory <code class="docutils literal"><span class="pre">projname</span></code> with the files in the repo.</p>
<div class="section" id="installing-just-a-module-file">
<h4>Installing just a module file<a class="headerlink" href="#installing-just-a-module-file" title="Permalink to this headline">¶</a></h4>
<p>The software package is in the case above a directory <code class="docutils literal"><span class="pre">decay</span></code> with three files</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; ls decay
README   decay.py   setup.py
</pre></div>
</div>
<p>To install the <code class="docutils literal"><span class="pre">decay.py</span></code> file, a user
just runs <code class="docutils literal"><span class="pre">setup.py</span></code>:</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; sudo python setup.py install
</pre></div>
</div>
<p>This command will install the software in system directories, so the user
needs to run the command as <code class="docutils literal"><span class="pre">root</span></code> on Unix systems (therefore the command
starts with <code class="docutils literal"><span class="pre">sudo</span></code>).
The user can now import the module by <code class="docutils literal"><span class="pre">import</span> <span class="pre">decay</span></code> and run
the program by</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; decay.py
</pre></div>
</div>
<p>A user can easily install the software on her personal account if
a system-wide installation is not desirable. We refer to the
<a class="reference external" href="https://docs.python.org/2/install/index.html#alternate-installation">installation documentation</a> for the many arguments that can be given to <code class="docutils literal"><span class="pre">setup.py</span></code>.
Note that if the software is installed on a personal account, the
<code class="docutils literal"><span class="pre">PATH</span></code> and <code class="docutils literal"><span class="pre">PYTHONPATH</span></code> environment variables must contain the
relevant directories.</p>
<p>Our <code class="docutils literal"><span class="pre">setup.py</span></code> file specifies a module <code class="docutils literal"><span class="pre">decay</span></code> to be installed as well
as a program <code class="docutils literal"><span class="pre">decay.py</span></code>.  Modules are typically installed in some <code class="docutils literal"><span class="pre">lib</span></code>
directory on the computer system, e.g.,
<code class="docutils literal"><span class="pre">/usr/local/lib/python2.7/dist-packages</span></code>, while executable programs go
to <code class="docutils literal"><span class="pre">/usr/local/bin</span></code>.</p>
</div>
<div class="section" id="installing-a-package">
<span id="index-28"></span><h4>Installing a package<a class="headerlink" href="#installing-a-package" title="Permalink to this headline">¶</a></h4>
<p>When the software is organized as a Python package, the installation is
done by running <code class="docutils literal"><span class="pre">setup.py</span></code> exactly as explained above, but the use of a module
<code class="docutils literal"><span class="pre">decay</span></code> in a package <code class="docutils literal"><span class="pre">decay</span></code> requires the following syntax:</p>
<div class="highlight-text"><div class="highlight"><pre>import decay
u, t = decay.decay.solver(...)
</pre></div>
</div>
<p>That is, the call goes like <code class="docutils literal"><span class="pre">packagename.modulename.functionname</span></code>.</p>
<div class="admonition-package-import-in-init-py admonition">
<p class="first admonition-title">Package import in <code class="docutils literal"><span class="pre">__init__.py</span></code></p>
<p>One can ease the use of packages by providing a somewhat simpler
import like</p>
<div class="highlight-text"><div class="highlight"><pre>import decay
u, t = decay.solver(...)

# or
from decay import solver
u, t = solver(...)
</pre></div>
</div>
<p>This is accomplished by putting an import statement in the <code class="docutils literal"><span class="pre">__init__.py</span></code>
file, which is always run when doing the package import <code class="docutils literal"><span class="pre">import</span> <span class="pre">decay</span></code>
or <code class="docutils literal"><span class="pre">from</span> <span class="pre">decay</span> <span class="pre">import</span></code>. The <code class="docutils literal"><span class="pre">__init__.py</span></code> file must now contain</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">decay</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p class="last">Obviously, it is the package developer who decides on such an
<code class="docutils literal"><span class="pre">__init__.py</span></code> file or if it should just be empty.</p>
</div>
</div>
</div>
</div>
<div class="section" id="classes-for-problem-and-solution-method">
<span id="softeng1-prog-se-class"></span><h2>Classes for problem and solution method<a class="headerlink" href="#classes-for-problem-and-solution-method" title="Permalink to this headline">¶</a></h2>
<p>The numerical solution procedure was compactly and conveniently implemented in
a Python function <code class="docutils literal"><span class="pre">solver</span></code> in the section <a class="reference internal" href="#softeng1-basic-math"><span class="std std-ref">Mathematical problem and solution technique</span></a>.
In more complicated problems it might
be beneficial to use classes instead of functions only. Here we shall
describe a class-based software design well suited for scientific problems
where there is a mathematical model of some physical phenomenon and
some numerical methods to solve the equations involved in the model.</p>
<p>We introduce a class <code class="docutils literal"><span class="pre">Problem</span></code> to hold the definition of the physical
problem, and a class <code class="docutils literal"><span class="pre">Solver</span></code> to hold the data and methods needed to
numerically solve the problem.  The forthcoming text will explain the
inner workings of these classes and how they represent an alternative
to the <code class="docutils literal"><span class="pre">solver</span></code> and <code class="docutils literal"><span class="pre">experiment_*</span></code> functions in the <code class="docutils literal"><span class="pre">decay</span></code>
module.</p>
<p>Explaining the details of class programming in Python is considered
far beyond the scope of this text.  Readers who are unfamiliar with Python
class programming should first consult one of the many electronic
Python tutorials or textbooks to come up to speed with concepts and
syntax of Python classes before reading on. The author has a gentle
introduction to class programming for scientific applications
in <a class="reference internal" href="._book009.html#ref01" id="id5">[Ref01]</a>, see <a class="reference external" href="http://hplgit.github.io/primer.html/doc/web/index.html">Chapter 7 and 9 and Appendix E</a>.
Other useful resources are</p>
<blockquote>
<div><ul class="simple">
<li>The Python Tutorial: <a class="reference external" href="http://docs.python.org/2/tutorial/classes.html">http://docs.python.org/2/tutorial/classes.html</a></li>
<li>Wiki book on Python Programming: <a class="reference external" href="http://en.wikibooks.org/wiki/Python_Programming/Classes">http://en.wikibooks.org/wiki/Python_Programming/Classes</a></li>
<li><code class="docutils literal"><span class="pre">tutorialspoint.com</span></code>: <a class="reference external" href="http://www.tutorialspoint.com/python/python_classes_objects.htm">http://www.tutorialspoint.com/python/python_classes_objects.htm</a></li>
</ul>
</div></blockquote>
<div class="section" id="the-problem-class">
<h3>The problem class<a class="headerlink" href="#the-problem-class" title="Permalink to this headline">¶</a></h3>
<p id="index-29">The purpose of the problem class is to store all information about
the mathematical model. This usually means the physical parameters
and formulas
in the problem. Looking at our model problem
<a href="#equation-softeng1:ode">(1)</a>-<a href="#equation-softeng1:u0">(2)</a>, the physical data cover
<span class="math">\(I\)</span>, <span class="math">\(a\)</span>, and <span class="math">\(T\)</span>. Since we have an analytical solution of
the ODE problem, we may add this solution in terms of a Python
function (or method) to the problem class as well.
A possible problem class is therefore</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">exp</span>

<span class="k">class</span> <span class="nc">Problem</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">I</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">T</span>

    <span class="k">def</span> <span class="nf">u_exact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">I</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>We could in the <code class="docutils literal"><span class="pre">u_exact</span></code> method have written
<code class="docutils literal"><span class="pre">self.I*exp(-self.a*t)</span></code>, but using local variables <code class="docutils literal"><span class="pre">I</span></code> and <code class="docutils literal"><span class="pre">a</span></code> allows
the nicer formula <code class="docutils literal"><span class="pre">I*exp(-a*t)</span></code>, which looks much closer to the mathematical
expression <span class="math">\(Ie^{-at}\)</span>.  This is not an important issue with the
current compact formula, but is beneficial in more complicated
problems with longer formulas to obtain the closest possible
relationship between code and mathematics. The coding style in
this book is to strip
off the <code class="docutils literal"><span class="pre">self</span></code> prefix when the code expresses mathematical formulas.</p>
<p>The class data can be set either as arguments in the constructor or
at any time later, e.g.,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">problem</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">problem</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="mf">1.5</span>
</pre></div>
</div>
<p>(Some programmers prefer <code class="docutils literal"><span class="pre">set</span></code> and <code class="docutils literal"><span class="pre">get</span></code> functions for setting and getting
data in classes, often implemented via <em>properties</em> in Python, but
this author considers that overkill when there are just a few data items
in a class.)</p>
<p>It would be convenient if class <code class="docutils literal"><span class="pre">Problem</span></code> could also initialize
the data from the command line. To this end, we add a method for
defining a set of command-line options and a method that sets the
local attributes equal to what was found on the command line.
The default values associated with the command-line options are taken
as the values provided to the constructor. Class <code class="docutils literal"><span class="pre">Problem</span></code> now becomes</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Problem</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">I</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">T</span>

    <span class="k">def</span> <span class="nf">define_command_line_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return updated (parser) or new ArgumentParser object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">argparse</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s">&#39;--I&#39;</span><span class="p">,</span> <span class="s">&#39;--initial_condition&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;initial condition, u(0)&#39;</span><span class="p">,</span>
            <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;I&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s">&#39;--a&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;coefficient in ODE&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s">&#39;--T&#39;</span><span class="p">,</span> <span class="s">&#39;--stop_time&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;end time of simulation&#39;</span><span class="p">,</span>
            <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;T&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parser</span>

    <span class="k">def</span> <span class="nf">init_from_command_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load attributes from ArgumentParser into instance.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">T</span>

    <span class="k">def</span> <span class="nf">u_exact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the exact solution u(t)=I*exp(-a*t).&quot;&quot;&quot;</span>
        <span class="n">I</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
<p>Observe that if the user already has an <code class="docutils literal"><span class="pre">ArgumentParser</span></code> object it can be
supplied, but if she does not have any, class <code class="docutils literal"><span class="pre">Problem</span></code> makes one.
Python&#8217;s <code class="docutils literal"><span class="pre">None</span></code> object is used to indicate that a variable is not
initialized with a proper value.</p>
</div>
<div class="section" id="the-solver-class">
<h3>The solver class<a class="headerlink" href="#the-solver-class" title="Permalink to this headline">¶</a></h3>
<span class="target" id="index-30"></span><p id="index-31">The solver class stores parameters related to the numerical solution method
and provides a function <code class="docutils literal"><span class="pre">solve</span></code> for solving the problem.
For convenience, a problem object is given to the constructor
in a solver object such that the object gets access to the
physical data. In the present example,
the numerical solution method involves the parameters <span class="math">\(\Delta t\)</span>
and <span class="math">\(\theta\)</span>, which then constitute the data part of the solver class.
We include, as in the problem class, functionality for
reading <span class="math">\(\Delta t\)</span> and <span class="math">\(\theta\)</span> from the command line:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Solver</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">problem</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problem</span> <span class="o">=</span> <span class="n">problem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dt</span><span class="p">),</span> <span class="n">theta</span>

    <span class="k">def</span> <span class="nf">define_command_line_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return updated (parser) or new ArgumentParser object.&quot;&quot;&quot;</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s">&#39;--scheme&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;CN&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;FE, BE, or CN&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s">&#39;--dt&#39;</span><span class="p">,</span> <span class="s">&#39;--time_step_values&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;time step values&#39;</span><span class="p">,</span>
            <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;dt&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;dt_values&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parser</span>

    <span class="k">def</span> <span class="nf">init_from_command_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load attributes from ArgumentParser into instance.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">theta</span>

    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return norm of error at the mesh points.&quot;&quot;&quot;</span>
        <span class="n">u_e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">u_e</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dt</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">E</span>
</pre></div>
</div>
<p>Note that we see no need to repeat the body of the previously
developed and tested <code class="docutils literal"><span class="pre">solver</span></code> function. We just call that function from
the <code class="docutils literal"><span class="pre">solve</span></code> method.  In this way, class <code class="docutils literal"><span class="pre">Solver</span></code> is merely a class wrapper
of the stand-alone <code class="docutils literal"><span class="pre">solver</span></code> function. With a single object of class <code class="docutils literal"><span class="pre">Solver</span></code>
we have all the physical and numerical data bundled together with the numerical
solution method.</p>
<div class="section" id="combining-the-objects">
<h4>Combining the objects<a class="headerlink" href="#combining-the-objects" title="Permalink to this headline">¶</a></h4>
<p>Eventually we need to show how the classes <code class="docutils literal"><span class="pre">Problem</span></code> and <code class="docutils literal"><span class="pre">Solver</span></code>
play together. We read parameters from the command line and make a
plot with the numerical and exact solution:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">experiment_classes</span><span class="p">():</span>
    <span class="n">problem</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">()</span>
    <span class="n">solver</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>

    <span class="c"># Read input from the command line</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">define_command_line_options</span><span class="p">()</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span> <span class="n">define_command_line_options</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">init_from_command_line</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">solver</span><span class="o">.</span> <span class="n">init_from_command_line</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

    <span class="c"># Solve and plot</span>
    <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
    <span class="n">t_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>    <span class="c"># very fine mesh for u_e</span>
    <span class="n">u_e</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">u_exact</span><span class="p">(</span><span class="n">t_e</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;Error:&#39;</span><span class="p">,</span> <span class="n">solver</span><span class="o">.</span><span class="n">error</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span>   <span class="n">u</span><span class="p">,</span>   <span class="s">&#39;r--o&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_e</span><span class="p">,</span> <span class="n">u_e</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;numerical, theta=</span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;exact&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;u&#39;</span><span class="p">)</span>
    <span class="n">plotfile</span> <span class="o">=</span> <span class="s">&#39;tmp&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.png&#39;</span><span class="p">);</span>  <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plotfile</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="improving-the-problem-and-solver-classes">
<span id="softeng1-prog-se-class2"></span><h3>Improving the problem and solver classes<a class="headerlink" href="#improving-the-problem-and-solver-classes" title="Permalink to this headline">¶</a></h3>
<p>The previous <code class="docutils literal"><span class="pre">Problem</span></code> and <code class="docutils literal"><span class="pre">Solver</span></code> classes containing parameters
soon get much repetitive code when the number of parameters increases.
Much of this code can be parameterized and be made more compact.
For this purpose, we decide to collect all parameters in a dictionary,
<code class="docutils literal"><span class="pre">self.prm</span></code>, with two associated dictionaries <code class="docutils literal"><span class="pre">self.type</span></code> and
<code class="docutils literal"><span class="pre">self.help</span></code> for holding associated object types and help strings.
The reason is that processing dictionaries is easier than processing
a set of individual attributes.
For the specific ODE example we deal with, the three dictionaries in
the problem class are typically</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">prm</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="s">&#39;initial condition, u(0)&#39;</span><span class="p">,</span>
                 <span class="n">a</span><span class="o">=</span><span class="s">&#39;coefficient in ODE&#39;</span><span class="p">,</span>
                 <span class="n">T</span><span class="o">=</span><span class="s">&#39;end time of simulation&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Provided a problem or solver class defines these three
dictionaries in the constructor,
we can create a super class <code class="docutils literal"><span class="pre">Parameters</span></code> with general code
for defining command-line options and reading them as well as
methods for setting and getting each parameter. A <code class="docutils literal"><span class="pre">Problem</span></code> or <code class="docutils literal"><span class="pre">Solver</span></code> for
a particular mathematical problem can then
inherit most of the needed functionality and code
from the <code class="docutils literal"><span class="pre">Parameters</span></code> class. For example,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Problem</span><span class="p">(</span><span class="n">Parameters</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prm</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="s">&#39;initial condition, u(0)&#39;</span><span class="p">,</span>
                         <span class="n">a</span><span class="o">=</span><span class="s">&#39;coefficient in ODE&#39;</span><span class="p">,</span>
                         <span class="n">T</span><span class="o">=</span><span class="s">&#39;end time of simulation&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">u_exact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="n">I</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;I a&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
        <span class="k">return</span> <span class="n">I</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Solver</span><span class="p">(</span><span class="n">Parameters</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">problem</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">problem</span> <span class="o">=</span> <span class="n">problem</span>   <span class="c"># class Problem object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prm</span>  <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">theta</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="s">&#39;time step value&#39;</span><span class="p">,</span>
                         <span class="n">theta</span><span class="o">=</span><span class="s">&#39;time discretization parameter&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">decay</span> <span class="kn">import</span> <span class="n">solver</span>
        <span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">problem</span><span class="p">[</span><span class="s">&#39;I a T&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
        <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s">&#39;dt theta&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
</pre></div>
</div>
<p>By inheritance, these classes can automatically do a lot more when it comes to
reading and assigning parameter values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">problem</span> <span class="o">=</span> <span class="n">Problem</span><span class="p">()</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">problem</span><span class="p">)</span>

<span class="c"># Read input from the command line</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">define_command_line_options</span><span class="p">()</span>
<span class="n">parser</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span> <span class="n">define_command_line_options</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="n">problem</span><span class="o">.</span><span class="n">init_from_command_line</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span> <span class="n">init_from_command_line</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>

<span class="c"># Other syntax for setting/getting parameter values</span>
<span class="n">problem</span><span class="p">[</span><span class="s">&#39;T&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
<span class="k">print</span> <span class="s">&#39;Time step:&#39;</span><span class="p">,</span> <span class="n">solver</span><span class="p">[</span><span class="s">&#39;dt&#39;</span><span class="p">]</span>

<span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">u</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="n">solver</span><span class="o">.</span><span class="n">t</span>
</pre></div>
</div>
<div class="section" id="a-generic-class-for-parameters">
<h4>A generic class for parameters<a class="headerlink" href="#a-generic-class-for-parameters" title="Permalink to this headline">¶</a></h4>
<p>A simplified version of the parameter class looks as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Parameters</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;obj[name] syntax for getting parameters.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>         <span class="c"># get many?</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;obj[name] = value syntax for setting a parameter.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">define_command_line_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Automatic registering of options.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parser</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">argparse</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prm</span><span class="p">:</span>
            <span class="n">tp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="k">else</span> <span class="nb">str</span>
            <span class="n">help</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">help</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">help</span> <span class="k">else</span> <span class="bp">None</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
                <span class="s">&#39;--&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">metavar</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="n">tp</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parser</span>

    <span class="k">def</span> <span class="nf">init_from_command_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>The file <a class="reference external" href="http://tinyurl.com/ofkw6kc/softeng/decay_oo.py">decay_oo.py</a> contains
a slightly more advanced version of class <code class="docutils literal"><span class="pre">Parameters</span></code> where we
in the functions for getting and setting parameters
test for valid parameter names and
raise exceptions with informative messages if any name is not registered.</p>
<p>We have already sketched the <code class="docutils literal"><span class="pre">Problem</span></code> and <code class="docutils literal"><span class="pre">Solver</span></code> classes that build
on inheritance from <code class="docutils literal"><span class="pre">Parameters</span></code>. We have also shown how they are
used. The only remaining code is to make the plot, but this code is
identical to previous versions when the numerical solution is
available in an object <code class="docutils literal"><span class="pre">t</span></code> and the exact one in <code class="docutils literal"><span class="pre">u_e</span></code>.</p>
<p>The advantage with the <code class="docutils literal"><span class="pre">Parameters</span></code> class is that it scales to problems
with a large number of physical and numerical parameters:
as long as the parameters are defined once via a dictionary,
the compact code in class <code class="docutils literal"><span class="pre">Parameters</span></code> can handle any collection of
parameters of any size.</p>
</div>
</div>
</div>
<div class="section" id="automating-scientific-experiments">
<span id="softeng1-experiments"></span><h2>Automating scientific experiments<a class="headerlink" href="#automating-scientific-experiments" title="Permalink to this headline">¶</a></h2>
<p>Empirical scientific investigations based on running computer programs
require careful design of the experiments and accurate reporting of results.
Although there is a strong tradition to do such investigations manually,
the extreme requirements to scientific accuracy make a program much
better suited to conduct the experiments. We shall in this section outline
how we can write such programs, often called <em>scripts</em>, for running other
programs and archiving the results.</p>
<div class="admonition-scientific-investigation admonition">
<p class="first admonition-title">Scientific investigation</p>
<p class="last">The purpose of the investigations is to explore the quality of numerical
solutions to an ordinary differential equation. More specifically, we
solve the initial-value problem</p>
</div>
<div class="math" id="equation-softeng1:experiments:model">
<span id="eq-softeng1-experiments-model"></span><span class="eqno">(4)</span>\[        u^\prime(t) = -au(t),\quad u(0)=I,\quad t\in (0,T],\]\[by the  \( \theta \) -rule:\]\[.. _Eq:softeng1:experiments:theta:\]</div>
<div class="math" id="equation-softeng1:experiments:theta">
<span class="eqno">(5)</span>\[        u^{n+1} = \frac{1 - (1-\theta) a\Delta t}{1 + \theta a\Delta t}u^n,
        \quad u^0=I{\thinspace .}\]\[This scheme corresponds to well-known methods:  \( \theta=0 \)  gives the
Forward Euler (FE) scheme,  \( \theta=1 \)  gives the Backward Euler (BE) scheme,
and  \( \theta=\frac{1}{2} \)  gives the Crank-Nicolson
(CN) or midpoint/centered scheme.\]\[For chosen constants  \( I \) ,  \( a \) , and  \( T \) , we run the three schemes for various
values of  \( \Delta t \) , and present the following results in a report:\]\[1. visual comparison of the numerical and exact solution in a plot for
   each  \( \Delta t \)  and  \( \theta=0,1,\frac{1}{2} \) ,\]\[2. a table and a plot of the norm of the numerical error versus  \( \Delta t \) 
   for  \( \theta=0,1,\frac{1}{2} \) .\]\[The report will also document the mathematical details of the problem under
investigation.\]</div>
<div class="section" id="available-software">
<h3>Available software<a class="headerlink" href="#available-software" title="Permalink to this headline">¶</a></h3>
<p>Appropriate software for implementing <a href="#equation-softeng1:experiments:theta">(5)</a>
is available in a program <a class="reference external" href="http://tinyurl.com/nc4upel/doconce_src/model.py">model.py</a>, which is run as</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python model.py --I 1.5 --a 0.25 --T 6 --dt 1.25 0.75 0.5
</pre></div>
</div>
<p>The command-line input corresponds to setting <span class="math">\(I=1.5\)</span>, <span class="math">\(a=0.25\)</span>, <span class="math">\(T=6\)</span>,
and run three values of <span class="math">\(\Delta t\)</span>: 1.25, 0.75, ad 0.5.</p>
<p>The results of running this <code class="docutils literal"><span class="pre">model.py</span></code> command are text in the
terminal window and a set of plot files.
The plot files have names <code class="docutils literal"><span class="pre">M_D.E</span></code>, where <code class="docutils literal"><span class="pre">M</span></code> denotes the method
(<code class="docutils literal"><span class="pre">FE</span></code>, <code class="docutils literal"><span class="pre">BE</span></code>, <code class="docutils literal"><span class="pre">CN</span></code> for <span class="math">\(\theta=0,1,\frac{1}{2}\)</span>, respectively), <code class="docutils literal"><span class="pre">D</span></code>
the time step length (here <code class="docutils literal"><span class="pre">1.25</span></code>, <code class="docutils literal"><span class="pre">0.75</span></code>, or <code class="docutils literal"><span class="pre">0.5</span></code>), and <code class="docutils literal"><span class="pre">E</span></code>
is the plot file extension <code class="docutils literal"><span class="pre">png</span></code> or <code class="docutils literal"><span class="pre">pdf</span></code>.
The text output in the terminal window looks like</p>
<div class="highlight-text"><div class="highlight"><pre>0.0   1.25:    5.998E-01
0.0   0.75:    1.926E-01
0.0   0.50:    1.123E-01
0.0   0.10:    1.558E-02
0.5   1.25:    6.231E-02
0.5   0.75:    1.543E-02
0.5   0.50:    7.237E-03
0.5   0.10:    2.469E-04
1.0   1.25:    1.766E-01
1.0   0.75:    8.579E-02
1.0   0.50:    6.884E-02
1.0   0.10:    1.411E-02
</pre></div>
</div>
<p>The first column is the <span class="math">\(\theta\)</span> value, the next the <span class="math">\(\Delta t\)</span> value,
and the final column represents the numerical error <span class="math">\(E\)</span> (the
norm of discrete error function on the mesh).</p>
</div>
<div class="section" id="the-results-we-want-to-produce">
<h3>The results we want to produce<a class="headerlink" href="#the-results-we-want-to-produce" title="Permalink to this headline">¶</a></h3>
<p>The results we need for our investigations are slightly different than
what is directly produced by <code class="docutils literal"><span class="pre">model.py</span></code>:</p>
<ol class="arabic simple">
<li>We need to collect all the plots for one
numerical method (FE, BE, CN) in a single plot.
For example, if 4 <span class="math">\(\Delta t\)</span> values are run, the summarizing plot
for the BE method has <span class="math">\(2\times 2\)</span> subplots, with the subplot corresponding
to the largest <span class="math">\(\Delta t\)</span> in the upper left corner and the smallest
in the bottom right corner.</li>
<li>We need to create a table containing
<span class="math">\(\Delta t\)</span> values in the first column and the numerical error
<span class="math">\(E\)</span> for <span class="math">\(\theta=0,0.5,1\)</span>
in the next three columns. This table should be available as a
standard CSV file.</li>
<li>We need to plot the numerical error <span class="math">\(E\)</span> versus <span class="math">\(\Delta t\)</span>
in a log-log plot.</li>
</ol>
<p>Consequently, we must write a script that can run <code class="docutils literal"><span class="pre">model.py</span></code> as described and
produce the results 1-3 above. This requires combining multiple plot files into
one file and interpreting the output from <code class="docutils literal"><span class="pre">model.py</span></code> as data for plotting and
file storage.</p>
<p>If the script&#8217;s name is <code class="docutils literal"><span class="pre">exper1.py</span></code>, we run it with the desired <span class="math">\(\Delta t\)</span>
values as positional command-line arguments:</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python exper1.py 0.5 0.25 0.1 0.05
</pre></div>
</div>
<p>This run will then generate eight plot files: <code class="docutils literal"><span class="pre">FE.png</span></code> and <code class="docutils literal"><span class="pre">FE.pdf</span></code> summarizing
the plots with the FE method, <code class="docutils literal"><span class="pre">BE.png</span></code> and <code class="docutils literal"><span class="pre">BE.pdf</span></code> with
the BE method, <code class="docutils literal"><span class="pre">CN.png</span></code> and <code class="docutils literal"><span class="pre">CN.pdf</span></code> with the CN method, and <code class="docutils literal"><span class="pre">error.png</span></code>
and <code class="docutils literal"><span class="pre">error.pdf</span></code> with the log-log plot of the numerical error versus <span class="math">\(\Delta t\)</span>.
In addition, the table with numerical errors is written to a
file <code class="docutils literal"><span class="pre">error.csv</span></code>.</p>
<span class="target" id="index-32"></span><div class="admonition-reproducible-and-replicable-science admonition" id="index-33">
<p class="first admonition-title">Reproducible and replicable science</p>
<p>A script that automates running our computer experiments
will ensure
that the experiments can easily be rerun by anyone in
the future, either to confirm the same results or redo the experiments with
other input data.
Also, whatever we did to produce the results is
documented in every detail in the script.</p>
<p class="last">A project where anyone can easily repeat the experiments with the same data
is referred to as being <em>replicable</em>, and replicability
should be a fundamental requirement in scientific computing work.
Of more scientific interest is <em>reproducibilty</em>, which means that we can
also run alternative experiments to arrive at the same conclusions.
This requires more than an automating script.</p>
</div>
</div>
<div class="section" id="combining-plot-files-2">
<h3>Combining plot files  (2)<a class="headerlink" href="#combining-plot-files-2" title="Permalink to this headline">¶</a></h3>
<p>The script for running experiments needs to combine multiple image
files into one. The
<a class="reference external" href="http://www.imagemagick.org/script/montage.php">montage</a>
and
<a class="reference external" href="http://www.imagemagick.org/script/convert.php">convert</a> programs in
the ImageMagick software suite
can be used to combine image files.
However, these programs are best suited for
PNG files. For vector plots in PDF format one needs other tools
to preserve the quality: <code class="docutils literal"><span class="pre">pdftk</span></code>, <code class="docutils literal"><span class="pre">pdfnup</span></code>, and <code class="docutils literal"><span class="pre">pdfcrop</span></code>.</p>
<p>Suppose you have four files <code class="docutils literal"><span class="pre">f1.png</span></code>, <code class="docutils literal"><span class="pre">f2.png</span></code>, <code class="docutils literal"><span class="pre">f3.png</span></code>, and <code class="docutils literal"><span class="pre">f4.png</span></code>
and want to combine them into a <span class="math">\(2\times 2\)</span> table of subplots in a new
file <code class="docutils literal"><span class="pre">f.png</span></code>, see
Figure <a class="reference internal" href="#softeng1-experiments-fig-be4a"><span class="std std-ref">Illustration of the Backward Euler method for four time step values</span></a> for an example.</p>
<div class="figure" id="id9">
<span id="softeng1-experiments-fig-be4a"></span><a class="reference internal image-reference" href="_images/BE4a.png"><img alt="_images/BE4a.png" src="_images/BE4a.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text"><em>Illustration of the Backward Euler method for four time step values</em></span></p>
</div>
<p>The appropriate ImageMagick commands are</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; montage -background white -geometry 100% -tile 2x \
          f1.png f2.png f3.png f4.png f.png
Terminal&gt; convert -trim f.png f.png
Terminal&gt; convert f.png -transparent white f.png
</pre></div>
</div>
<p>The first command mounts the four files in one, the next <code class="docutils literal"><span class="pre">convert</span></code> command
removes unnecessary surrounding white space, and the final <code class="docutils literal"><span class="pre">convert</span></code> command
makes the white background transparent.</p>
<p>High-quality montage of PDF files <code class="docutils literal"><span class="pre">f1.pdf</span></code>,
<code class="docutils literal"><span class="pre">f2.pdf</span></code>, <code class="docutils literal"><span class="pre">f3.pdf</span></code>, and <code class="docutils literal"><span class="pre">f4.pdf</span></code> into <code class="docutils literal"><span class="pre">f.pdf</span></code> goes like</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; pdftk f1.pdf f2.pdf f3.pdf f4.pdf output tmp.pdf
Terminal&gt; pdfnup --nup 2x2 --outfile tmp.pdf tmp.pdf
Terminal&gt; pdfcrop tmp.pdf f.pdf
Terminal&gt; rm -f tmp.pdf
</pre></div>
</div>
</div>
<div class="section" id="running-a-program-from-python">
<h3>Running a program from Python<a class="headerlink" href="#running-a-program-from-python" title="Permalink to this headline">¶</a></h3>
<p>The script for automating experiments needs to run the <code class="docutils literal"><span class="pre">model.py</span></code> program
with appropriate command-line options. Python has several tools for
executing an arbitrary command in the operating systems.
Let <code class="docutils literal"><span class="pre">cmd</span></code> be a string containing the desired command.
In the present case study, <code class="docutils literal"><span class="pre">cmd</span></code> could be <code class="docutils literal"><span class="pre">'python</span> <span class="pre">model.py</span> <span class="pre">--I</span> <span class="pre">1</span> <span class="pre">--dt</span> <span class="pre">0.5</span> <span class="pre">0.2'</span></code>.
The following code
executes <code class="docutils literal"><span class="pre">cmd</span></code> and loads the text output into a string <code class="docutils literal"><span class="pre">output</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span><span class="p">,</span> <span class="n">STDOUT</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">STDOUT</span><span class="p">)</span>
<span class="n">output</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>

<span class="c"># Check if the execution was successful</span>
<span class="n">failure</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span>
<span class="k">if</span> <span class="n">failure</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;Command failed:&#39;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Unsuccessful execution usually makes it meaningless to continue
the program, and therefore we abort the program with <code class="docutils literal"><span class="pre">sys.exit(1)</span></code>.
Any argument different from 0 signifies to the computer&#8217;s operating system
that our program stopped with a failure.</p>
<div class="admonition-programming-tip-use-for-dummy-variable admonition">
<p class="first admonition-title">Programming tip: use <code class="docutils literal"><span class="pre">_</span></code> for dummy variable</p>
<p>Sometimes we need to unpack tuples or lists in separate variables,
but we are not interested in all the variables. One example is</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</pre></div>
</div>
<p>but <code class="docutils literal"><span class="pre">error</span></code> is of no interest.
One can then use underscore <code class="docutils literal"><span class="pre">_</span></code> as variable name for the dummy
(uninteresting) variable(s):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">output</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</pre></div>
</div>
<p>Here is another example where we iterate over a list of three-tuples,
but the interest is limited to the second element in each three-tuple:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">list_of_three_tuples</span><span class="p">:</span>
    <span class="c"># work with value</span>
</pre></div>
</div>
</div>
<p>We need to interpret the contents of the string
<code class="docutils literal"><span class="pre">output</span></code> and store
the data in an appropriate data structure for further processing.
Since the content is basically a table and will be transformed to
a spread sheet format, we let the columns in the table be represented
by lists in the program,
and we collect these columns in a dictionary whose keys are natural
column names: <code class="docutils literal"><span class="pre">dt</span></code> and the three values of <span class="math">\(\theta\)</span>.
The following code translates the output of <code class="docutils literal"><span class="pre">cmd</span></code> (<code class="docutils literal"><span class="pre">output</span></code>)
to such a dictionary of lists (<code class="docutils literal"><span class="pre">errors</span></code>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">errors</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;dt&#39;</span><span class="p">:</span> <span class="n">dt_values</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">0</span><span class="p">:</span> <span class="p">[],</span> <span class="mf">0.5</span><span class="p">:</span> <span class="p">[]}</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;0.0&#39;</span><span class="p">,</span> <span class="s">&#39;0.5&#39;</span><span class="p">,</span> <span class="s">&#39;1.0&#39;</span><span class="p">):</span>  <span class="c"># line with E?</span>
        <span class="c"># typical line: 0.0   1.25:    7.463E+00</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">E</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">errors</span><span class="p">[</span><span class="n">theta</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="the-automating-script">
<h3>The automating script<a class="headerlink" href="#the-automating-script" title="Permalink to this headline">¶</a></h3>
<p>We have now all the core elements in place to write the complete
script where we run
<code class="docutils literal"><span class="pre">model.py</span></code> for a set of <span class="math">\(\Delta t\)</span> values (given as positional
command-line arguments), make the error plot,
write the CSV file, and combine plot files as described above.
The complete code is listed below, followed by some explaining comments.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">run_experiments</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="c"># The command line must contain dt values</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dt_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Usage: </span><span class="si">%s</span><span class="s"> dt1 dt2 dt3 ...&#39;</span> <span class="o">%</span>  <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># abort</span>

    <span class="c"># Run module file and grab output</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s">&#39;python model.py --I </span><span class="si">%g</span><span class="s"> --a </span><span class="si">%g</span><span class="s"> --T </span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
    <span class="n">dt_values_str</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dt_values</span><span class="p">])</span>
    <span class="n">cmd</span> <span class="o">+=</span> <span class="s">&#39; --dt </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">dt_values_str</span>
    <span class="k">print</span> <span class="n">cmd</span>
    <span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span><span class="p">,</span> <span class="n">STDOUT</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">STDOUT</span><span class="p">)</span>
    <span class="n">output</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="n">failure</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span>
    <span class="k">if</span> <span class="n">failure</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Command failed:&#39;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;dt&#39;</span><span class="p">:</span> <span class="n">dt_values</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[],</span> <span class="mi">0</span><span class="p">:</span> <span class="p">[],</span> <span class="mf">0.5</span><span class="p">:</span> <span class="p">[]}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;0.0&#39;</span><span class="p">,</span> <span class="s">&#39;0.5&#39;</span><span class="p">,</span> <span class="s">&#39;1.0&#39;</span><span class="p">):</span>  <span class="c"># line with E?</span>
            <span class="c"># typical line: 0.0   1.25:    7.463E+00</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">E</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">errors</span><span class="p">[</span><span class="n">theta</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>

    <span class="c"># Find min/max for the axis</span>
    <span class="n">E_min</span> <span class="o">=</span> <span class="mf">1E+20</span><span class="p">;</span> <span class="n">E_max</span> <span class="o">=</span> <span class="o">-</span><span class="n">E_min</span>
    <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">E_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">E_min</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="n">theta</span><span class="p">]))</span>
        <span class="n">E_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">E_max</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="n">theta</span><span class="p">]))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;dt&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;ro-&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;dt&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="p">[</span><span class="mf">0.5</span><span class="p">],</span> <span class="s">&#39;b+-&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="s">&#39;dt&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;gx-&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;FE&#39;</span><span class="p">,</span> <span class="s">&#39;CN&#39;</span><span class="p">,</span> <span class="s">&#39;BE&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;log(time step)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;log(error)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">dt_values</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">dt_values</span><span class="p">),</span> <span class="n">E_min</span><span class="p">,</span> <span class="n">E_max</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Error vs time step&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;error.png&#39;</span><span class="p">);</span>  <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;error.pdf&#39;</span><span class="p">)</span>

    <span class="c"># Write out a table in CSV format</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;error.csv&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">r&#39;$\Delta t$,$\theta=0$,$\theta=0.5$,$\theta=1$&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_dt</span><span class="p">,</span> <span class="n">_fe</span><span class="p">,</span> <span class="n">_cn</span><span class="p">,</span> <span class="n">_be</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="n">errors</span><span class="p">[</span><span class="s">&#39;dt&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">errors</span><span class="p">[</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">errors</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.2f</span><span class="s">,</span><span class="si">%.4f</span><span class="s">,</span><span class="si">%.4f</span><span class="s">,</span><span class="si">%.4f</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_dt</span><span class="p">,</span> <span class="n">_fe</span><span class="p">,</span> <span class="n">_cn</span><span class="p">,</span> <span class="n">_be</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c"># Combine images into rows with 2 plots in each row</span>
    <span class="n">image_commands</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="s">&#39;BE&#39;</span><span class="p">,</span> <span class="s">&#39;CN&#39;</span><span class="p">,</span> <span class="s">&#39;FE&#39;</span><span class="p">:</span>
        <span class="n">pdf_files</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%g</span><span class="s">.pdf&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                              <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dt_values</span><span class="p">])</span>
        <span class="n">png_files</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%g</span><span class="s">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                              <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dt_values</span><span class="p">])</span>
        <span class="n">image_commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s">&#39;montage -background white -geometry 100%&#39;</span> <span class="o">+</span>
            <span class="s">&#39; -tile 2x </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">png_files</span><span class="p">,</span> <span class="n">method</span><span class="p">))</span>
        <span class="n">image_commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s">&#39;convert -trim </span><span class="si">%s</span><span class="s">.png </span><span class="si">%s</span><span class="s">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">method</span><span class="p">))</span>
        <span class="n">image_commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s">&#39;convert </span><span class="si">%s</span><span class="s">.png -transparent white </span><span class="si">%s</span><span class="s">.png&#39;</span> <span class="o">%</span>
            <span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">method</span><span class="p">))</span>
        <span class="n">image_commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s">&#39;pdftk </span><span class="si">%s</span><span class="s"> output tmp.pdf&#39;</span> <span class="o">%</span> <span class="n">pdf_files</span><span class="p">)</span>
        <span class="n">num_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dt_values</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span>
        <span class="n">image_commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s">&#39;pdfnup --nup 2x</span><span class="si">%d</span><span class="s"> --outfile tmp.pdf tmp.pdf&#39;</span> <span class="o">%</span> <span class="n">num_rows</span><span class="p">)</span>
        <span class="n">image_commands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="s">&#39;pdfcrop tmp.pdf </span><span class="si">%s</span><span class="s">.pdf&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">image_commands</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">cmd</span>
        <span class="n">failure</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">failure</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Command failed:&#39;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c"># Remove the files generated above and by model.py</span>
    <span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
    <span class="n">filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="s">&#39;*_*.png&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">glob</span><span class="p">(</span><span class="s">&#39;*_*.pdf&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">glob</span><span class="p">(</span><span class="s">&#39;tmp*.pdf&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">run_experiments</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<span class="target" id="index-34"></span><span class="target" id="index-35"></span><p id="index-36">We may comment upon many useful constructs in this script:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">[float(arg)</span> <span class="pre">for</span> <span class="pre">arg</span> <span class="pre">in</span> <span class="pre">sys.argv[1:]]</span></code> builds a list of real numbers
from all the command-line arguments.</li>
<li><code class="docutils literal"><span class="pre">['%s_%s.png'</span> <span class="pre">%</span> <span class="pre">(method,</span> <span class="pre">dt)</span> <span class="pre">for</span> <span class="pre">dt</span> <span class="pre">in</span> <span class="pre">dt_values]</span></code> builds a list of
filenames from a list of numbers (<code class="docutils literal"><span class="pre">dt_values</span></code>).</li>
<li>All <code class="docutils literal"><span class="pre">montage</span></code>, <code class="docutils literal"><span class="pre">convert</span></code>, <code class="docutils literal"><span class="pre">pdftk</span></code>, <code class="docutils literal"><span class="pre">pdfnup</span></code>, and <code class="docutils literal"><span class="pre">pdfcrop</span></code>
commands for creating
composite figures are stored in a
list and later executed in a loop.</li>
<li><code class="docutils literal"><span class="pre">glob('*_*.png')</span></code> returns a list of the names of all files in the
current directory where the filename matches the <a class="reference external" href="http://en.wikipedia.org/wiki/Glob_(programming)">Unix wildcard notation</a>
<code class="docutils literal"><span class="pre">*_*.png</span></code> (meaning any text, underscore, any text, and then <code class="docutils literal"><span class="pre">.png</span></code>).</li>
<li><code class="docutils literal"><span class="pre">os.remove(filename)</span></code> removes the file with name <code class="docutils literal"><span class="pre">filename</span></code>.</li>
<li><code class="docutils literal"><span class="pre">failure</span> <span class="pre">=</span> <span class="pre">os.system(cmd)</span></code> runs an operating system command with
simpler syntax than what is required by <code class="docutils literal"><span class="pre">subprocess</span></code> (but the output
of <code class="docutils literal"><span class="pre">cmd</span></code> cannot be captured).</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="making-a-report">
<span id="softeng1-exper-report"></span><h3>Making a report<a class="headerlink" href="#making-a-report" title="Permalink to this headline">¶</a></h3>
<p>The results of running computer experiments are best documented in a
little report containing the problem to be solved, key code segments,
and the plots from a series of experiments. At least the part of the
report containing the plots should be automatically generated by the
script that performs the set of experiments, because in the script we
know exactly which input data that were used to generate a specific
plot, thereby ensuring that each figure is connected to the
right data. Take a look at <a class="reference external" href="http://tinyurl.com/nc4upel/_static/sphinx-cloud/">a sample report</a>  to see what we have in
mind.</p>
<span class="target" id="index-37"></span><span class="target" id="index-38"></span><span class="target" id="index-39"></span><div class="section" id="word-openoffice-googledocs">
<span id="index-40"></span><h4>Word, OpenOffice, GoogleDocs<a class="headerlink" href="#word-openoffice-googledocs" title="Permalink to this headline">¶</a></h4>
<p>Microsoft Word, its open source counterparts OpenOffice and
LibreOffice, along with GoogleDocs and similar online services are the
dominating tools for writing reports today. Nevertheless, scientific
reports often need mathematical equations and nicely typeset computer
code in monospace font. The support for mathematics and computer code
in the mentioned tools is in this author&#8217;s view not on par with the
technologies based on <em>markup languages</em> and which are addressed
below. Also, with markup languages one has a readable, pure text file
as source for the report, and changes in this text can easily be
tracked by version control systems like Git. The result is a very
strong tool for monitoring &#8220;who did what when&#8221; with the files,
resulting in increased reliability of the writing process. For
collaborative writing, the merge functionality in Git leads to safer
simultaneously editing that what is offered even by collaborative
tools like GoogleDocs.</p>
<span class="target" id="index-41"></span></div>
<div class="section" id="html-with-mathjax">
<span id="index-42"></span><h4>HTML with MathJax<a class="headerlink" href="#html-with-mathjax" title="Permalink to this headline">¶</a></h4>
<p>HTML is the markup language used for web pages.  Nicely typeset computer
code is straightforward in HTML, and high-quality mathematical
typesetting is available using an extension to HTML called <a class="reference external" href="http://www.mathjax.org/">MathJax</a>, which allows formulas and equations to be
typeset with LaTeX syntax and nicely rendered in web browsers, see
Figure <a class="reference internal" href="#softeng1-exper-report-fig-mathjax"><span class="std std-ref">Report in HTML format with MathJax</span></a>.  A relatively small
subset of LaTeX environments for mathematics is supported, but the
syntax for formulas is quite rich. Inline formulas look like <code class="docutils literal"><span class="pre">\(</span>
<span class="pre">u'=-au</span> <span class="pre">\)</span></code> while equations are surrounded by <code class="docutils literal"><span class="pre">$$</span></code> signs.  Inside such
signs, one can use <code class="docutils literal"><span class="pre">\[</span> <span class="pre">u'=-au</span> <span class="pre">\]</span></code> for unnumbered equations, or
<code class="docutils literal"><span class="pre">\begin{equation}</span></code> and <code class="docutils literal"><span class="pre">\end{equation}</span></code> for
numbered equations, or <code class="docutils literal"><span class="pre">\begin{equation}</span></code> and <code class="docutils literal"><span class="pre">\end{equation}</span></code> for multiple
numbered aligned equations.  You need to be familiar with <a class="reference external" href="http://en.wikibooks.org/wiki/LaTeX/Mathematics">mathematical
typesetting in LaTeX</a> to write MathJax
code.</p>
<p>The file <a class="reference external" href="http://tinyurl.com/p96acy2/report_generation/exper1_html.py">exper1_mathjax.py</a>
calls a script
<a class="reference external" href="http://tinyurl.com/p96acy2/exper1.py">exper1.py</a>
to perform the numerical experiments and then runs Python
statements for creating an <a class="reference external" href="http://tinyurl.com/nc4upel/_static/report_mathjax.html.html">HTML file</a> with the source code for <a class="reference external" href="http://tinyurl.com/nc4upel/_static/report_mathjax.html">the scientific report</a>.</p>
<div class="figure" id="id10">
<span id="softeng1-exper-report-fig-mathjax"></span><a class="reference internal image-reference" href="_images/report_mathjax.png"><img alt="_images/report_mathjax.png" src="_images/report_mathjax.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text"><em>Report in HTML format with MathJax</em></span></p>
</div>
</div>
<div class="section" id="latex">
<span id="index-43"></span><h4>LaTeX<a class="headerlink" href="#latex" title="Permalink to this headline">¶</a></h4>
<p>The <em>de facto</em> language for mathematical typesetting and scientific
report writing is <a class="reference external" href="http://en.wikipedia.org/wiki/LaTeX">LaTeX</a>. A
number of very sophisticated packages have been added to the language
over a period of three decades, allowing very fine-tuned layout and
typesetting. For output in the <a class="reference external" href="http://tinyurl.com/nc4upel/_static/report.pdf">PDF format</a>, see Figure
<a class="reference internal" href="#softeng1-exper-report-fig-latex"><span class="std std-ref">Report in PDF format generated from LaTeX source</span></a> for an example, LaTeX is the
definite choice when it comes to <em>typesetting quality</em>.
The LaTeX language used to
write the reports has typically a lot of commands involving
<a class="reference external" href="http://tinyurl.com/nc4upel/_static/report.tex.html">backslashes and braces</a>, and many claim that
LaTeX syntax is not particularly readable.  For output on the web via
HTML code (i.e., not only showing the PDF in the browser window), LaTeX
struggles with delivering high quality typesetting. Other tools,
especially Sphinx, give better results and can also produce
nice-looking PDFs.  The file <a class="reference external" href="http://tinyurl.com/p96acy2/report_generation/exper1_latex.py">exper1_latex.py</a> shows how to
generate the LaTeX source from a program.</p>
<div class="figure" id="id11">
<span id="softeng1-exper-report-fig-latex"></span><a class="reference internal image-reference" href="_images/report_latexpdf.png"><img alt="_images/report_latexpdf.png" src="_images/report_latexpdf.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text"><em>Report in PDF format generated from LaTeX source</em></span></p>
</div>
</div>
<div class="section" id="sphinx">
<span id="index-44"></span><h4>Sphinx<a class="headerlink" href="#sphinx" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://sphinx.pocoo.org/">Sphinx</a> is a typesetting language with
similarities to HTML and LaTeX, but with much less tagging. It has
recently become very popular for software documentation and
mathematical reports. Sphinx can utilize LaTeX for mathematical
formulas and equations. Unfortunately, the
subset of LaTeX mathematics supported is less than in full MathJax (in
particular, numbering of multiple equations in an <code class="docutils literal"><span class="pre">align</span></code> type
environment is not supported).  The <a class="reference external" href="http://tinyurl.com/nc4upel/_static/report_sphinx.rst.html">Sphinx syntax</a> is an extension of
the reStructuredText language. An attractive feature of Sphinx is its
rich support for <a class="reference external" href="http://tinyurl.com/nc4upel/_static/sphinx-cloud/index.html">fancy layout of web pages</a>. In particular,
Sphinx can easily be combined with various layout <em>themes</em> that give a
certain look and feel to the web site and that offers table of
contents, navigation, and search facilities, see Figure
<a class="reference internal" href="#softeng1-exper-report-fig-sphinx"><span class="std std-ref">Report in HTML format generated from Sphinx source</span></a>.</p>
<div class="figure" id="id12">
<span id="softeng1-exper-report-fig-sphinx"></span><a class="reference internal image-reference" href="_images/report_sphinx.png"><img alt="_images/report_sphinx.png" src="_images/report_sphinx.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text"><em>Report in HTML format generated from Sphinx source</em></span></p>
</div>
</div>
<div class="section" id="markdown">
<span id="index-45"></span><h4>Markdown<a class="headerlink" href="#markdown" title="Permalink to this headline">¶</a></h4>
<p>A recent, very popular format for easy writing of web pages is
<a class="reference external" href="http://daringfireball.net/projects/markdown/">Markdown</a>.
Text is written very much like one would do in email, using
spacing and special characters to naturally format the code
instead of heavily tagging the text as in LaTeX and HTML.
With the tool <a class="reference external" href="http://johnmacfarlane.net/pandoc/">Pandoc</a> one
can go from Markdown to a variety of formats.
HTML is a common output format, but LaTeX, epub, XML,
OpenOffice/LibreOffice, MediaWiki, and Microsoft Word are some other
possibilities. A Markdown version of our scientific
report demo is available as an IPython/Jupyter notebook (described next).</p>
<span class="target" id="index-46"></span></div>
<div class="section" id="ipython-jupyter-notebooks">
<span id="index-47"></span><h4>IPython/Jupyter notebooks<a class="headerlink" href="#ipython-jupyter-notebooks" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference external" href="http://ipython.org/notebook.html">IPython Notebook</a> is
a web-based tool where one can write scientific reports with live computer
code and graphics. Or the other way around: software can be equipped
with documentation in the style of scientific reports.
A slightly extended version of Markdown is used for writing text and
mathematics, and the <a class="reference external" href="http://tinyurl.com/nc4upel/_static/report.ipynb.html">source code of a notebook</a> is in json format.
The interest in the notebook has grown amazingly fast
over just a few years, and further development now takes place
in the <a class="reference external" href="https://jupyter.org/">Jupyter project</a>, which
supports a lot of programming languages for interactive notebook computing.
Jupyter notebooks are primarily live electronic documents, but they can be
printed out as PDF reports too.
A notebook version of our scientific report can be <a class="reference external" href="http://tinyurl.com/p96acy2/_static/report.ipynb">downloaded</a> and experimented with
or <a class="reference external" href="http://nbviewer.ipython.org/url/hplgit.github.com/teamods/writing_reports/_static/report.ipynb">just statically viewed</a> in a browser.</p>
</div>
<div class="section" id="wiki-formats">
<h4>Wiki formats<a class="headerlink" href="#wiki-formats" title="Permalink to this headline">¶</a></h4>
<p>A range of wiki formats are popular for creating notes on the web,
especially documents which allow groups of people to edit and add
content. Apart from <a class="reference external" href="http://www.mediawiki.org/wiki/MediaWiki">MediaWiki</a> (the wiki format used for
Wikipedia), wiki formats have no support for mathematical typesetting
and also limited tools for displaying computer code in nice ways.
Wiki formats are therefore less suitable for scientific reports compared
to the other formats mentioned here.</p>
</div>
<div class="section" id="doconce">
<span id="index-48"></span><h4>DocOnce<a class="headerlink" href="#doconce" title="Permalink to this headline">¶</a></h4>
<p>Since it is difficult to choose the right tool or format for writing a
scientific report, it is advantageous to write the content in a format
that easily translates to LaTeX, HTML, Sphinx, Markdown,
IPython/Jupyter notebooks, and various wikis. <a class="reference external" href="https://github.com/hplgit/doconce">DocOnce</a> is such a tool. It is similar to
Pandoc, but offers some special convenient features for writing about
mathematics and programming.  The <a class="reference external" href="http://tinyurl.com/nc4upel/_static/report.do.txt.html">tagging is modest</a>, somewhere between
LaTeX and Markdown.  The program <a class="reference external" href="http://tinyurl.com/p96acy2/exper1_do.py">exper1_do.py</a> demonstrates how
to generate DocOnce code for a scientific report.
There is also a corresponding rich demo of the <a class="reference external" href="http://tinyurl.com/nc4upel/index.html">resulting reports</a> that can be made from
this DocOnce code.</p>
</div>
</div>
<div class="section" id="publishing-a-complete-project">
<span id="softeng1-exper-github"></span><h3>Publishing a complete project<a class="headerlink" href="#publishing-a-complete-project" title="Permalink to this headline">¶</a></h3>
<p id="index-49">To assist the important principle of <em>replicable</em> science,
a report documenting scientific investigations should be accompanied by
all the software and data used for the investigations so that others
have a possibility to redo the work and assess the qualify of the results.</p>
<p>One way of documenting a complete project is to make a directory tree
with all relevant files. Preferably, the tree is published at
some project hosting site like <a class="reference external" href="http://hplgit.github.com/teamods/bitgit/html/">Bitbucket or GitHub</a> so that others can download it
as a tarfile, zipfile, or clone the files directly using the Git version control
system.
For the investigations outlined in the section <a class="reference internal" href="#softeng1-exper-report"><span class="std std-ref">Making a report</span></a>,
we can create a directory tree with files</p>
<div class="highlight-text"><div class="highlight"><pre>setup.py
./src:
   model.py
./doc:
   ./src:
      exper1_mathjax.py
      make_report.sh
      run.sh
   ./pub:
      report.html
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">src</span></code> directory holds source code (modules) to be reused in other projects,
the <code class="docutils literal"><span class="pre">setup.py</span></code> script builds and installs such software,
the <code class="docutils literal"><span class="pre">doc</span></code> directory contains the documentation, with <code class="docutils literal"><span class="pre">src</span></code> for the
source of the documentation (usually written in a markup language)
and <code class="docutils literal"><span class="pre">pub</span></code> for published (compiled) documentation.
The <code class="docutils literal"><span class="pre">run.sh</span></code> file is a simple Bash script listing the <code class="docutils literal"><span class="pre">python</span></code> commands
we used to run <code class="docutils literal"><span class="pre">exper1_mathjax.py</span></code> to generate the experiments and
the <code class="docutils literal"><span class="pre">report.html</span></code> file.</p>
</div>
</div>
<div class="section" id="exercises-5">
<h2>Exercises  (5)<a class="headerlink" href="#exercises-5" title="Permalink to this headline">¶</a></h2>
<div class="section" id="problem-39-make-a-tool-for-differentiating-curves">
<span id="softeng1-exer-derivative"></span><h3>Problem 39: Make a tool for differentiating curves<a class="headerlink" href="#problem-39-make-a-tool-for-differentiating-curves" title="Permalink to this headline">¶</a></h3>
<p>Suppose we have a curve specified through a set
of discrete coordinates <span class="math">\((x_i,y_i)\)</span>, <span class="math">\(i=0,\ldots,n\)</span>, where the <span class="math">\(x_i\)</span>
values are uniformly distributed with spacing <span class="math">\(\Delta x\)</span>: <span class="math">\(x_i=\Delta x\)</span>.
The derivative of this curve, defined as a new curve with points
<span class="math">\((x_i, d_i)\)</span>, can be computed via finite differences:</p>
<div class="math">
\[d_0 = \frac{y_1-y_0}{\Delta x},\]</div>
<div class="math">
\[d_i = \frac{y_{i+1}-y_{i-1}}{2\Delta x},\quad i=1,\ldots,n-1,\]</div>
<div class="math">
\[d_n = \frac{y_n-y_{n-1}}{\Delta x}{\thinspace .}\]</div>
<p><strong>a)</strong>
Write a function
<code class="docutils literal"><span class="pre">differentiate(x,</span> <span class="pre">y)</span></code> for differentiating a curve
with coordinates in the arrays <code class="docutils literal"><span class="pre">x</span></code> and <code class="docutils literal"><span class="pre">y</span></code>, using the
formulas above. The function should return the coordinate arrays
of the resulting differentiated curve.</p>
<p><strong>b)</strong>
Since the formulas for differentiation used here are only approximate,
with unknown approximation errors, it is challenging to construct
test cases. Here are three approaches, which should be implemented
in three separate test functions.</p>
<ol class="arabic simple">
<li>Consider a curve with three points and compute <span class="math">\(d_i\)</span>, <span class="math">\(i=0,1,2\)</span>,
by hand. Make a test that compares the hand-calculated results with those
from the function in a).</li>
<li>The formulas for <span class="math">\(d_i\)</span> are exact for points on
a straight line, as all the <span class="math">\(d_i\)</span> values are then the same, equal to
the slope of the line. A test can check this property.</li>
<li>For point lying on a parabola, the values for <span class="math">\(d_i\)</span>, <span class="math">\(i=1,\ldots,n-1\)</span>,
should equal the exact derivative of the parabola. Make a test based on
this property.</li>
</ol>
<p><strong>c)</strong>
Start with a curve corresponding to <span class="math">\(y=\sin(\pi x)\)</span> and <span class="math">\(n+1\)</span>
points in <span class="math">\([0,1]\)</span>. Apply <code class="docutils literal"><span class="pre">differentiate</span></code> four times and plot the
resulting curve and the exact <span class="math">\(y=\sin\pi x\)</span> for <span class="math">\(n=6, 11, 21, 41\)</span>.</p>
<p>Filename: <code class="docutils literal"><span class="pre">curvediff</span></code>.</p>
</div>
<div class="section" id="problem-40-make-solid-software-for-the-trapezoidal-rule">
<span id="softeng1-exer-integral-flat"></span><h3>Problem 40: Make solid software for the Trapezoidal rule<a class="headerlink" href="#problem-40-make-solid-software-for-the-trapezoidal-rule" title="Permalink to this headline">¶</a></h3>
<p>An integral</p>
<div class="math">
\[\int_a^b f(x)dx\]</div>
<p>can be numerically approximated by the Trapezoidal rule,</p>
<div class="math">
\[\int_a^b f(x)dx \approx \frac{h}{2}(f(a) + f(b)) + h\sum_{i=1}^{n-1} f(x_i),\]</div>
<p>where <span class="math">\(x_i\)</span> is a set of uniformly spaced points in <span class="math">\([a,b]\)</span>:</p>
<div class="math">
\[h = \frac{b-a}{n},\quad x_i=a + ih,\ i=1,\ldots,n-1{\thinspace .}\]</div>
<p>Somebody has used this rule to compute the integral <span class="math">\(\int_0^\pi \sin^2x\, dx\)</span>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sin</span>
<span class="n">np</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="n">np</span>
<span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="p">):</span>
    <span class="n">I</span> <span class="o">+=</span> <span class="n">sin</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="k">print</span> <span class="n">I</span>
</pre></div>
</div>
<p><strong>a)</strong>
The &#8220;flat&#8221; implementation above suffers from serious flaws:</p>
<ol class="arabic simple">
<li>A general numerical algorithm (the Trapezoidal rule) is implemented
in a specialized form where the formula for <span class="math">\(f\)</span> is inserted directly
into the code for the general integration formula.</li>
<li>A general numerical algorithm is not encapsulated as a general
function, with appropriate parameters, which can be reused
across a wide range of applications.</li>
<li>The lazy programmer dropped the first terms in the general formula
since <span class="math">\(\sin(0)=\sin(\pi)=0\)</span>.</li>
<li>The sloppy programmer used <code class="docutils literal"><span class="pre">np</span></code> (number of points?) as variable for
<code class="docutils literal"><span class="pre">n</span></code> in the formula and a counter <code class="docutils literal"><span class="pre">k</span></code> instead of <code class="docutils literal"><span class="pre">i</span></code>. Such small
deviations from the mathematical notation are completely unnecessary.
The closer the code and the mathematics can get, the easier it is
to spot errors in formulas.</li>
</ol>
<p>Write a function <code class="docutils literal"><span class="pre">trapezoidal</span></code> that fixes these flaws.
Place the function in a module <code class="docutils literal"><span class="pre">trapezoidal</span></code>.</p>
<p><strong>b)</strong>
Write a test function <code class="docutils literal"><span class="pre">test_trapezoidal</span></code>. Call the test function
explicitly to check that it works. Remove the call and run pytest
on the module:</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; py.test -s -v trapezoidal
</pre></div>
</div>
<p><strong>Hint.</strong>
Note that even if you know the value of the integral, you do not know
the error in the approximation produced by the Trapezoidal rule.
However, the Trapezoidal rule will integrate linear functions
exactly (i.e., to machine precision). Base a test function
on a linear <span class="math">\(f(x)\)</span>.</p>
<p><strong>c)</strong>
Add functionality such that we can compute <span class="math">\(\int_a^b f(x)dx\)</span> by providing
<span class="math">\(f\)</span>, <span class="math">\(a\)</span>, <span class="math">\(b\)</span>, and <span class="math">\(n\)</span> as positional command-line arguments to the
module file:</p>
<div class="highlight-text"><div class="highlight"><pre>Terminal&gt; python trapezoidal.py &#39;sin(x)**2&#39; 0 pi 20
</pre></div>
</div>
<p>Here, <span class="math">\(a=0\)</span>, <span class="math">\(b=\pi\)</span>, and <span class="math">\(n=20\)</span>.</p>
<p>Note that the <code class="docutils literal"><span class="pre">trapezoidal.py</span></code> file must still be a valid module file, so the
interpretation of command-line data and computation of the integral
must be performed from calls in a test block.</p>
<p><strong>Hint.</strong>
To translate a string formula on the command line, like <code class="docutils literal"><span class="pre">sin(x)**2</span></code>,
into a Python function, you can wrap a function declaration around
the formula and run <code class="docutils literal"><span class="pre">exec</span></code> on the string to turn it into live Python code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">sys</span>
<span class="n">formula</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">f_code</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">def f(x):</span>
<span class="s">    return </span><span class="si">%s</span><span class="s"></span>
<span class="s">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">formula</span>
<span class="k">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
</pre></div>
</div>
<p>The result is the same as if we had hardcoded</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
<p>in the program. Note that <code class="docutils literal"><span class="pre">exec</span></code> needs the namespace
<code class="docutils literal"><span class="pre">math.__dict__</span></code>, i.e., all names in the <code class="docutils literal"><span class="pre">math</span></code> module, such that
it understands <code class="docutils literal"><span class="pre">sin</span></code> and other mathematical functions.
Similarly, to allow <span class="math">\(a\)</span> and <span class="math">\(b\)</span> to be <code class="docutils literal"><span class="pre">math</span></code> expressions like <code class="docutils literal"><span class="pre">pi/4</span></code>
and <code class="docutils literal"><span class="pre">exp(4)</span></code>, do</p>
<div class="highlight-text"><div class="highlight"><pre>a = eval(sys.argv[2], math.__dict__)
b = eval(sys.argv[2], math.__dict__)
</pre></div>
</div>
<p><strong>d)</strong>
Write a test function for verifying the implementation of
data reading from the command line.</p>
<p>Filename: <code class="docutils literal"><span class="pre">trapezoidal</span></code>.</p>
</div>
<div class="section" id="problem-41-implement-classes-for-the-trapezoidal-rule">
<span id="softeng1-exer-integral-flat2"></span><h3>Problem 41: Implement classes for the Trapezoidal rule<a class="headerlink" href="#problem-41-implement-classes-for-the-trapezoidal-rule" title="Permalink to this headline">¶</a></h3>
<p>We consider the same problem setting as in <a class="reference internal" href="#softeng1-exer-integral-flat"><span class="std std-ref">Problem 40: Make solid software for the Trapezoidal rule</span></a>. Make a module with a class <code class="docutils literal"><span class="pre">Problem</span></code>
representing the mathematical problem to be solved and a class
<code class="docutils literal"><span class="pre">Solver</span></code> representing the solution method.  The rest of the
functionality of the module, including test functions and reading data
from the command line, should be as in <a class="reference internal" href="#softeng1-exer-integral-flat"><span class="std std-ref">Problem 40: Make solid software for the Trapezoidal rule</span></a>.
Filename: <code class="docutils literal"><span class="pre">trapezoidal_class</span></code>.</p>
</div>
<div class="section" id="problem-42-write-a-doctest-and-a-test-function">
<span id="softeng1-exer-doctest1"></span><h3>Problem 42: Write a doctest and a test function<a class="headerlink" href="#problem-42-write-a-doctest-and-a-test-function" title="Permalink to this headline">¶</a></h3>
<p>Type in the following program:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="c"># This sqrt(x) returns real if x&gt;0 and complex if x&lt;0</span>
<span class="kn">from</span> <span class="nn">numpy.lib.scimath</span> <span class="kn">import</span> <span class="n">sqrt</span>

<span class="k">def</span> <span class="nf">roots</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the roots of the quadratic polynomial</span>
<span class="sd">    p(x) = a*x**2 + b*x + c.</span>

<span class="sd">    The roots are real or complex objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">c</span>
    <span class="n">r1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">b</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span>

<span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
<span class="k">print</span> <span class="n">roots</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>a)</strong>
Equip the <code class="docutils literal"><span class="pre">roots</span></code> function with a doctest.
Make sure to test both real and complex roots.
Write out numbers in the doctest with 14 digits or less.</p>
<p><strong>b)</strong>
Make a test function for the <code class="docutils literal"><span class="pre">roots</span></code> function. Perform the
same mathematical tests as in a), but with different
programming technology.</p>
<p>Filename: <code class="docutils literal"><span class="pre">test_roots</span></code>.</p>
</div>
<div class="section" id="problem-43-experiment-with-tolerances-in-comparisons">
<span id="softeng1-exer-tol"></span><h3>Problem 43: Experiment with tolerances in comparisons<a class="headerlink" href="#problem-43-experiment-with-tolerances-in-comparisons" title="Permalink to this headline">¶</a></h3>
<p>When we replace a comparison <code class="docutils literal"><span class="pre">a</span> <span class="pre">==</span> <span class="pre">b</span></code>, where <code class="docutils literal"><span class="pre">a</span></code> and/or <code class="docutils literal"><span class="pre">b</span></code> are
<code class="docutils literal"><span class="pre">float</span></code> objects, by a comparison with tolerance, <code class="docutils literal"><span class="pre">abs(a-b)</span> <span class="pre">&lt;</span> <span class="pre">tol</span></code>,
the appropriate size of <code class="docutils literal"><span class="pre">tol</span></code> depends on the size <code class="docutils literal"><span class="pre">a</span></code> and <code class="docutils literal"><span class="pre">b</span></code>.
Investigate how the size of <code class="docutils literal"><span class="pre">abs(a-b)</span></code> varies when <code class="docutils literal"><span class="pre">b</span></code> takes on
values <span class="math">\(10^k\)</span>, <span class="math">\(k=-5,-9,\ldots,20\)</span> and <code class="docutils literal"><span class="pre">a=1.0/49*b*49</span></code>.
Filename: <code class="docutils literal"><span class="pre">tolerance</span></code>.</p>
<div class="section" id="remarks-2">
<h4>Remarks  (2)<a class="headerlink" href="#remarks-2" title="Permalink to this headline">¶</a></h4>
<p>You will experience that if <code class="docutils literal"><span class="pre">a</span></code> and <code class="docutils literal"><span class="pre">b</span></code> are large, as they can be
in geophysical applications where lengths measured in meters can be of size
<span class="math">\(10^6\)</span> m, <code class="docutils literal"><span class="pre">tol</span></code> must be about <span class="math">\(10^{-9}\)</span>, while <code class="docutils literal"><span class="pre">a</span></code> and <code class="docutils literal"><span class="pre">b</span></code> around unity can
have <code class="docutils literal"><span class="pre">tol</span></code> of size <span class="math">\(10^{-15}\)</span>.</p>
</div>
</div>
<div class="section" id="exercise-44-make-use-of-a-class-implementation">
<span id="softeng1-exer-class-dts"></span><h3>Exercise 44: Make use of a class implementation<a class="headerlink" href="#exercise-44-make-use-of-a-class-implementation" title="Permalink to this headline">¶</a></h3>
<p>Implement the <code class="docutils literal"><span class="pre">experiment_compare_dt</span></code> function from <code class="docutils literal"><span class="pre">decay.py</span></code>
using class <code class="docutils literal"><span class="pre">Problem</span></code> and class <code class="docutils literal"><span class="pre">Solver</span></code> from
the section <a class="reference internal" href="#softeng1-prog-se-class"><span class="std std-ref">Classes for problem and solution method</span></a>.
The parameters <code class="docutils literal"><span class="pre">I</span></code>, <code class="docutils literal"><span class="pre">a</span></code>, <code class="docutils literal"><span class="pre">T</span></code>, the scheme name, and a series of
<code class="docutils literal"><span class="pre">dt</span></code> values should be read from the command line.
Filename: <code class="docutils literal"><span class="pre">experiment_compare_dt_class</span></code>.</p>
</div>
<div class="section" id="exercise-45-make-solid-software-for-a-difference-equation">
<span id="softeng1-exer-logistic"></span><h3>Exercise 45: Make solid software for a difference equation<a class="headerlink" href="#exercise-45-make-solid-software-for-a-difference-equation" title="Permalink to this headline">¶</a></h3>
<p>We have the following evolutionary difference equation for the number
of individuals <span class="math">\(u^n\)</span> of a certain specie at time <span class="math">\(n\Delta t\)</span>:</p>
<div class="math" id="equation-softeng1:exer:logistic:eq">
<span id="eq-softeng1-exer-logistic-eq"></span><span class="eqno">(6)</span>\[     u^{n+1} = u^n + \Delta t r u^n\left(1 - \frac{u^n}{M^n}\right),
     \quad u^0=U_0{\thinspace .}
     \\]</div>
<p>Here, <span class="math">\(n\)</span> is a counter in time, <span class="math">\(\Delta t\)</span> is time between time levels
<span class="math">\(n\)</span> and <span class="math">\(n+1\)</span> (assumed constant), <span class="math">\(r\)</span> is a net reproduction rate
for the specie,
and <span class="math">\(M^n\)</span> is the upper limit of the population that the environment can
sustain at time level <span class="math">\(n\)</span>.
Filename: <code class="docutils literal"><span class="pre">logistic</span></code>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <center>
            <p class="logo"><a href="http://cbc.simula.no/" title="Go to Center for Biomedical Computing">
              <img class="logo" src="_static/cbc_logo.png" alt="Logo"/>
            </a></p>
            </center>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Scientific software engineering</a><ul>
<li><a class="reference internal" href="#basic-implementations">Basic implementations</a><ul>
<li><a class="reference internal" href="#mathematical-problem-and-solution-technique">Mathematical problem and solution technique</a></li>
<li><a class="reference internal" href="#a-first-quick-implementation">A first, quick implementation</a></li>
<li><a class="reference internal" href="#a-more-decent-program">A more decent program</a><ul>
<li><a class="reference internal" href="#comments-in-a-program">Comments in a program</a></li>
<li><a class="reference internal" href="#refactoring-into-functions">Refactoring into functions</a></li>
<li><a class="reference internal" href="#program-file-vs-ide-vs-notebook">Program file vs IDE vs notebook</a></li>
</ul>
</li>
<li><a class="reference internal" href="#prefixing-imported-functions-by-the-module-name">Prefixing imported functions by the module name</a></li>
<li><a class="reference internal" href="#implementing-the-numerical-algorithm-in-a-function">Implementing the numerical algorithm in a function</a></li>
<li><a class="reference internal" href="#do-not-have-several-versions-of-a-code">Do not have several versions of a code</a></li>
<li><a class="reference internal" href="#making-a-module">Making a module</a></li>
<li><a class="reference internal" href="#example-on-extending-the-module-code">Example on extending the module code</a></li>
<li><a class="reference internal" href="#documenting-functions-and-modules">Documenting functions and modules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#user-interfaces">User interfaces</a><ul>
<li><a class="reference internal" href="#command-line-arguments">Command-line arguments</a></li>
<li><a class="reference internal" href="#positional-command-line-arguments">Positional command-line arguments</a></li>
<li><a class="reference internal" href="#option-value-pairs-on-the-command-line">Option-value pairs on the command line</a></li>
<li><a class="reference internal" href="#creating-a-graphical-web-user-interface">Creating a graphical web user interface</a><ul>
<li><a class="reference internal" href="#making-a-compute-function">Making a compute function</a></li>
<li><a class="reference internal" href="#generating-the-user-interface">Generating the user interface</a></li>
<li><a class="reference internal" href="#running-the-web-application">Running the web application</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#tests-for-verifying-implementations">Tests for verifying implementations</a><ul>
<li><a class="reference internal" href="#doctests">Doctests</a></li>
<li><a class="reference internal" href="#unit-tests-and-test-functions">Unit tests and test functions</a><ul>
<li><a class="reference internal" href="#two-python-test-frameworks-nose-and-pytest">Two Python test frameworks: nose and pytest</a></li>
<li><a class="reference internal" href="#test-function-requirements">Test function requirements</a></li>
<li><a class="reference internal" href="#comparison-of-real-numbers">Comparison of real numbers</a></li>
<li><a class="reference internal" href="#special-assert-functions-from-nose">Special assert functions from nose</a></li>
<li><a class="reference internal" href="#locating-test-functions">Locating test functions</a></li>
<li><a class="reference internal" href="#running-tests">Running tests</a></li>
<li><a class="reference internal" href="#embedding-doctests-in-a-test-function">Embedding doctests in a test function</a></li>
<li><a class="reference internal" href="#installing-nose-and-pytest">Installing nose and pytest</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-function-for-the-solver">Test function for the solver</a></li>
<li><a class="reference internal" href="#test-function-for-reading-positional-command-line-arguments">Test function for reading positional command-line arguments</a></li>
<li><a class="reference internal" href="#test-function-for-reading-option-value-pairs">Test function for reading option-value pairs</a></li>
<li><a class="reference internal" href="#classical-class-based-unit-testing">Classical class-based unit testing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sharing-the-software-with-other-users">Sharing the software with other users</a><ul>
<li><a class="reference internal" href="#organizing-the-software-directory-tree">Organizing the software directory tree</a><ul>
<li><a class="reference internal" href="#distributing-just-a-module-file">Distributing just a module file</a></li>
<li><a class="reference internal" href="#distributing-a-package">Distributing a package</a></li>
</ul>
</li>
<li><a class="reference internal" href="#publishing-the-software-at-github">Publishing the software at GitHub</a></li>
<li><a class="reference internal" href="#downloading-and-installing-the-software">Downloading and installing the software</a><ul>
<li><a class="reference internal" href="#installing-just-a-module-file">Installing just a module file</a></li>
<li><a class="reference internal" href="#installing-a-package">Installing a package</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#classes-for-problem-and-solution-method">Classes for problem and solution method</a><ul>
<li><a class="reference internal" href="#the-problem-class">The problem class</a></li>
<li><a class="reference internal" href="#the-solver-class">The solver class</a><ul>
<li><a class="reference internal" href="#combining-the-objects">Combining the objects</a></li>
</ul>
</li>
<li><a class="reference internal" href="#improving-the-problem-and-solver-classes">Improving the problem and solver classes</a><ul>
<li><a class="reference internal" href="#a-generic-class-for-parameters">A generic class for parameters</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#automating-scientific-experiments">Automating scientific experiments</a><ul>
<li><a class="reference internal" href="#available-software">Available software</a></li>
<li><a class="reference internal" href="#the-results-we-want-to-produce">The results we want to produce</a></li>
<li><a class="reference internal" href="#combining-plot-files-2">Combining plot files  (2)</a></li>
<li><a class="reference internal" href="#running-a-program-from-python">Running a program from Python</a></li>
<li><a class="reference internal" href="#the-automating-script">The automating script</a></li>
<li><a class="reference internal" href="#making-a-report">Making a report</a><ul>
<li><a class="reference internal" href="#word-openoffice-googledocs">Word, OpenOffice, GoogleDocs</a></li>
<li><a class="reference internal" href="#html-with-mathjax">HTML with MathJax</a></li>
<li><a class="reference internal" href="#latex">LaTeX</a></li>
<li><a class="reference internal" href="#sphinx">Sphinx</a></li>
<li><a class="reference internal" href="#markdown">Markdown</a></li>
<li><a class="reference internal" href="#ipython-jupyter-notebooks">IPython/Jupyter notebooks</a></li>
<li><a class="reference internal" href="#wiki-formats">Wiki formats</a></li>
<li><a class="reference internal" href="#doconce">DocOnce</a></li>
</ul>
</li>
<li><a class="reference internal" href="#publishing-a-complete-project">Publishing a complete project</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercises-5">Exercises  (5)</a><ul>
<li><a class="reference internal" href="#problem-39-make-a-tool-for-differentiating-curves">Problem 39: Make a tool for differentiating curves</a></li>
<li><a class="reference internal" href="#problem-40-make-solid-software-for-the-trapezoidal-rule">Problem 40: Make solid software for the Trapezoidal rule</a></li>
<li><a class="reference internal" href="#problem-41-implement-classes-for-the-trapezoidal-rule">Problem 41: Implement classes for the Trapezoidal rule</a></li>
<li><a class="reference internal" href="#problem-42-write-a-doctest-and-a-test-function">Problem 42: Write a doctest and a test function</a></li>
<li><a class="reference internal" href="#problem-43-experiment-with-tolerances-in-comparisons">Problem 43: Experiment with tolerances in comparisons</a><ul>
<li><a class="reference internal" href="#remarks-2">Remarks  (2)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exercise-44-make-use-of-a-class-implementation">Exercise 44: Make use of a class implementation</a></li>
<li><a class="reference internal" href="#exercise-45-make-solid-software-for-a-difference-equation">Exercise 45: Make solid software for a difference equation</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="._book007.html"
                        title="previous chapter">Models</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="._book009.html"
                        title="next chapter">References</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/._book008.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="._book009.html" title="References"
             >next</a> |</li>
        <li class="right" >
          <a href="._book007.html" title="Models"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Finite Difference Computing with Exponential Decay Models</a> &raquo;</li> 
      </ul>
    </div>
<div class="wrapper">
  <div class="footer">
    <a href="http://cbc.simula.no"><img src="_static/cbc_banner.png" width="100%"><a>
    <br />
    <br />
      &copy;2015, Hans Petter Langtangen.
  </div>
</div>

  </body>
</html>
<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Finite Difference Computing with Exponential Decay Models">
<meta name="keywords" content="decay ODE,exponential decay,mesh,grid,mesh function,finite differences,forward difference,finite differences forward,difference equation,discrete equation,algebraic equation,finite difference scheme,Forward Euler scheme,backward difference,finite differences backward,backward scheme, 1-step,Backward Euler scheme,Crank-Nicolson scheme,centered difference,finite differences centered,averaging arithmetic,weighted average,theta-rule,$\theta$-rule,time step,finite difference operator notation,operator notation, finite differences,directory,folder,doc strings,printf format,format string syntax (Python),plotting curves,visualizing curves,representative (mesh function),array arithmetics,array computing,vectorization,continuous function norms,norm continuous,discrete function norms,mesh function norms,norm discrete (mesh function),error norms,scalar computing,PNG plot,PDF plot,EPS plot,viewing graphics files,cropping images,array arithmetics,array computing,vectorization,stability,amplification factor,A-stable methods,L-stable methods,interactive Python,error amplification factor,error global,consistency,stability,convergence,lambda functions,method of manufactured solutions,MMS (method of manufactured solutions),convergence rate,verification,implicit schemes,explicit schemes,theta-rule,$\theta$-rule,backward scheme, 2-step,BDF2 scheme,Leapfrog scheme,Leapfrog scheme, filtered,Heun's method,Runge-Kutta, 2nd-order method,Taylor-series methods (for ODEs),Adams-Bashforth scheme, 2nd-order,Adams-Bashforth scheme, 3rd order,Runge-Kutta, 4th-order method,RK4,adaptive time stepping,Dormand-Prince Runge-Kutta 4-5 method,population dynamics,logistic model,radioactive decay,chemical reactions irreversible,chemical reactions reversible,terminal velocity,geometric mean,averaging geometric,scaling,refactoring,importing modules,list comprehension,command-line arguments,option-value pairs (command line),command-line arguments,reading the command line,doctests,software testing doctests,unit testing,software testing nose,software testing pytest,test function,software testing test function,doctest in test function,unit testing,software testing unit testing (class-based),Distutils,GitHub,importing modules,problem class,solver class,wrapper (code),reproducibility,replicability,Unix wildcard notation,wildcard notation (Unix),Word (Microsoft),LibreOffice,OpenOffice,Google Docs,HTML,MathJax,LaTeX,Sphinx (typesetting tool),Markdown,IPython notebooks,Jupyter notebooks,DocOnce,replicability">

<title>Finite Difference Computing with Exponential Decay Models</title>

<!-- Bootstrap style: bootswatch_journal -->
<link href="http://netdna.bootstrapcdn.com/bootswatch/3.1.1/journal/bootstrap.min.css" rel="stylesheet">
<!-- not necessary
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->

<style type="text/css">
/* Let inline verbatim have the same color as the surroundings */
code { color: inherit; background-color: transparent; }
</style>


</head>

<!-- tocinfo
{'highest level': 0,
 'sections': [('Preface', 0, 'ch:preface', 'ch:preface'),
              ('Acknowledgments', 3, None, '___sec1'),
              ('Algorithms and implementations', 0, None, '___sec2'),
              ('Finite difference methods',
               1,
               'decay:basics',
               'decay:basics'),
              ('A basic model for exponential decay',
               2,
               'decay:model',
               'decay:model'),
              ('The exact solution', 3, None, '___sec5'),
              ('A complete problem formulation', 3, None, '___sec6'),
              ('The Forward Euler scheme',
               2,
               'decay:schemes:FE',
               'decay:schemes:FE'),
              ('Step 1: Discretizing the domain', 3, None, '___sec8'),
              ('Step 2: Fulfilling the equation at discrete time points',
               3,
               None,
               '___sec9'),
              ('Step 3: Replacing derivatives by finite differences',
               3,
               None,
               '___sec10'),
              ('Step 4: Formulating a recursive algorithm',
               3,
               None,
               '___sec11'),
              ('Interpretation', 3, None, '___sec12'),
              ('Computing with the recursive formula', 3, None, '___sec13'),
              ('The Backward Euler scheme',
               2,
               'decay:schemes:BE',
               'decay:schemes:BE'),
              ('The Crank-Nicolson scheme',
               2,
               'decay:schemes:CN',
               'decay:schemes:CN'),
              ('The unifying $\\theta$-rule',
               2,
               'decay:schemes:theta',
               'decay:schemes:theta'),
              ('Constant time step', 2, None, '___sec17'),
              ('Mathematical derivation of finite difference formulas',
               2,
               'decay:fd:taylor',
               'decay:fd:taylor'),
              ('The forward difference', 3, None, '___sec19'),
              ('The backward difference', 3, None, '___sec20'),
              ('The centered difference', 3, None, '___sec21'),
              ('Compact operator notation for finite differences',
               2,
               'decay:fd:op',
               'decay:fd:op'),
              ('Implementation', 1, 'decay:impl1', 'decay:impl1'),
              ('Computer language: Python', 2, None, '___sec24'),
              ('Making a solver function', 2, 'decay:py1', 'decay:py1'),
              ('Integer division', 2, None, '___sec26'),
              ('Doc strings', 2, None, '___sec27'),
              ('Formatting numbers', 2, None, '___sec28'),
              ('Running the program', 2, None, '___sec29'),
              ('Plotting the solution', 2, None, '___sec30'),
              ('Verifying the implementation', 2, None, '___sec31'),
              ('Running a few algorithmic steps by hand',
               3,
               None,
               '___sec32'),
              ('Computing the numerical error as a mesh function',
               2,
               'decay:computing:error',
               'decay:computing:error'),
              ('Computing the norm of the error mesh function',
               2,
               'decay:computing:error:norm',
               'decay:computing:error:norm'),
              ('Scalar computing', 3, None, '___sec35'),
              ('Experiments with computing and plotting',
               2,
               None,
               '___sec36'),
              ('Combining plot files', 3, None, '___sec37'),
              ('Plotting with SciTools', 3, None, '___sec38'),
              ('Memory-saving implementation', 2, None, '___sec39'),
              ('Exercises', 1, None, '___sec40'),
              ('Exercise 1: Define a mesh function and visualize it',
               2,
               'decay:exer:meshfunc',
               'decay:exer:meshfunc'),
              ('Remarks', 3, None, '___sec42'),
              ('Exercise 2: Differentiate a function',
               2,
               'decay:exer:dudt',
               'decay:exer:dudt'),
              ('Exercise 3: Experiment with divisions',
               2,
               'decay:exer:intdiv',
               'decay:exer:intdiv'),
              ('Exercise 4: Experiment with wrong computations',
               2,
               'decay:exer:decay1err',
               'decay:exer:decay1err'),
              ('Exercise 5: Plot the error function',
               2,
               'decay:exer:plot:error',
               'decay:exer:plot:error'),
              ('Exercise 6: Change formatting of numbers and debug',
               2,
               'decay:exer:inexact:output',
               'decay:exer:inexact:output'),
              ('Analysis', 0, 'decay:analysis', 'decay:analysis'),
              ('Experimental investigations', 1, None, '___sec49'),
              ('Discouraging numerical solutions', 2, None, '___sec50'),
              ('Detailed experiments', 2, None, '___sec51'),
              ('Stability', 1, None, '___sec52'),
              ('Exact numerical solution', 2, None, '___sec53'),
              ('Stability properties derived from the amplification factor',
               2,
               None,
               '___sec54'),
              ('Accuracy', 1, None, '___sec55'),
              ('Visual comparison of amplification factors',
               2,
               None,
               '___sec56'),
              ('Series expansion of amplification factors',
               2,
               None,
               '___sec57'),
              ('The ratio of numerical and exact amplification factors',
               2,
               None,
               '___sec58'),
              ('The global error at a point',
               2,
               'decay:analysis:gobal:error',
               'decay:analysis:gobal:error'),
              ('Integrated error',
               2,
               'decay:analysis:gobal:error_int',
               'decay:analysis:gobal:error_int'),
              ('Truncation error',
               2,
               'decay:analysis:trunc',
               'decay:analysis:trunc'),
              ('Consistency, stability, and convergence',
               2,
               None,
               '___sec62'),
              ('Exercises', 1, None, '___sec63'),
              ('Exercise 7: Visualize the accuracy of finite differences',
               2,
               'decay:analysis:exer:fd:exp:plot',
               'decay:analysis:exer:fd:exp:plot'),
              ('Exercise 8: Explore the $\\theta$-rule for exponential growth',
               2,
               'decay:analysis:exer:growth',
               'decay:analysis:exer:growth'),
              ('Generalizations', 0, None, '___sec66'),
              ('Model extensions', 1, None, '___sec67'),
              ('Generalization: including a variable coefficient',
               2,
               None,
               '___sec68'),
              ('Generalization: including a source term',
               2,
               'decay:source',
               'decay:source'),
              ('Implementation of the generalized model problem',
               2,
               'decay:general',
               'decay:general'),
              ('Deriving the $\\theta$-rule formula', 3, None, '___sec71'),
              ('Python code', 3, None, '___sec72'),
              ('Coding of variable coefficients', 3, None, '___sec73'),
              ('Verifying a constant solution',
               2,
               'decay:verify:trivial',
               'decay:verify:trivial'),
              ('Verification via manufactured solutions',
               2,
               'decay:MMS',
               'decay:MMS'),
              ('Computing convergence rates',
               2,
               'decay:convergence:rate',
               'decay:convergence:rate'),
              ('Estimating $r$', 3, None, '___sec77'),
              ('Implementation', 3, None, '___sec78'),
              ('Extension to systems of ODEs', 2, None, '___sec79'),
              ('General first-order ODEs', 1, None, '___sec80'),
              ('Generic form of first-order ODEs', 2, None, '___sec81'),
              ('The $\\theta$-rule', 2, None, '___sec82'),
              ('An implicit 2-step backward scheme', 2, None, '___sec83'),
              ('Leapfrog schemes', 2, None, '___sec84'),
              ('The ordinary Leapfrog scheme', 3, None, '___sec85'),
              ('The filtered Leapfrog scheme', 3, None, '___sec86'),
              ('The 2nd-order Runge-Kutta method', 2, None, '___sec87'),
              ('A 2nd-order Taylor-series method', 2, None, '___sec88'),
              ('The 2nd- and 3rd-order Adams-Bashforth schemes',
               2,
               None,
               '___sec89'),
              ('The 4th-order Runge-Kutta method',
               2,
               'decay:fd2:RK4',
               'decay:fd2:RK4'),
              ('The Odespy software', 2, None, '___sec91'),
              ('Example: Runge-Kutta methods', 2, None, '___sec92'),
              ('Remark about using the $\\theta$-rule in Odespy',
               3,
               None,
               '___sec93'),
              ('Example: Adaptive Runge-Kutta methods',
               2,
               'decay:fd2:adaptiveRK',
               'decay:fd2:adaptiveRK'),
              ('Exercises', 1, None, '___sec95'),
              ('Exercise 9: Experiment with precision in tests and the size of $u$',
               2,
               'decay:fd2:exer:precision',
               'decay:fd2:exer:precision'),
              ('Exercise 10: Implement the 2-step backward scheme',
               2,
               'decay:fd2:exer:bw2',
               'decay:fd2:exer:bw2'),
              ('Exercise 11: Implement the 2nd-order Adams-Bashforth scheme',
               2,
               'decay:fd2:exer:AB2',
               'decay:fd2:exer:AB2'),
              ('Exercise 12: Implement the 3rd-order Adams-Bashforth scheme',
               2,
               'decay:fd2:exer:AB3',
               'decay:fd2:exer:AB3'),
              ('Exercise 13: Analyze explicit 2nd-order methods',
               2,
               'decay:exer:RK2:Taylor:analysis',
               'decay:exer:RK2:Taylor:analysis'),
              ('Project 14: Implement and investigate the Leapfrog scheme',
               2,
               'decay:fd2:exer:leapfrog1',
               'decay:fd2:exer:leapfrog1'),
              ('Problem 15: Make a unified implementation of many schemes',
               2,
               'decay:fd2:exer:uni',
               'decay:fd2:exer:uni'),
              ('Models', 0, 'decay:app', 'decay:app'),
              ('Scaling', 1, 'decay:app:scaling', 'decay:app:scaling'),
              ('Dimensionless variables', 2, None, '___sec105'),
              ('Dimensionless numbers', 2, None, '___sec106'),
              ('A scaling for vanishing initial condition',
               2,
               None,
               '___sec107'),
              ('Evolution of a population',
               1,
               'decay:app:pop',
               'decay:app:pop'),
              ('Exponential growth', 2, None, '___sec109'),
              ('Logistic growth', 2, None, '___sec110'),
              ('Compound interest and inflation',
               1,
               'decay:app:interest',
               'decay:app:interest'),
              ("Newton's law of cooling",
               1,
               'decay:app:Newton:cooling',
               'decay:app:Newton:cooling'),
              ('Radioactive decay',
               1,
               'decay:app:nuclear',
               'decay:app:nuclear'),
              ('Deterministic model', 2, None, '___sec114'),
              ('Stochastic model', 2, None, '___sec115'),
              ('Relation between stochastic and deterministic models',
               2,
               None,
               '___sec116'),
              ('Generalization of the radioactive decay modeling',
               2,
               'decay:app:waitingtime',
               'decay:app:waitingtime'),
              ('Chemical kinetics',
               1,
               'decay:app:kinetics',
               'decay:app:kinetics'),
              ('Irreversible reaction of two substances',
               2,
               None,
               '___sec119'),
              ('Reversible reaction of two substances', 2, None, '___sec120'),
              ('Irreversible reaction of two substances into a third',
               2,
               None,
               '___sec121'),
              ('A biochemical reaction', 2, None, '___sec122'),
              ('Spreading of diseases', 1, 'decay:app:SIR', 'decay:app:SIR'),
              ('Decay of atmospheric pressure with altitude',
               1,
               'decay:app:atm',
               'decay:app:atm'),
              ('The general model', 2, None, '___sec125'),
              ('Multiple atmospheric layers', 2, None, '___sec126'),
              ('Simplifications', 2, None, '___sec127'),
              ('Constant layer temperature', 3, None, '___sec128'),
              ('One-layer model', 3, None, '___sec129'),
              ('Compaction of sediments',
               1,
               'decay:app:sediment',
               'decay:app:sediment'),
              ('Vertical motion of a body in a viscous fluid',
               1,
               'decay:app:drag',
               'decay:app:drag'),
              ('Overview of forces', 2, None, '___sec132'),
              ('Equation of motion', 2, None, '___sec133'),
              ('Terminal velocity', 2, None, '___sec134'),
              ('A Crank-Nicolson scheme', 2, None, '___sec135'),
              ('Physical data', 2, None, '___sec136'),
              ('Verification', 2, None, '___sec137'),
              ('Scaling',
               2,
               'decay:app:drag:scaling',
               'decay:app:drag:scaling'),
              ('Decay ODEs from solving a PDE by Fourier expansions',
               1,
               'decay:app:diffusion:Fourier',
               'decay:app:diffusion:Fourier'),
              ('Exercises', 1, None, '___sec140'),
              ('Exercise 16: Radioactive decay of Carbon-14',
               2,
               'decay:app:exer:radio:C14',
               'decay:app:exer:radio:C14'),
              ("Exercise 17: Derive schemes for Newton's law of cooling",
               2,
               'decay:app:exer:cooling:schemes',
               'decay:app:exer:cooling:schemes'),
              ("Exercise 18: Implement schemes for Newton's law of cooling",
               2,
               'decay:app:exer:cooling:py',
               'decay:app:exer:cooling:py'),
              ('Bug 1: Wrong time level in the $T_s$ function',
               3,
               None,
               '___sec144'),
              ('Bug 2: Wrong time level in the $T$ function',
               3,
               None,
               '___sec145'),
              ('Bug 3: Missing $\\theta$ in a term', 3, None, '___sec146'),
              ('Bug 4: Missing `k` in the updating formula',
               3,
               None,
               '___sec147'),
              ('Bug 5: Using `1-theta` instead of `theta`',
               3,
               None,
               '___sec148'),
              ('Exercise 19: Find time of murder from body temperature',
               2,
               'decay:app:exer:cooling:murder',
               'decay:app:exer:cooling:murder'),
              ('Exercise 20: Simulate an oscillating cooling process',
               2,
               'decay:app:exer:cooling:osc',
               'decay:app:exer:cooling:osc'),
              ('Exercise 21: Simulate stochastic radioactive decay',
               2,
               'decay:app:exer:stoch:nuclear',
               'decay:app:exer:stoch:nuclear'),
              ('Exercise 22: Radioactive decay of two substances',
               2,
               'decay:app:exer:radio:twosubst',
               'decay:app:exer:radio:twosubst'),
              ('Exercise 23: Simulate a simple chemical reaction',
               2,
               'decay:app:exer:kinetics:AB',
               'decay:app:exer:kinetics:AB'),
              ('Exercise 24: Simulate an $n$-th order chemical reaction',
               2,
               'decay:app:exer:kinetics:ABn',
               'decay:app:exer:kinetics:ABn'),
              ('Exercise 25: Simulate spreading of a disease',
               2,
               'decay:app:exer:SIR',
               'decay:app:exer:SIR'),
              ('Exercise 26: Simulate a biochemical process',
               2,
               'decay:app:exer:MMK',
               'decay:app:exer:MMK'),
              ('Exercise 27: Simulate the pressure drop in the atmosphere',
               2,
               'decay:app:exer:atm1',
               'decay:app:exer:atm1'),
              ('Exercise 28: Make a program for vertical motion in a fluid',
               2,
               'decay:app:exer:drag:prog',
               'decay:app:exer:drag:prog'),
              ('Project 29: Simulate parachuting',
               2,
               'decay:app:exer:parachute',
               'decay:app:exer:parachute'),
              ('Exercise 30: Formulate vertical motion in the atmosphere',
               2,
               'decay:app:exer:drag:atm1',
               'decay:app:exer:drag:atm1'),
              ('Exercise 31: Simulate vertical motion in the atmosphere',
               2,
               'decay:app:exer:drag:atm2',
               'decay:app:exer:drag:atm2'),
              ('Exercise 32: Compute $y=|x|$ by solving an ODE',
               2,
               'decay:app:exer:signum',
               'decay:app:exer:signum'),
              ('Exercise 33: Simulate fortune growth with random interest rate',
               2,
               'decay:app:exer:interest',
               'decay:app:exer:interest'),
              ('Exercise 34: Simulate a population in a changing environment',
               2,
               'decay:app:exer:pop:at',
               'decay:app:exer:pop:at'),
              ('Exercise 35: Simulate logistic growth',
               2,
               'decay:app:exer:pop:logistic1',
               'decay:app:exer:pop:logistic1'),
              ('Exercise 36: Rederive the equation for continuous compound interest',
               2,
               'decay:app:exer:interest:derive',
               'decay:app:exer:interest:derive'),
              ('Scientific software engineering', 0, 'decay:se', 'decay:se'),
              ('Basic implementations',
               1,
               'softeng1:basic',
               'softeng1:basic'),
              ('Mathematical problem and solution technique',
               2,
               'softeng1:basic:math',
               'softeng1:basic:math'),
              ('A first, quick implementation',
               2,
               'softeng1:basic:impl1',
               'softeng1:basic:impl1'),
              ('A more decent program',
               2,
               'softeng1:basic:impl2',
               'softeng1:basic:impl2'),
              ('Comments in a program', 3, None, '___sec172'),
              ('Refactoring into functions', 3, None, '___sec173'),
              ('Program file vs IDE vs notebook', 3, None, '___sec174'),
              ('Prefixing imported functions by the module name',
               2,
               'softeng1:basic:modprefix',
               'softeng1:basic:modprefix'),
              ('Implementing the numerical algorithm in a function',
               2,
               'softeng1:basic:func',
               'softeng1:basic:func'),
              ('Do not have several versions of a code',
               2,
               None,
               '___sec177'),
              ('Making a module',
               2,
               'softeng1:basic:module',
               'softeng1:basic:module'),
              ('Example on extending the module code',
               2,
               'softeng1:basic:experiment2',
               'softeng1:basic:experiment2'),
              ('Documenting functions and modules',
               2,
               'softeng1:basic:docstring',
               'softeng1:basic:docstring'),
              ('User interfaces',
               1,
               'softeng1:basic:UI',
               'softeng1:basic:UI'),
              ('Command-line arguments', 2, None, '___sec182'),
              ('Positional command-line arguments', 2, None, '___sec183'),
              ('Option-value pairs on the command line',
               2,
               None,
               '___sec184'),
              ('Creating a graphical web user interface',
               2,
               None,
               '___sec185'),
              ('Making a compute function', 3, None, '___sec186'),
              ('Generating the user interface', 3, None, '___sec187'),
              ('Running the web application', 3, None, '___sec188'),
              ('Tests for verifying implementations', 1, None, '___sec189'),
              ('Doctests', 2, None, '___sec190'),
              ('Unit tests and test functions', 2, None, '___sec191'),
              ('Two Python test frameworks: nose and pytest',
               3,
               None,
               '___sec192'),
              ('Test function requirements', 3, None, '___sec193'),
              ('Comparison of real numbers', 3, None, '___sec194'),
              ('Special assert functions from nose', 3, None, '___sec195'),
              ('Locating test functions', 3, None, '___sec196'),
              ('Running tests', 3, None, '___sec197'),
              ('Embedding doctests in a test function', 3, None, '___sec198'),
              ('Installing nose and pytest', 3, None, '___sec199'),
              ('Test function for the solver', 2, None, '___sec200'),
              ('Test function for reading positional command-line arguments',
               2,
               None,
               '___sec201'),
              ('Test function for reading option-value pairs',
               2,
               None,
               '___sec202'),
              ('Classical class-based unit testing',
               2,
               'softeng1:basic:unittest',
               'softeng1:basic:unittest'),
              ('Sharing the software with other users',
               1,
               'softeng1:prog:se:git',
               'softeng1:prog:se:git'),
              ('Organizing the software directory tree',
               2,
               None,
               '___sec205'),
              ('Distributing just a module file', 3, None, '___sec206'),
              ('Distributing a package', 3, None, '___sec207'),
              ('Publishing the software at GitHub', 2, None, '___sec208'),
              ('Downloading and installing the software',
               2,
               None,
               '___sec209'),
              ('Installing just a module file', 3, None, '___sec210'),
              ('Installing a package', 3, None, '___sec211'),
              ('Classes for problem and solution method',
               1,
               'softeng1:prog:se:class',
               'softeng1:prog:se:class'),
              ('The problem class', 2, None, '___sec213'),
              ('The solver class', 2, None, '___sec214'),
              ('Combining the objects', 3, None, '___sec215'),
              ('Improving the problem and solver classes',
               2,
               'softeng1:prog:se:class2',
               'softeng1:prog:se:class2'),
              ('A generic class for parameters', 3, None, '___sec217'),
              ('Automating scientific experiments',
               1,
               'softeng1:experiments',
               'softeng1:experiments'),
              ('Available software', 2, None, '___sec219'),
              ('The results we want to produce', 2, None, '___sec220'),
              ('Combining plot files', 2, None, '___sec221'),
              ('Running a program from Python', 2, None, '___sec222'),
              ('The automating script', 2, None, '___sec223'),
              ('Making a report',
               2,
               'softeng1:exper:report',
               'softeng1:exper:report'),
              ('Word, OpenOffice, GoogleDocs', 3, None, '___sec225'),
              ('HTML with MathJax', 3, None, '___sec226'),
              ('LaTeX', 3, None, '___sec227'),
              ('Sphinx', 3, None, '___sec228'),
              ('Markdown', 3, None, '___sec229'),
              ('IPython/Jupyter notebooks', 3, None, '___sec230'),
              ('Wiki formats', 3, None, '___sec231'),
              ('DocOnce', 3, None, '___sec232'),
              ('Publishing a complete project',
               2,
               'softeng1:exper:github',
               'softeng1:exper:github'),
              ('Exercises', 1, None, '___sec234'),
              ('Problem 37: Make a tool for differentiating curves',
               2,
               'softeng1:exer:derivative',
               'softeng1:exer:derivative'),
              ('Problem 38: Make solid software for the Trapezoidal rule',
               2,
               'softeng1:exer:integral:flat',
               'softeng1:exer:integral:flat'),
              ('Problem 39: Implement classes for the Trapezoidal rule',
               2,
               'softeng1:exer:integral:flat2',
               'softeng1:exer:integral:flat2'),
              ('Problem 40: Write a doctest and a test function',
               2,
               'softeng1:exer:doctest1',
               'softeng1:exer:doctest1'),
              ('Problem 41: Experiment with tolerances in comparisons',
               2,
               'softeng1:exer:tol',
               'softeng1:exer:tol'),
              ('Remarks', 3, None, '___sec240'),
              ('Exercise 42: Make use of a class implementation',
               2,
               'softeng1:exer:class:dts',
               'softeng1:exer:class:dts'),
              ('Exercise 43: Make solid software for a difference equation',
               2,
               'softeng1:exer:logistic',
               'softeng1:exer:logistic'),
              ('References', 1, None, '___sec243')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="decay-book.html">Finite Difference Computing with Exponential Decay Models</a>
  </div>
  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="._decay-book001.html#ch:preface" style="font-size: 80%;">Preface</a></li>
     <!-- navigation toc: --> <li><a href="._decay-book002.html#___sec2" style="font-size: 80%;">Algorithms and implementations</a></li>
     <!-- navigation toc: --> <li><a href="._decay-book005.html#decay:analysis" style="font-size: 80%;">Analysis</a></li>
     <!-- navigation toc: --> <li><a href="._decay-book006.html#___sec66" style="font-size: 80%;">Generalizations</a></li>
     <!-- navigation toc: --> <li><a href="._decay-book007.html#decay:app" style="font-size: 80%;">Models</a></li>
     <!-- navigation toc: --> <li><a href="._decay-book008.html#decay:se" style="font-size: 80%;">Scientific software engineering</a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->

<div class="container">

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->

<a name="part0014"></a>
<!-- !split -->

<h1 id="softeng1:experiments">Automating scientific experiments</h1>

<p>
Empirical scientific investigations based on running computer programs
require careful design of the experiments and accurate reporting of results.
Although there is a strong tradition to do such investigations manually,
the extreme requirements to scientific accuracy make a program much
better suited to conduct the experiments. We shall in this section outline
how we can write such programs, often called <em>scripts</em>, for running other
programs and archiving the results.

<p>
<div class="alert alert-block alert-success alert-text-normal"><b>Scientific investigation.</b>
The purpose of the investigations is to explore the quality of numerical
solutions to an ordinary differential equation. More specifically, we
solve the initial-value problem

$$
\begin{equation}
u^\prime(t) = -au(t),\quad u(0)=I,\quad t\in (0,T],
\tag{115}
\end{equation}
$$

by the \( \theta \)-rule:

$$
\begin{equation}
u^{n+1} = \frac{1 - (1-\theta) a\Delta t}{1 + \theta a\Delta t}u^n,
\quad u^0=I\tp
\tag{116}
\end{equation}
$$

This scheme corresponds to well-known methods: \( \theta=0 \) gives the
Forward Euler (FE) scheme, \( \theta=1 \) gives the Backward Euler (BE) scheme,
and \( \theta=\frac{1}{2} \) gives the Crank-Nicolson
(CN) or midpoint/centered scheme.

<p>
For chosen constants \( I \), \( a \), and \( T \), we run the three schemes for various
values of \( \Delta t \), and present the following results in a report:

<ol>
<li> visual comparison of the numerical and exact solution in a plot for
   each \( \Delta t \) and \( \theta=0,1,\frac{1}{2} \),</li>
<li> a table and a plot of the norm of the numerical error versus \( \Delta t \)
   for \( \theta=0,1,\frac{1}{2} \).</li>
</ol>

The report will also document the mathematical details of the problem under
investigation.
</div>


<h2 id="___sec219">Available software </h2>

<p>
Appropriate software for implementing <a href="#mjx-eqn-116">(116)</a>
is available in a program <a href="http://tinyurl.com/nc4upel/doconce_src/model.py" target="_self"><tt>model.py</tt></a>, which is run as

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; python model.py --I 1.5 --a 0.25 --T 6 --dt 1.25 0.75 0.5
</pre></div>
<p>
The command-line input corresponds to setting \( I=1.5 \), \( a=0.25 \), \( T=6 \),
and run three values of \( \Delta t \): 1.25, 0.75, ad 0.5.

<p>
The results of running this <code>model.py</code> command are text in the
terminal window and a set of plot files.
The plot files have names <code>M_D.E</code>, where <code>M</code> denotes the method
(<code>FE</code>, <code>BE</code>, <code>CN</code> for \( \theta=0,1,\frac{1}{2} \), respectively), <code>D</code>
the time step length (here <code>1.25</code>, <code>0.75</code>, or <code>0.5</code>), and <code>E</code>
is the plot file extension <code>png</code> or <code>pdf</code>.
The text output in the terminal window looks like

<p>

<!-- code=text typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">0.0   1.25:    5.998E-01
0.0   0.75:    1.926E-01
0.0   0.50:    1.123E-01
0.0   0.10:    1.558E-02
0.5   1.25:    6.231E-02
0.5   0.75:    1.543E-02
0.5   0.50:    7.237E-03
0.5   0.10:    2.469E-04
1.0   1.25:    1.766E-01
1.0   0.75:    8.579E-02
1.0   0.50:    6.884E-02
1.0   0.10:    1.411E-02
</pre></div>
<p>
The first column is the \( \theta \) value, the next the \( \Delta t \) value,
and the final column represents the numerical error \( E \) (the
norm of discrete error function on the mesh).

<h2 id="___sec220">The results we want to produce </h2>

<p>
The results we need for our investigations are slightly different than
what is directly produced by <code>model.py</code>:

<ol>
<li> We need to collect all the plots for one
   numerical method (FE, BE, CN) in a single plot.
   For example, if 4 \( \Delta t \) values are run, the summarizing plot
   for the BE method has \( 2\times 2 \) subplots, with the subplot corresponding
   to the largest \( \Delta t \) in the upper left corner and the smallest
   in the bottom right corner.</li>
<li> We need to create a table containing
   \( \Delta t \) values in the first column and the numerical error
   \( E \) for \( \theta=0,0.5,1 \)
   in the next three columns. This table should be available as a
   standard CSV file.</li>
<li> We need to plot the numerical error \( E \) versus \( \Delta t \)
   in a log-log plot.</li>
</ol>

Consequently, we must write a script that can run <code>model.py</code> as described and
produce the results 1-3 above. This requires combining multiple plot files into
one file and interpreting the output from <code>model.py</code> as data for plotting and
file storage.

<p>
If the script's name is <code>exper1.py</code>, we run it with the desired \( \Delta t \)
values as positional command-line arguments:

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; python exper1.py 0.5 0.25 0.1 0.05
</pre></div>
<p>
This run will then generate eight plot files: <code>FE.png</code> and <code>FE.pdf</code> summarizing
the plots with the FE method, <code>BE.png</code> and <code>BE.pdf</code> with
the BE method, <code>CN.png</code> and <code>CN.pdf</code> with the CN method, and <code>error.png</code>
and <code>error.pdf</code> with the log-log plot of the numerical error versus \( \Delta t \).
In addition, the table with numerical errors is written to a
file <code>error.csv</code>.

<p>
<div class="alert alert-block alert-danger alert-text-normal"><b>Reproducible and replicable science.</b>
A script that automates running our computer experiments
will ensure
that the experiments can easily be rerun by anyone in
the future, either to confirm the same results or redo the experiments with
other input data.
Also, whatever we did to produce the results is
documented in every detail in the script.

<p>
A project where anyone can easily repeat the experiments with the same data
is referred to as being <em>replicable</em>, and replicability
should be a fundamental requirement in scientific computing work.
Of more scientific interest is <em>reproducibilty</em>, which means that we can
also run alternative experiments to arrive at the same conclusions.
This requires more than an automating script.
</div>


<h2 id="___sec221">Combining plot files </h2>

<p>
The script for running experiments needs to combine multiple image
files into one. The
<a href="http://www.imagemagick.org/script/montage.php" target="_self"><tt>montage</tt></a>
and
<a href="http://www.imagemagick.org/script/convert.php" target="_self"><tt>convert</tt></a> programs in
the ImageMagick software suite
can be used to combine image files.
However, these programs are best suited for
PNG files. For vector plots in PDF format one needs other tools
to preserve the quality: <code>pdftk</code>, <code>pdfnup</code>, and <code>pdfcrop</code>.

<p>
Suppose you have four files <code>f1.png</code>, <code>f2.png</code>, <code>f3.png</code>, and <code>f4.png</code>
and want to combine them into a \( 2\times 2 \) table of subplots in a new
file <code>f.png</code>, see
Figure <a href="#softeng1:experiments:fig:BE4a">23</a> for an example.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 23:  Illustration of the Backward Euler method for four time step values. <div id="softeng1:experiments:fig:BE4a"></div> </p></center>
<p><img src="fig-softeng/BE4a.png" align="bottom" width=600></p>
</center>

<p>
The appropriate ImageMagick commands are

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; montage -background white -geometry 100% -tile 2x \ 
          f1.png f2.png f3.png f4.png f.png
Terminal&gt; convert -trim f.png f.png
Terminal&gt; convert f.png -transparent white f.png
</pre></div>
<p>
The first command mounts the four files in one, the next <code>convert</code> command
removes unnecessary surrounding white space, and the final <code>convert</code> command
makes the white background transparent.

<p>
High-quality montage of PDF files <code>f1.pdf</code>,
<code>f2.pdf</code>, <code>f3.pdf</code>, and <code>f4.pdf</code> into <code>f.pdf</code> goes like

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; pdftk f1.pdf f2.pdf f3.pdf f4.pdf output tmp.pdf
Terminal&gt; pdfnup --nup 2x2 --outfile tmp.pdf tmp.pdf
Terminal&gt; pdfcrop tmp.pdf f.pdf
Terminal&gt; rm -f tmp.pdf
</pre></div>

<h2 id="___sec222">Running a program from Python </h2>

<p>
The script for automating experiments needs to run the <code>model.py</code> program
with appropriate command-line options. Python has several tools for
executing an arbitrary command in the operating systems.
Let <code>cmd</code> be a string containing the desired command.
In the present case study, <code>cmd</code> could be <code>'python model.py --I 1 --dt 0.5 0.2'</code>.
The following code
executes <code>cmd</code> and loads the text output into a string <code>output</code>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">subprocess</span> <span style="color: #008000; font-weight: bold">import</span> Popen, PIPE, STDOUT
p <span style="color: #666666">=</span> Popen(cmd, shell<span style="color: #666666">=</span><span style="color: #008000">True</span>, stdout<span style="color: #666666">=</span>PIPE, stderr<span style="color: #666666">=</span>STDOUT)
output, _ <span style="color: #666666">=</span> p<span style="color: #666666">.</span>communicate()

<span style="color: #408080; font-style: italic"># Check if the execution was successful</span>
failure <span style="color: #666666">=</span> p<span style="color: #666666">.</span>returncode
<span style="color: #008000; font-weight: bold">if</span> failure:
    <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;Command failed:&#39;</span>, cmd; sys<span style="color: #666666">.</span>exit(<span style="color: #666666">1</span>)
</pre></div>
<p>
Unsuccessful execution usually makes it meaningless to continue
the program, and therefore we abort the program with <code>sys.exit(1)</code>.
Any argument different from 0 signifies to the computer's operating system
that our program stopped with a failure.

<p>
<div class="alert alert-block alert-success alert-text-normal"><b>Programming tip: use <code>_</code> for dummy variable.</b>
Sometimes we need to unpack tuples or lists in separate variables,
but we are not interested in all the variables. One example is

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%">output, error <span style="color: #666666">=</span> p<span style="color: #666666">.</span>communicate()
</pre></div>
<p>
but <code>error</code> is of no interest.
One can then use underscore <code>_</code> as variable name for the dummy
(uninteresting) variable(s):

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%">output, _ <span style="color: #666666">=</span> p<span style="color: #666666">.</span>communicate()
</pre></div>
<p>
Here is another example where we iterate over a list of three-tuples,
but the interest is limited to the second element in each three-tuple:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">for</span> _, value, _ <span style="color: #AA22FF; font-weight: bold">in</span> list_of_three_tuples:
    <span style="color: #408080; font-style: italic"># work with value</span>
</pre></div>
<p>
</div>


<p>
We need to interpret the contents of the string
<code>output</code> and store
the data in an appropriate data structure for further processing.
Since the content is basically a table and will be transformed to
a spread sheet format, we let the columns in the table be represented
by lists in the program,
and we collect these columns in a dictionary whose keys are natural
column names: <code>dt</code> and the three values of \( \theta \).
The following code translates the output of <code>cmd</code> (<code>output</code>)
to such a dictionary of lists (<code>errors</code>):

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">errors <span style="color: #666666">=</span> {<span style="color: #BA2121">&#39;dt&#39;</span>: dt_values, <span style="color: #666666">1</span>: [], <span style="color: #666666">0</span>: [], <span style="color: #666666">0.5</span>: []}
<span style="color: #008000; font-weight: bold">for</span> line <span style="color: #AA22FF; font-weight: bold">in</span> output<span style="color: #666666">.</span>splitlines():
    words <span style="color: #666666">=</span> line<span style="color: #666666">.</span>split()
    <span style="color: #008000; font-weight: bold">if</span> words[<span style="color: #666666">0</span>] <span style="color: #AA22FF; font-weight: bold">in</span> (<span style="color: #BA2121">&#39;0.0&#39;</span>, <span style="color: #BA2121">&#39;0.5&#39;</span>, <span style="color: #BA2121">&#39;1.0&#39;</span>):  <span style="color: #408080; font-style: italic"># line with E?</span>
        <span style="color: #408080; font-style: italic"># typical line: 0.0   1.25:    7.463E+00</span>
        theta <span style="color: #666666">=</span> <span style="color: #008000">float</span>(words[<span style="color: #666666">0</span>])
        E <span style="color: #666666">=</span> <span style="color: #008000">float</span>(words[<span style="color: #666666">2</span>])
        errors[theta]<span style="color: #666666">.</span>append(E)
</pre></div>

<h2 id="___sec223">The automating script </h2>

<p>
We have now all the core elements in place to write the complete
script where we run
<code>model.py</code> for a set of \( \Delta t \) values (given as positional
command-line arguments), make the error plot,
write the CSV file, and combine plot files as described above.
The complete code is listed below, followed by some explaining comments.

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">os</span><span style="color: #666666">,</span> <span style="color: #0000FF; font-weight: bold">sys</span><span style="color: #666666">,</span> <span style="color: #0000FF; font-weight: bold">glob</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">run_experiments</span>(I<span style="color: #666666">=1</span>, a<span style="color: #666666">=2</span>, T<span style="color: #666666">=5</span>):
    <span style="color: #408080; font-style: italic"># The command line must contain dt values</span>
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">len</span>(sys<span style="color: #666666">.</span>argv) <span style="color: #666666">&gt;</span> <span style="color: #666666">1</span>:
        dt_values <span style="color: #666666">=</span> [<span style="color: #008000">float</span>(arg) <span style="color: #008000; font-weight: bold">for</span> arg <span style="color: #AA22FF; font-weight: bold">in</span> sys<span style="color: #666666">.</span>argv[<span style="color: #666666">1</span>:]]
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;Usage: </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121"> dt1 dt2 dt3 ...&#39;</span> <span style="color: #666666">%</span>  sys<span style="color: #666666">.</span>argv[<span style="color: #666666">0</span>]
        sys<span style="color: #666666">.</span>exit(<span style="color: #666666">1</span>)  <span style="color: #408080; font-style: italic"># abort</span>

    <span style="color: #408080; font-style: italic"># Run module file and grab output</span>
    cmd <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;python model.py --I </span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121"> --a </span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121"> --T </span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> (I, a, T)
    dt_values_str <span style="color: #666666">=</span> <span style="color: #BA2121">&#39; &#39;</span><span style="color: #666666">.</span>join([<span style="color: #008000">str</span>(v) <span style="color: #008000; font-weight: bold">for</span> v <span style="color: #AA22FF; font-weight: bold">in</span> dt_values])
    cmd <span style="color: #666666">+=</span> <span style="color: #BA2121">&#39; --dt </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> dt_values_str
    <span style="color: #008000; font-weight: bold">print</span> cmd
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">subprocess</span> <span style="color: #008000; font-weight: bold">import</span> Popen, PIPE, STDOUT
    p <span style="color: #666666">=</span> Popen(cmd, shell<span style="color: #666666">=</span><span style="color: #008000">True</span>, stdout<span style="color: #666666">=</span>PIPE, stderr<span style="color: #666666">=</span>STDOUT)
    output, _ <span style="color: #666666">=</span> p<span style="color: #666666">.</span>communicate()
    failure <span style="color: #666666">=</span> p<span style="color: #666666">.</span>returncode
    <span style="color: #008000; font-weight: bold">if</span> failure:
        <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;Command failed:&#39;</span>, cmd; sys<span style="color: #666666">.</span>exit(<span style="color: #666666">1</span>)

    errors <span style="color: #666666">=</span> {<span style="color: #BA2121">&#39;dt&#39;</span>: dt_values, <span style="color: #666666">1</span>: [], <span style="color: #666666">0</span>: [], <span style="color: #666666">0.5</span>: []}
    <span style="color: #008000; font-weight: bold">for</span> line <span style="color: #AA22FF; font-weight: bold">in</span> output<span style="color: #666666">.</span>splitlines():
        words <span style="color: #666666">=</span> line<span style="color: #666666">.</span>split()
        <span style="color: #008000; font-weight: bold">if</span> words[<span style="color: #666666">0</span>] <span style="color: #AA22FF; font-weight: bold">in</span> (<span style="color: #BA2121">&#39;0.0&#39;</span>, <span style="color: #BA2121">&#39;0.5&#39;</span>, <span style="color: #BA2121">&#39;1.0&#39;</span>):  <span style="color: #408080; font-style: italic"># line with E?</span>
            <span style="color: #408080; font-style: italic"># typical line: 0.0   1.25:    7.463E+00</span>
            theta <span style="color: #666666">=</span> <span style="color: #008000">float</span>(words[<span style="color: #666666">0</span>])
            E <span style="color: #666666">=</span> <span style="color: #008000">float</span>(words[<span style="color: #666666">2</span>])
            errors[theta]<span style="color: #666666">.</span>append(E)

    <span style="color: #408080; font-style: italic"># Find min/max for the axis</span>
    E_min <span style="color: #666666">=</span> <span style="color: #666666">1E+20</span>; E_max <span style="color: #666666">=</span> <span style="color: #666666">-</span>E_min
    <span style="color: #008000; font-weight: bold">for</span> theta <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #666666">0</span>, <span style="color: #666666">0.5</span>, <span style="color: #666666">1</span>:
        E_min <span style="color: #666666">=</span> <span style="color: #008000">min</span>(E_min, <span style="color: #008000">min</span>(errors[theta]))
        E_max <span style="color: #666666">=</span> <span style="color: #008000">max</span>(E_max, <span style="color: #008000">max</span>(errors[theta]))

    plt<span style="color: #666666">.</span>loglog(errors[<span style="color: #BA2121">&#39;dt&#39;</span>], errors[<span style="color: #666666">0</span>], <span style="color: #BA2121">&#39;ro-&#39;</span>)
    plt<span style="color: #666666">.</span>loglog(errors[<span style="color: #BA2121">&#39;dt&#39;</span>], errors[<span style="color: #666666">0.5</span>], <span style="color: #BA2121">&#39;b+-&#39;</span>)
    plt<span style="color: #666666">.</span>loglog(errors[<span style="color: #BA2121">&#39;dt&#39;</span>], errors[<span style="color: #666666">1</span>], <span style="color: #BA2121">&#39;gx-&#39;</span>)
    plt<span style="color: #666666">.</span>legend([<span style="color: #BA2121">&#39;FE&#39;</span>, <span style="color: #BA2121">&#39;CN&#39;</span>, <span style="color: #BA2121">&#39;BE&#39;</span>], loc<span style="color: #666666">=</span><span style="color: #BA2121">&#39;upper left&#39;</span>)
    plt<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;log(time step)&#39;</span>)
    plt<span style="color: #666666">.</span>ylabel(<span style="color: #BA2121">&#39;log(error)&#39;</span>)
    plt<span style="color: #666666">.</span>axis([<span style="color: #008000">min</span>(dt_values), <span style="color: #008000">max</span>(dt_values), E_min, E_max])
    plt<span style="color: #666666">.</span>title(<span style="color: #BA2121">&#39;Error vs time step&#39;</span>)
    plt<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;error.png&#39;</span>);  plt<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;error.pdf&#39;</span>)

    <span style="color: #408080; font-style: italic"># Write out a table in CSV format</span>
    f <span style="color: #666666">=</span> <span style="color: #008000">open</span>(<span style="color: #BA2121">&#39;error.csv&#39;</span>, <span style="color: #BA2121">&#39;w&#39;</span>)
    f<span style="color: #666666">.</span>write(<span style="color: #BA2121">r&#39;$\Delta t$,$\theta=0$,$\theta=0.5$,$\theta=1$&#39;</span> <span style="color: #666666">+</span> <span style="color: #BA2121">&#39;</span><span style="color: #BB6622; font-weight: bold">\n</span><span style="color: #BA2121">&#39;</span>)
    <span style="color: #008000; font-weight: bold">for</span> _dt, _fe, _cn, _be <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">zip</span>(
        errors[<span style="color: #BA2121">&#39;dt&#39;</span>], errors[<span style="color: #666666">0</span>], errors[<span style="color: #666666">0.5</span>], errors[<span style="color: #666666">1</span>]):
        f<span style="color: #666666">.</span>write(<span style="color: #BA2121">&#39;</span><span style="color: #BB6688; font-weight: bold">%.2f</span><span style="color: #BA2121">,</span><span style="color: #BB6688; font-weight: bold">%.4f</span><span style="color: #BA2121">,</span><span style="color: #BB6688; font-weight: bold">%.4f</span><span style="color: #BA2121">,</span><span style="color: #BB6688; font-weight: bold">%.4f</span><span style="color: #BB6622; font-weight: bold">\n</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> (_dt, _fe, _cn, _be))
    f<span style="color: #666666">.</span>close()

    <span style="color: #408080; font-style: italic"># Combine images into rows with 2 plots in each row</span>
    image_commands <span style="color: #666666">=</span> []
    <span style="color: #008000; font-weight: bold">for</span> method <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #BA2121">&#39;BE&#39;</span>, <span style="color: #BA2121">&#39;CN&#39;</span>, <span style="color: #BA2121">&#39;FE&#39;</span>:
        pdf_files <span style="color: #666666">=</span> <span style="color: #BA2121">&#39; &#39;</span><span style="color: #666666">.</span>join([<span style="color: #BA2121">&#39;</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">_</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">.pdf&#39;</span> <span style="color: #666666">%</span> (method, dt)
                              <span style="color: #008000; font-weight: bold">for</span> dt <span style="color: #AA22FF; font-weight: bold">in</span> dt_values])
        png_files <span style="color: #666666">=</span> <span style="color: #BA2121">&#39; &#39;</span><span style="color: #666666">.</span>join([<span style="color: #BA2121">&#39;</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">_</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">.png&#39;</span> <span style="color: #666666">%</span> (method, dt)
                              <span style="color: #008000; font-weight: bold">for</span> dt <span style="color: #AA22FF; font-weight: bold">in</span> dt_values])
        image_commands<span style="color: #666666">.</span>append(
            <span style="color: #BA2121">&#39;montage -background white -geometry 100%&#39;</span> <span style="color: #666666">+</span>
            <span style="color: #BA2121">&#39; -tile 2x </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121"> </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">.png&#39;</span> <span style="color: #666666">%</span> (png_files, method))
        image_commands<span style="color: #666666">.</span>append(
            <span style="color: #BA2121">&#39;convert -trim </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">.png </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">.png&#39;</span> <span style="color: #666666">%</span> (method, method))
        image_commands<span style="color: #666666">.</span>append(
            <span style="color: #BA2121">&#39;convert </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">.png -transparent white </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">.png&#39;</span> <span style="color: #666666">%</span>
            (method, method))
        image_commands<span style="color: #666666">.</span>append(
            <span style="color: #BA2121">&#39;pdftk </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121"> output tmp.pdf&#39;</span> <span style="color: #666666">%</span> pdf_files)
        num_rows <span style="color: #666666">=</span> <span style="color: #008000">int</span>(<span style="color: #008000">round</span>(<span style="color: #008000">len</span>(dt_values)<span style="color: #666666">/2.0</span>))
        image_commands<span style="color: #666666">.</span>append(
            <span style="color: #BA2121">&#39;pdfnup --nup 2x</span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121"> --outfile tmp.pdf tmp.pdf&#39;</span> <span style="color: #666666">%</span> num_rows)
        image_commands<span style="color: #666666">.</span>append(
            <span style="color: #BA2121">&#39;pdfcrop tmp.pdf </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">.pdf&#39;</span> <span style="color: #666666">%</span> method)

    <span style="color: #008000; font-weight: bold">for</span> cmd <span style="color: #AA22FF; font-weight: bold">in</span> image_commands:
        <span style="color: #008000; font-weight: bold">print</span> cmd
        failure <span style="color: #666666">=</span> os<span style="color: #666666">.</span>system(cmd)
        <span style="color: #008000; font-weight: bold">if</span> failure:
            <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;Command failed:&#39;</span>, cmd; sys<span style="color: #666666">.</span>exit(<span style="color: #666666">1</span>)

    <span style="color: #408080; font-style: italic"># Remove the files generated above and by model.py</span>
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">glob</span> <span style="color: #008000; font-weight: bold">import</span> glob
    filenames <span style="color: #666666">=</span> glob(<span style="color: #BA2121">&#39;*_*.png&#39;</span>) <span style="color: #666666">+</span> glob(<span style="color: #BA2121">&#39;*_*.pdf&#39;</span>) <span style="color: #666666">+</span> glob(<span style="color: #BA2121">&#39;tmp*.pdf&#39;</span>)
    <span style="color: #008000; font-weight: bold">for</span> filename <span style="color: #AA22FF; font-weight: bold">in</span> filenames:
        os<span style="color: #666666">.</span>remove(filename)

<span style="color: #008000; font-weight: bold">if</span> __name__ <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;__main__&#39;</span>:
    run_experiments(I<span style="color: #666666">=1</span>, a<span style="color: #666666">=2</span>, T<span style="color: #666666">=5</span>)
    plt<span style="color: #666666">.</span>show()
</pre></div>
<p>
We may comment upon many useful constructs in this script:

<ul>
 <li> <code>[float(arg) for arg in sys.argv[1:]]</code> builds a list of real numbers
   from all the command-line arguments.</li>
 <li> <code>['%s_%s.png' % (method, dt) for dt in dt_values]</code> builds a list of
   filenames from a list of numbers (<code>dt_values</code>).</li>
 <li> All <code>montage</code>, <code>convert</code>, <code>pdftk</code>, <code>pdfnup</code>, and <code>pdfcrop</code>
   commands for creating
   composite figures are stored in a
   list and later executed in a loop.</li>
 <li> <code>glob('*_*.png')</code> returns a list of the names of all files in the
   current directory where the filename matches the <a href="http://en.wikipedia.org/wiki/Glob_(programming)" target="_self">Unix wildcard notation</a>
   <code>*_*.png</code> (meaning any text, underscore, any text, and then <code>.png</code>).</li>
 <li> <code>os.remove(filename)</code> removes the file with name <code>filename</code>.</li>
 <li> <code>failure = os.system(cmd)</code> runs an operating system command with
   simpler syntax than what is required by <code>subprocess</code> (but the output
   of <code>cmd</code> cannot be captured).</li>
</ul>

<h2 id="softeng1:exper:report">Making a report</h2>

<p>
The results of running computer experiments are best documented in a
little report containing the problem to be solved, key code segments,
and the plots from a series of experiments. At least the part of the
report containing the plots should be automatically generated by the
script that performs the set of experiments, because in the script we
know exactly which input data that were used to generate a specific
plot, thereby ensuring that each figure is connected to the
right data. Take a look at <a href="http://tinyurl.com/nc4upel/_static/sphinx-cloud/" target="_self">a sample report</a>  to see what we have in
mind.

<h3 id="___sec225">Word, OpenOffice, GoogleDocs </h3>

<p>
Microsoft Word, its open source counterparts OpenOffice and
LibreOffice, along with GoogleDocs and similar online services are the
dominating tools for writing reports today. Nevertheless, scientific
reports often need mathematical equations and nicely typeset computer
code in monospace font. The support for mathematics and computer code
in the mentioned tools is in this author's view not on par with the
technologies based on <em>markup languages</em> and which are addressed
below. Also, with markup languages one has a readable, pure text file
as source for the report, and changes in this text can easily be
tracked by version control systems like Git. The result is a very
strong tool for monitoring &quot;who did what when&quot; with the files,
resulting in increased reliability of the writing process. For
collaborative writing, the merge functionality in Git leads to safer
simultaneously editing that what is offered even by collaborative
tools like GoogleDocs.

<h3 id="___sec226">HTML with MathJax </h3>

<p>
HTML is the markup language used for web pages.  Nicely typeset computer
code is straightforward in HTML, and high-quality mathematical
typesetting is available using an extension to HTML called <a href="http://www.mathjax.org/" target="_self">MathJax</a>, which allows formulas and equations to be
typeset with LaTeX syntax and nicely rendered in web browsers, see
Figure <a href="#softeng1:exper:report:fig:mathjax">24</a>.  A relatively small
subset of LaTeX environments for mathematics is supported, but the
syntax for formulas is quite rich. Inline formulas look like <code>\(
u'=-au \)</code> while equations are surrounded by <code>$$</code> signs.  Inside such
signs, one can use <code>\[ u'=-au \]</code> for unnumbered equations, or
<code>\begin{equation}</code> and <code>\end{equation}</code> for
numbered equations, or <code>\begin{align}</code> and <code>\end{align}</code> for multiple
numbered aligned equations.  You need to be familiar with <a href="http://en.wikibooks.org/wiki/LaTeX/Mathematics" target="_self">mathematical
typesetting in LaTeX</a> to write MathJax
code.

<p>
The file <a href="http://tinyurl.com/p96acy2/report_generation/exper1_html.py" target="_self"><tt>exper1_mathjax.py</tt></a>
calls a script
<a href="http://tinyurl.com/p96acy2/exper1.py" target="_self"><tt>exper1.py</tt></a>
to perform the numerical experiments and then runs Python
statements for creating an <a href="http://tinyurl.com/nc4upel/_static/report_mathjax.html.html" target="_self">HTML file</a> with the source code for <a href="http://tinyurl.com/nc4upel/_static/report_mathjax.html" target="_self">the scientific report</a>.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 24:  Report in HTML format with MathJax. <div id="softeng1:exper:report:fig:mathjax"></div> </p></center>
<p><img src="fig-softeng/report_mathjax.png" align="bottom" width=600></p>
</center>

<h3 id="___sec227">LaTeX </h3>

<p>
<!-- "http://en.wikibooks.org/wiki/LaTeX" -->

<p>
The <em>de facto</em> language for mathematical typesetting and scientific
report writing is <a href="http://en.wikipedia.org/wiki/LaTeX" target="_self">LaTeX</a>. A
number of very sophisticated packages have been added to the language
over a period of three decades, allowing very fine-tuned layout and
typesetting. For output in the <a href="http://tinyurl.com/nc4upel/_static/report.pdf" target="_self">PDF format</a>, see Figure
<a href="#softeng1:exper:report:fig:latex">25</a> for an example, LaTeX is the
definite choice when it comes to <em>typesetting quality</em>.
The LaTeX language used to
write the reports has typically a lot of commands involving
<a href="http://tinyurl.com/nc4upel/_static/report.tex.html" target="_self">backslashes and braces</a>, and many claim that
LaTeX syntax is not particularly readable.  For output on the web via
HTML code (i.e., not only showing the PDF in the browser window), LaTeX
struggles with delivering high quality typesetting. Other tools,
especially Sphinx, give better results and can also produce
nice-looking PDFs.  The file <a href="http://tinyurl.com/p96acy2/report_generation/exper1_latex.py" target="_self"><tt>exper1_latex.py</tt></a> shows how to
generate the LaTeX source from a program.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 25:  Report in PDF format generated from LaTeX source. <div id="softeng1:exper:report:fig:latex"></div> </p></center>
<p><img src="fig-softeng/report_latexpdf.png" align="bottom" width=600></p>
</center>

<h3 id="___sec228">Sphinx </h3>

<p>
<!-- give pointers to source pages -->

<p>
<a href="http://sphinx.pocoo.org/" target="_self">Sphinx</a> is a typesetting language with
similarities to HTML and LaTeX, but with much less tagging. It has
recently become very popular for software documentation and
mathematical reports. Sphinx can utilize LaTeX for mathematical
formulas and equations. Unfortunately, the
subset of LaTeX mathematics supported is less than in full MathJax (in
particular, numbering of multiple equations in an <code>align</code> type
environment is not supported).  The <a href="http://tinyurl.com/nc4upel/_static/report_sphinx.rst.html" target="_self">Sphinx syntax</a> is an extension of
the reStructuredText language. An attractive feature of Sphinx is its
rich support for <a href="http://tinyurl.com/nc4upel/_static/sphinx-cloud/index.html" target="_self">fancy layout of web pages</a>. In particular,
Sphinx can easily be combined with various layout <em>themes</em> that give a
certain look and feel to the web site and that offers table of
contents, navigation, and search facilities, see Figure
<a href="#softeng1:exper:report:fig:sphinx">26</a>.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 26:  Report in HTML format generated from Sphinx source. <div id="softeng1:exper:report:fig:sphinx"></div> </p></center>
<p><img src="fig-softeng/report_sphinx.png" align="bottom" width=600></p>
</center>

<h3 id="___sec229">Markdown </h3>

<p>
A recent, very popular format for easy writing of web pages is
<a href="http://daringfireball.net/projects/markdown/" target="_self">Markdown</a>.
Text is written very much like one would do in email, using
spacing and special characters to naturally format the code
instead of heavily tagging the text as in LaTeX and HTML.
With the tool <a href="http://johnmacfarlane.net/pandoc/" target="_self">Pandoc</a> one
can go from Markdown to a variety of formats.
HTML is a common output format, but LaTeX, epub, XML,
OpenOffice/LibreOffice, MediaWiki, and Microsoft Word are some other
possibilities. A Markdown version of our scientific
report demo is available as an IPython/Jupyter notebook (described next).

<h3 id="___sec230">IPython/Jupyter notebooks </h3>

<p>
The <a href="http://ipython.org/notebook.html" target="_self">IPython Notebook</a> is
a web-based tool where one can write scientific reports with live computer
code and graphics. Or the other way around: software can be equipped
with documentation in the style of scientific reports.
A slightly extended version of Markdown is used for writing text and
mathematics, and the <a href="http://tinyurl.com/nc4upel/_static/report.ipynb.html" target="_self">source code of a notebook</a> is in json format.
The interest in the notebook has grown amazingly fast
over just a few years, and further development now takes place
in the <a href="https://jupyter.org/" target="_self">Jupyter project</a>, which
supports a lot of programming languages for interactive notebook computing.
Jupyter notebooks are primarily live electronic documents, but they can be
printed out as PDF reports too.
A notebook version of our scientific report can be <a href="http://tinyurl.com/p96acy2/_static/report.ipynb" target="_self">downloaded</a> and experimented with
or <a href="http://nbviewer.ipython.org/url/hplgit.github.com/teamods/writing_reports/_static/report.ipynb" target="_self">just statically viewed</a> in a browser.

<h3 id="___sec231">Wiki formats </h3>

<p>
A range of wiki formats are popular for creating notes on the web,
especially documents which allow groups of people to edit and add
content. Apart from <a href="http://www.mediawiki.org/wiki/MediaWiki" target="_self">MediaWiki</a> (the wiki format used for
Wikipedia), wiki formats have no support for mathematical typesetting
and also limited tools for displaying computer code in nice ways.
Wiki formats are therefore less suitable for scientific reports compared
to the other formats mentioned here.

<h3 id="___sec232">DocOnce </h3>

<p>
Since it is difficult to choose the right tool or format for writing a
scientific report, it is advantageous to write the content in a format
that easily translates to LaTeX, HTML, Sphinx, Markdown,
IPython/Jupyter notebooks, and various wikis. <a href="https://github.com/hplgit/doconce" target="_self">DocOnce</a> is such a tool. It is similar to
Pandoc, but offers some special convenient features for writing about
mathematics and programming.  The <a href="http://tinyurl.com/nc4upel/_static/report.do.txt.html" target="_self">tagging is modest</a>, somewhere between
LaTeX and Markdown.  The program <a href="http://tinyurl.com/p96acy2/exper1_do.py" target="_self"><tt>exper1_do.py</tt></a> demonstrates how
to generate DocOnce code for a scientific report.
There is also a corresponding rich demo of the <a href="http://tinyurl.com/nc4upel/index.html" target="_self">resulting reports</a> that can be made from
this DocOnce code.

<p>
<!-- project with exploring instability (help with matplotlib contour plots, and maybe show such a plot) -->

<h2 id="softeng1:exper:github">Publishing a complete project</h2>

<p>
To assist the important principle of <em>replicable</em> science,
a report documenting scientific investigations should be accompanied by
all the software and data used for the investigations so that others
have a possibility to redo the work and assess the qualify of the results.

<p>
One way of documenting a complete project is to make a directory tree
with all relevant files. Preferably, the tree is published at
some project hosting site like <a href="http://hplgit.github.com/teamods/bitgit/html/" target="_self">Bitbucket or GitHub</a> so that others can download it
as a tarfile, zipfile, or clone the files directly using the Git version control
system.
For the investigations outlined in the section <a href="#softeng1:exper:report">Making a report</a>,
we can create a directory tree with files
<p>

<!-- code=text typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">setup.py
./src:
   model.py
./doc:
   ./src:
      exper1_mathjax.py
      make_report.sh
      run.sh
   ./pub:
      report.html
</pre></div>
<p>
The <code>src</code> directory holds source code (modules) to be reused in other projects,
the <code>setup.py</code> script builds and installs such software,
the <code>doc</code> directory contains the documentation, with <code>src</code> for the
source of the documentation (usually written in a markup language)
and <code>pub</code> for published (compiled) documentation.
The <code>run.sh</code> file is a simple Bash script listing the <code>python</code> commands
we used to run <code>exper1_mathjax.py</code> to generate the experiments and
the <code>report.html</code> file.

<p>
<!-- Point to DocOnce version -->

<p>
<p>
<!-- navigation buttons at the bottom of the page -->
<ul class="pager">
  <li class="previous">
    <a href="._decay-book013.html">&larr; Prev</a>
  </li>
  <li class="next">
    <a href="._decay-book015.html">Next &rarr;</a>
  </li>
</ul>
<!-- ------------------- end of main content --------------- -->

</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<!-- Bootstrap footer
<footer>
<a href="http://..."><img width="250" align=right src="http://..."></a>
</footer>
-->


</body>
</html>
    


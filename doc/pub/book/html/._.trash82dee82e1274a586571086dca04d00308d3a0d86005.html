<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Finite Difference Computing with Exponential Decay Models">
<meta name="keywords" content="decay ODE,exponential decay,mesh,grid,mesh function,finite differences,forward difference,finite differences forward,difference equation,discrete equation,algebraic equation,finite difference scheme,Forward Euler scheme,backward difference,finite differences backward,backward scheme, 1-step,Backward Euler scheme,Crank-Nicolson scheme,centered difference,finite differences centered,averaging arithmetic,weighted average,theta-rule,$\theta$-rule,time step,finite difference operator notation,operator notation, finite differences,directory,folder,doc strings,printf format,format string syntax (Python),plotting curves,visualizing curves,representative (mesh function),array arithmetics,array computing,vectorization,continuous function norms,norm continuous,discrete function norms,mesh function norms,norm discrete (mesh function),error norms,scalar computing,PNG plot,PDF plot,EPS plot,viewing graphics files,cropping images,array arithmetics,array computing,vectorization,stability,amplification factor,A-stable methods,L-stable methods,interactive Python,error amplification factor,error global,consistency,stability,convergence,Monte Carlo simulation,lambda functions,method of manufactured solutions,MMS (method of manufactured solutions),convergence rate,verification,implicit schemes,explicit schemes,theta-rule,$\theta$-rule,backward scheme, 2-step,BDF2 scheme,Leapfrog scheme,Leapfrog scheme, filtered,Heun's method,Runge-Kutta, 2nd-order method,Taylor-series methods (for ODEs),Adams-Bashforth scheme, 2nd-order,Adams-Bashforth scheme, 3rd order,Runge-Kutta, 4th-order method,RK4,adaptive time stepping,Dormand-Prince Runge-Kutta 4-5 method,population dynamics,logistic model,radioactive decay,chemical reactions irreversible,chemical reactions reversible,Lotka-Volterra model,predator-prey model,terminal velocity,geometric mean,averaging geometric,scaling,Kelvin-Voigt material model,viscoelasticity,refactoring,importing modules,logger,debugging,list comprehension,command-line arguments,option-value pairs (command line),command-line arguments,reading the command line,doctests,software testing doctests,unit testing,software testing nose,software testing pytest,test function,software testing test function,doctest in test function,unit testing,software testing unit testing (class-based),Distutils,GitHub,importing modules,problem class,solver class,wrapper (code),reproducibility,replicability,Unix wildcard notation,wildcard notation (Unix),Word (Microsoft),LibreOffice,OpenOffice,Google Docs,HTML,MathJax,LaTeX,Sphinx (typesetting tool),Markdown,IPython notebooks,Jupyter notebooks,DocOnce,replicability">

<title>Finite Difference Computing with Exponential Decay Models</title>

<!-- Bootstrap style: bootswatch_readable -->
<link href="http://netdna.bootstrapcdn.com/bootswatch/3.1.1/readable/bootstrap.min.css" rel="stylesheet">
<!-- not necessary
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->

<style type="text/css">
/* Let inline verbatim have the same color as the surroundings */
code { color: inherit; background-color: transparent; }

/*
in.collapse+a.btn.showdetails:before { content:'Hide details'; }
.collapse+a.btn.showdetails:before { content:'Show details'; }
*/
</style>


</head>

<!-- tocinfo
{'highest level': 0,
 'sections': [('Preface', 0, 'ch:preface', 'ch:preface'),
              ('Algorithms and implementations', 0, None, '___sec1'),
              ('Finite difference methods',
               1,
               'decay:basics',
               'decay:basics'),
              ('A basic model for exponential decay',
               2,
               'decay:model',
               'decay:model'),
              ('The exact solution', 3, None, '___sec4'),
              ('A complete problem formulation', 3, None, '___sec5'),
              ('The Forward Euler scheme',
               2,
               'decay:schemes:FE',
               'decay:schemes:FE'),
              ('Step 1: Discretizing the domain', 3, None, '___sec7'),
              ('Step 2: Fulfilling the equation at discrete time points',
               3,
               None,
               '___sec8'),
              ('Step 3: Replacing derivatives by finite differences',
               3,
               None,
               '___sec9'),
              ('Step 4: Formulating a recursive algorithm',
               3,
               None,
               '___sec10'),
              ('Interpretation', 3, None, '___sec11'),
              ('Computing with the recursive formula', 3, None, '___sec12'),
              ('The Backward Euler scheme',
               2,
               'decay:schemes:BE',
               'decay:schemes:BE'),
              ('The Crank-Nicolson scheme',
               2,
               'decay:schemes:CN',
               'decay:schemes:CN'),
              ('The unifying $\\theta$-rule',
               2,
               'decay:schemes:theta',
               'decay:schemes:theta'),
              ('Constant time step', 2, None, '___sec16'),
              ('Mathematical derivation of finite difference formulas',
               2,
               'decay:fd:taylor',
               'decay:fd:taylor'),
              ('The forward difference', 3, None, '___sec18'),
              ('The backward difference', 3, None, '___sec19'),
              ('The centered difference', 3, None, '___sec20'),
              ('Compact operator notation for finite differences',
               2,
               'decay:fd:op',
               'decay:fd:op'),
              ('Implementation', 1, 'decay:impl1', 'decay:impl1'),
              ('Computer language: Python', 2, None, '___sec23'),
              ('Making a solver function', 2, 'decay:py1', 'decay:py1'),
              ('Integer division', 2, 'decay:py2', 'decay:py2'),
              ('Doc strings', 2, None, '___sec26'),
              ('Formatting numbers', 2, None, '___sec27'),
              ('Running the program', 2, None, '___sec28'),
              ('Plotting the solution', 2, None, '___sec29'),
              ('Verifying the implementation', 2, None, '___sec30'),
              ('Running a few algorithmic steps by hand',
               3,
               None,
               '___sec31'),
              ('Computing the numerical error as a mesh function',
               2,
               'decay:computing:error',
               'decay:computing:error'),
              ('Computing the norm of the error mesh function',
               2,
               'decay:computing:error:norm',
               'decay:computing:error:norm'),
              ('Scalar computing', 3, None, '___sec34'),
              ('Experiments with computing and plotting',
               2,
               None,
               '___sec35'),
              ('Combining plot files', 3, None, '___sec36'),
              ('Plotting with SciTools', 3, None, '___sec37'),
              ('Memory-saving implementation', 2, None, '___sec38'),
              ('Exercises', 1, None, '___sec39'),
              ('Exercise 1: Define a mesh function and visualize it',
               2,
               'decay:exer:meshfunc',
               'decay:exer:meshfunc'),
              ('Remarks', 3, None, '___sec41'),
              ('Problem 2: Differentiate a function',
               2,
               'decay:exer:dudt',
               'decay:exer:dudt'),
              ('Problem 3: Experiment with divisions',
               2,
               'decay:exer:intdiv',
               'decay:exer:intdiv'),
              ('Problem 4: Experiment with wrong computations',
               2,
               'decay:exer:decay1err',
               'decay:exer:decay1err'),
              ('Problem 5: Plot the error function',
               2,
               'decay:exer:plot:error',
               'decay:exer:plot:error'),
              ('Problem 6: Change formatting of numbers and debug',
               2,
               'decay:exer:inexact:output',
               'decay:exer:inexact:output'),
              ('Analysis', 0, 'decay:analysis', 'decay:analysis'),
              ('Experimental investigations', 1, None, '___sec48'),
              ('Discouraging numerical solutions', 2, None, '___sec49'),
              ('Detailed experiments', 2, None, '___sec50'),
              ('Stability', 1, None, '___sec51'),
              ('Exact numerical solution', 2, None, '___sec52'),
              ('Stability properties derived from the amplification factor',
               2,
               None,
               '___sec53'),
              ('Accuracy', 1, None, '___sec54'),
              ('Visual comparison of amplification factors',
               2,
               None,
               '___sec55'),
              ('Series expansion of amplification factors',
               2,
               None,
               '___sec56'),
              ('The ratio of numerical and exact amplification factors',
               2,
               None,
               '___sec57'),
              ('The global error at a point',
               2,
               'decay:analysis:gobal:error',
               'decay:analysis:gobal:error'),
              ('Integrated error',
               2,
               'decay:analysis:gobal:error_int',
               'decay:analysis:gobal:error_int'),
              ('Truncation error',
               2,
               'decay:analysis:trunc',
               'decay:analysis:trunc'),
              ('Consistency, stability, and convergence',
               2,
               None,
               '___sec61'),
              ('Various types of errors in a differential equation model',
               1,
               None,
               '___sec62'),
              ('Model errors', 2, None, '___sec63'),
              ('Data errors', 2, None, '___sec64'),
              ('Discretization errors', 2, None, '___sec65'),
              ('Rounding errors', 2, None, '___sec66'),
              ('Discussion of the size of various errors',
               2,
               None,
               '___sec67'),
              ('Exercises', 1, None, '___sec68'),
              ('Problem 7: Visualize the accuracy of finite differences',
               2,
               'decay:analysis:exer:fd:exp:plot',
               'decay:analysis:exer:fd:exp:plot'),
              ('Problem 8: Explore the $\\theta$-rule for exponential growth',
               2,
               'decay:analysis:exer:growth',
               'decay:analysis:exer:growth'),
              ('Problem 9: Explore rounding errors in numerical calculus',
               2,
               'decay:analysis:exer:rounding',
               'decay:analysis:exer:rounding'),
              ('Generalizations', 0, None, '___sec72'),
              ('Model extensions', 1, None, '___sec73'),
              ('Generalization: including a variable coefficient',
               2,
               None,
               '___sec74'),
              ('Generalization: including a source term',
               2,
               'decay:source',
               'decay:source'),
              ('Implementation of the generalized model problem',
               2,
               'decay:general',
               'decay:general'),
              ('Deriving the $\\theta$-rule formula', 3, None, '___sec77'),
              ('Python code', 3, None, '___sec78'),
              ('Coding of variable coefficients', 3, None, '___sec79'),
              ('Verifying a constant solution',
               2,
               'decay:verify:trivial',
               'decay:verify:trivial'),
              ('Verification via manufactured solutions',
               2,
               'decay:MMS',
               'decay:MMS'),
              ('Computing convergence rates',
               2,
               'decay:convergence:rate',
               'decay:convergence:rate'),
              ('Estimating $r$', 3, None, '___sec83'),
              ('Implementation', 3, None, '___sec84'),
              ('Extension to systems of ODEs', 2, None, '___sec85'),
              ('General first-order ODEs', 1, None, '___sec86'),
              ('Generic form of first-order ODEs', 2, None, '___sec87'),
              ('The $\\theta$-rule', 2, None, '___sec88'),
              ('An implicit 2-step backward scheme', 2, None, '___sec89'),
              ('Leapfrog schemes', 2, None, '___sec90'),
              ('The ordinary Leapfrog scheme', 3, None, '___sec91'),
              ('The filtered Leapfrog scheme', 3, None, '___sec92'),
              ('The 2nd-order Runge-Kutta method', 2, None, '___sec93'),
              ('A 2nd-order Taylor-series method', 2, None, '___sec94'),
              ('The 2nd- and 3rd-order Adams-Bashforth schemes',
               2,
               None,
               '___sec95'),
              ('The 4th-order Runge-Kutta method',
               2,
               'decay:fd2:RK4',
               'decay:fd2:RK4'),
              ('The Odespy software', 2, None, '___sec97'),
              ('Example: Runge-Kutta methods', 2, None, '___sec98'),
              ('Remark about using the $\\theta$-rule in Odespy',
               3,
               None,
               '___sec99'),
              ('Example: Adaptive Runge-Kutta methods',
               2,
               'decay:fd2:adaptiveRK',
               'decay:fd2:adaptiveRK'),
              ('Exercises', 1, None, '___sec101'),
              ('Exercise 10: Experiment with precision in tests and the size of $u$',
               2,
               'decay:fd2:exer:precision',
               'decay:fd2:exer:precision'),
              ('Exercise 11: Implement the 2-step backward scheme',
               2,
               'decay:fd2:exer:bw2',
               'decay:fd2:exer:bw2'),
              ('Exercise 12: Implement the 2nd-order Adams-Bashforth scheme',
               2,
               'decay:fd2:exer:AB2',
               'decay:fd2:exer:AB2'),
              ('Exercise 13: Implement the 3rd-order Adams-Bashforth scheme',
               2,
               'decay:fd2:exer:AB3',
               'decay:fd2:exer:AB3'),
              ('Exercise 14: Analyze explicit 2nd-order methods',
               2,
               'decay:exer:RK2:Taylor:analysis',
               'decay:exer:RK2:Taylor:analysis'),
              ('Project 15: Implement and investigate the Leapfrog scheme',
               2,
               'decay:fd2:exer:leapfrog1',
               'decay:fd2:exer:leapfrog1'),
              ('Problem 16: Make a unified implementation of many schemes',
               2,
               'decay:fd2:exer:uni',
               'decay:fd2:exer:uni'),
              ('Models', 0, 'decay:app', 'decay:app'),
              ('Scaling', 1, 'decay:app:scaling', 'decay:app:scaling'),
              ('Dimensionless variables', 2, None, '___sec111'),
              ('Dimensionless numbers', 2, None, '___sec112'),
              ('A scaling for vanishing initial condition',
               2,
               None,
               '___sec113'),
              ('Evolution of a population',
               1,
               'decay:app:pop',
               'decay:app:pop'),
              ('Exponential growth',
               2,
               'decay:app:pop:exp',
               'decay:app:pop:exp'),
              ('Logistic growth',
               2,
               'decay:app:pop:log',
               'decay:app:pop:log'),
              ('Compound interest and inflation',
               1,
               'decay:app:interest',
               'decay:app:interest'),
              ("Newton's law of cooling",
               1,
               'decay:app:Newton:cooling',
               'decay:app:Newton:cooling'),
              ('Radioactive decay',
               1,
               'decay:app:nuclear',
               'decay:app:nuclear'),
              ('Deterministic model', 2, None, '___sec120'),
              ('Stochastic model', 2, None, '___sec121'),
              ('Relation between stochastic and deterministic models',
               2,
               None,
               '___sec122'),
              ('Generalization of the radioactive decay modeling',
               2,
               'decay:app:waitingtime',
               'decay:app:waitingtime'),
              ('Chemical kinetics',
               1,
               'decay:app:kinetics',
               'decay:app:kinetics'),
              ('Irreversible reaction of two substances',
               2,
               None,
               '___sec125'),
              ('Reversible reaction of two substances', 2, None, '___sec126'),
              ('Irreversible reaction of two substances into a third',
               2,
               None,
               '___sec127'),
              ('A biochemical reaction', 2, None, '___sec128'),
              ('Spreading of diseases', 1, 'decay:app:SIR', 'decay:app:SIR'),
              ('Predator-prey models in ecology',
               1,
               'decay:app:predprey',
               'decay:app:predprey'),
              ('Decay of atmospheric pressure with altitude',
               1,
               'decay:app:atm',
               'decay:app:atm'),
              ('The general model', 2, None, '___sec132'),
              ('Multiple atmospheric layers', 2, None, '___sec133'),
              ('Simplifications', 2, None, '___sec134'),
              ('Constant layer temperature', 3, None, '___sec135'),
              ('One-layer model', 3, None, '___sec136'),
              ('Compaction of sediments',
               1,
               'decay:app:sediment',
               'decay:app:sediment'),
              ('Vertical motion of a body in a viscous fluid',
               1,
               'decay:app:drag',
               'decay:app:drag'),
              ('Overview of forces', 2, None, '___sec139'),
              ('Equation of motion', 2, None, '___sec140'),
              ('Terminal velocity', 2, None, '___sec141'),
              ('A Crank-Nicolson scheme', 2, None, '___sec142'),
              ('Physical data', 2, None, '___sec143'),
              ('Verification', 2, None, '___sec144'),
              ('Scaling',
               2,
               'decay:app:drag:scaling',
               'decay:app:drag:scaling'),
              ('Viscoelastic materials',
               1,
               'decay:app:viscoelasticity',
               'decay:app:viscoelasticity'),
              ('Decay ODEs from solving a PDE by Fourier expansions',
               1,
               'decay:app:diffusion:Fourier',
               'decay:app:diffusion:Fourier'),
              ('Exercises', 1, None, '___sec148'),
              ('Problem 17: Radioactive decay of Carbon-14',
               2,
               'decay:app:exer:radio:C14',
               'decay:app:exer:radio:C14'),
              ("Exercise 18: Derive schemes for Newton's law of cooling",
               2,
               'decay:app:exer:cooling:schemes',
               'decay:app:exer:cooling:schemes'),
              ("Exercise 19: Implement schemes for Newton's law of cooling",
               2,
               'decay:app:exer:cooling:py',
               'decay:app:exer:cooling:py'),
              ('Bug 1: Wrong time level in the $T_s$ function',
               3,
               None,
               '___sec152'),
              ('Bug 2: Wrong time level in the $T$ function',
               3,
               None,
               '___sec153'),
              ('Bug 3: Missing $\\theta$ in a term', 3, None, '___sec154'),
              ('Bug 4: Missing `k` in the updating formula',
               3,
               None,
               '___sec155'),
              ('Bug 5: Using `1-theta` instead of `theta`',
               3,
               None,
               '___sec156'),
              ('Exercise 20: Find time of murder from body temperature',
               2,
               'decay:app:exer:cooling:murder',
               'decay:app:exer:cooling:murder'),
              ('Exercise 21: Simulate an oscillating cooling process',
               2,
               'decay:app:exer:cooling:osc',
               'decay:app:exer:cooling:osc'),
              ('Exercise 22: Simulate stochastic radioactive decay',
               2,
               'decay:app:exer:stoch:nuclear',
               'decay:app:exer:stoch:nuclear'),
              ('Problem 23: Radioactive decay of two substances',
               2,
               'decay:app:exer:radio:twosubst',
               'decay:app:exer:radio:twosubst'),
              ('Exercise 24: Simulate a simple chemical reaction',
               2,
               'decay:app:exer:kinetics:AB',
               'decay:app:exer:kinetics:AB'),
              ('Exercise 25: Simulate an $n$-th order chemical reaction',
               2,
               'decay:app:exer:kinetics:ABn',
               'decay:app:exer:kinetics:ABn'),
              ('Exercise 26: Simulate a biochemical process',
               2,
               'decay:app:exer:MMK',
               'decay:app:exer:MMK'),
              ('Exercise 27: Simulate spreading of a disease',
               2,
               'decay:app:exer:SIR',
               'decay:app:exer:SIR'),
              ('Exercise 28: Simulate predator-prey interaction',
               2,
               'decay:app:exer:predprey',
               'decay:app:exer:predprey'),
              ('Exercise 29: Simulate the pressure drop in the atmosphere',
               2,
               'decay:app:exer:atm1',
               'decay:app:exer:atm1'),
              ('Exercise 30: Make a program for vertical motion in a fluid',
               2,
               'decay:app:exer:drag:prog',
               'decay:app:exer:drag:prog'),
              ('Project 31: Simulate parachuting',
               2,
               'decay:app:exer:parachute',
               'decay:app:exer:parachute'),
              ('Exercise 32: Formulate vertical motion in the atmosphere',
               2,
               'decay:app:exer:drag:atm1',
               'decay:app:exer:drag:atm1'),
              ('Exercise 33: Simulate vertical motion in the atmosphere',
               2,
               'decay:app:exer:drag:atm2',
               'decay:app:exer:drag:atm2'),
              ('Problem 34: Compute $y=|x|$ by solving an ODE',
               2,
               'decay:app:exer:signum',
               'decay:app:exer:signum'),
              ('Problem 35: Simulate fortune growth with random interest rate',
               2,
               'decay:app:exer:interest',
               'decay:app:exer:interest'),
              ('Exercise 36: Simulate a population in a changing environment',
               2,
               'decay:app:exer:pop:at',
               'decay:app:exer:pop:at'),
              ('Exercise 37: Simulate logistic growth',
               2,
               'decay:app:exer:pop:logistic1',
               'decay:app:exer:pop:logistic1'),
              ('Exercise 38: Rederive the equation for continuous compound interest',
               2,
               'decay:app:exer:interest:derive',
               'decay:app:exer:interest:derive'),
              ('Exercise 39: Simulate the deformation of a viscoelastic material',
               2,
               'decay:app:exer:viscoelasticity1',
               'decay:app:exer:viscoelasticity1'),
              ('Scientific software engineering', 0, 'decay:se', 'decay:se'),
              ('Implementations with functions and modules',
               1,
               'softeng1:basic',
               'softeng1:basic'),
              ('Mathematical problem and solution technique',
               2,
               'softeng1:basic:math',
               'softeng1:basic:math'),
              ('A first, quick implementation',
               2,
               'softeng1:basic:impl1',
               'softeng1:basic:impl1'),
              ('A more decent program',
               2,
               'softeng1:basic:impl2',
               'softeng1:basic:impl2'),
              ('Comments in a program', 3, None, '___sec182'),
              ('Refactoring into functions', 3, None, '___sec183'),
              ('Program file vs IDE vs notebook', 3, None, '___sec184'),
              ('Prefixing imported functions by the module name',
               2,
               'softeng1:basic:modprefix',
               'softeng1:basic:modprefix'),
              ('Implementing the numerical algorithm in a function',
               2,
               'softeng1:basic:func',
               'softeng1:basic:func'),
              ('Do not have several versions of a code',
               2,
               None,
               '___sec187'),
              ('Making a module',
               2,
               'softeng1:basic:module',
               'softeng1:basic:module'),
              ('Example on extending the module code',
               2,
               'softeng1:basic:experiment2',
               'softeng1:basic:experiment2'),
              ('Documenting functions and modules',
               2,
               'softeng1:basic:docstring',
               'softeng1:basic:docstring'),
              ('Logging intermediate results',
               2,
               'softeng1:basic:logging',
               'softeng1:basic:logging'),
              ('Introductory example', 3, None, '___sec192'),
              ('Using a logger in our solver function', 3, None, '___sec193'),
              ('User interfaces',
               1,
               'softeng1:basic:UI',
               'softeng1:basic:UI'),
              ('Command-line arguments', 2, None, '___sec195'),
              ('Positional command-line arguments', 2, None, '___sec196'),
              ('Option-value pairs on the command line',
               2,
               None,
               '___sec197'),
              ('Creating a graphical web user interface',
               2,
               None,
               '___sec198'),
              ('Making a compute function', 3, None, '___sec199'),
              ('Generating the user interface', 3, None, '___sec200'),
              ('Running the web application', 3, None, '___sec201'),
              ('Tests for verifying implementations', 1, None, '___sec202'),
              ('Doctests', 2, None, '___sec203'),
              ('Unit tests and test functions', 2, None, '___sec204'),
              ('Two Python test frameworks: nose and pytest',
               3,
               None,
               '___sec205'),
              ('Test function requirements', 3, None, '___sec206'),
              ('Comparison of real numbers', 3, None, '___sec207'),
              ('Special assert functions from nose', 3, None, '___sec208'),
              ('Locating test functions', 3, None, '___sec209'),
              ('Running tests', 3, None, '___sec210'),
              ('Embedding doctests in a test function', 3, None, '___sec211'),
              ('Installing nose and pytest', 3, None, '___sec212'),
              ('Test function for the solver', 2, None, '___sec213'),
              ('Test function for reading positional command-line arguments',
               2,
               None,
               '___sec214'),
              ('Test function for reading option-value pairs',
               2,
               None,
               '___sec215'),
              ('Classical class-based unit testing',
               2,
               'softeng1:basic:unittest',
               'softeng1:basic:unittest'),
              ('Sharing the software with other users',
               1,
               'softeng1:prog:se:git',
               'softeng1:prog:se:git'),
              ('Organizing the software directory tree',
               2,
               None,
               '___sec218'),
              ('Distributing just a module file', 3, None, '___sec219'),
              ('Distributing a package', 3, None, '___sec220'),
              ('Publishing the software at GitHub', 2, None, '___sec221'),
              ('Downloading and installing the software',
               2,
               None,
               '___sec222'),
              ('Installing just a module file', 3, None, '___sec223'),
              ('Installing a package', 3, None, '___sec224'),
              ('Classes for problem and solution method',
               1,
               'softeng1:prog:se:class',
               'softeng1:prog:se:class'),
              ('The problem class', 2, None, '___sec226'),
              ('The solver class', 2, None, '___sec227'),
              ('Combining the objects', 3, None, '___sec228'),
              ('Improving the problem and solver classes',
               2,
               'softeng1:prog:se:class2',
               'softeng1:prog:se:class2'),
              ('A generic class for parameters', 3, None, '___sec230'),
              ('Automating scientific experiments',
               1,
               'softeng1:experiments',
               'softeng1:experiments'),
              ('Available software', 2, None, '___sec232'),
              ('The results we want to produce', 2, None, '___sec233'),
              ('Combining plot files', 2, None, '___sec234'),
              ('Running a program from Python', 2, None, '___sec235'),
              ('The automating script', 2, None, '___sec236'),
              ('Making a report',
               2,
               'softeng1:exper:report',
               'softeng1:exper:report'),
              ('Word, OpenOffice, GoogleDocs', 3, None, '___sec238'),
              ('HTML with MathJax', 3, None, '___sec239'),
              ('LaTeX', 3, None, '___sec240'),
              ('Sphinx', 3, None, '___sec241'),
              ('Markdown', 3, None, '___sec242'),
              ('IPython/Jupyter notebooks', 3, None, '___sec243'),
              ('Wiki formats', 3, None, '___sec244'),
              ('DocOnce', 3, None, '___sec245'),
              ('Publishing a complete project',
               2,
               'softeng1:exper:github',
               'softeng1:exper:github'),
              ('Exercises', 1, None, '___sec247'),
              ('Problem 40: Make a tool for differentiating curves',
               2,
               'softeng1:exer:derivative',
               'softeng1:exer:derivative'),
              ('Problem 41: Make solid software for the Trapezoidal rule',
               2,
               'softeng1:exer:integral:flat',
               'softeng1:exer:integral:flat'),
              ('Problem 42: Implement classes for the Trapezoidal rule',
               2,
               'softeng1:exer:integral:flat2',
               'softeng1:exer:integral:flat2'),
              ('Problem 43: Write a doctest and a test function',
               2,
               'softeng1:exer:doctest1',
               'softeng1:exer:doctest1'),
              ('Problem 44: Experiment with tolerances in comparisons',
               2,
               'softeng1:exer:tol',
               'softeng1:exer:tol'),
              ('Remarks', 3, None, '___sec253'),
              ('Exercise 45: Make use of a class implementation',
               2,
               'softeng1:exer:class:dts',
               'softeng1:exer:class:dts'),
              ('Problem 46: Make solid software for a difference equation',
               2,
               'softeng1:exer:logistic',
               'softeng1:exer:logistic'),
              ('Summarizing multiple-choice questions', 0, None, '___sec256'),
              ('Quiz', 1, None, '___sec257'),
              ('Exercise 47: Characterize a finite difference',
               2,
               'decay:quiz:fd:FE',
               'decay:quiz:fd:FE'),
              ('Exercise 48: Characterize a finite difference',
               2,
               'decay:quiz:fd:CN',
               'decay:quiz:fd:CN'),
              ('Exercise 49: What is the problem with this program?',
               2,
               'decay:quiz:program',
               'decay:quiz:program'),
              ('Exercise 50: Is the solution correct?',
               2,
               'decay:quiz:stability',
               'decay:quiz:stability'),
              ('Exercise 51: Is this a proper test function?',
               2,
               'decay:quiz:testfunc',
               'decay:quiz:testfunc'),
              ('Exercise 52: Rewrite an expression with array arithmetics',
               2,
               'decay:quiz:arrayarithm',
               'decay:quiz:arrayarithm'),
              ('Exercise 53: What is the truncation error?',
               2,
               'decay:quiz:trunc',
               'decay:quiz:trunc'),
              ('Exercise 54: Recognize a programming language',
               2,
               'decay:quiz:prog:m',
               'decay:quiz:prog:m'),
              ('Exercise 55: Recognize a programming language',
               2,
               'decay:quiz:prog:py',
               'decay:quiz:prog:py'),
              ('Exercise 56: Recognize a programming language',
               2,
               'decay:quiz:prog:f77',
               'decay:quiz:prog:f77'),
              ('Exercise 57: Recognize a programming language',
               2,
               'decay:quiz:prog:c',
               'decay:quiz:prog:c'),
              ('Exercise 58: What is SymPy?',
               2,
               'decay:quiz:sympy1',
               'decay:quiz:sympy1'),
              ('Exercise 59: Testing of code',
               2,
               'decay:quiz:testing1',
               'decay:quiz:testing1'),
              ('Exercise 60: What kind of scheme is this?',
               2,
               'decay:quiz:scheme:CN_error',
               'decay:quiz:scheme:CN_error'),
              ('Exercise 61: What kind of scheme is this?',
               2,
               'decay:quiz:scheme:BE',
               'decay:quiz:scheme:BE'),
              ('Exercise 62: What kind of scheme is this?',
               2,
               'decay:quiz:scheme:leapfrog',
               'decay:quiz:scheme:leapfrog'),
              ('References', 1, None, '___sec274')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- newcommands_keep.tex -->
$$
\newcommand{\half}{\frac{1}{2}}
\newcommand{\tp}{\thinspace .}
\newcommand{\uex}{{u_{\small\mbox{e}}}}
\newcommand{\Aex}{{A_{\small\mbox{e}}}}
\newcommand{\E}[1]{\hbox{E}\lbrack #1 \rbrack}
\newcommand{\Var}[1]{\hbox{Var}\lbrack #1 \rbrack}
\newcommand{\Std}[1]{\hbox{Std}\lbrack #1 \rbrack}
\newcommand{\Oof}[1]{\mathcal{O}(#1)}
\newcommand{\stress}{\boldsymbol{\sigma}}
$$




    
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href=".trash82dee82e1274a586571086dca04d00308d3a0d86.html">Finite Difference Computing with Exponential Decay Models</a>
  </div>
  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="._.trash82dee82e1274a586571086dca04d00308d3a0d86001.html#ch:preface" style="font-size: 80%;">Preface</a></li>
     <!-- navigation toc: --> <li><a href="._.trash82dee82e1274a586571086dca04d00308d3a0d86003.html#___sec1" style="font-size: 80%;">Algorithms and implementations</a></li>
     <!-- navigation toc: --> <li><a href="._.trash82dee82e1274a586571086dca04d00308d3a0d86006.html#decay:analysis" style="font-size: 80%;">Analysis</a></li>
     <!-- navigation toc: --> <li><a href="._.trash82dee82e1274a586571086dca04d00308d3a0d86007.html#___sec72" style="font-size: 80%;">Generalizations</a></li>
     <!-- navigation toc: --> <li><a href="._.trash82dee82e1274a586571086dca04d00308d3a0d86008.html#decay:app" style="font-size: 80%;">Models</a></li>
     <!-- navigation toc: --> <li><a href="._.trash82dee82e1274a586571086dca04d00308d3a0d86009.html#decay:se" style="font-size: 80%;">Scientific software engineering</a></li>
     <!-- navigation toc: --> <li><a href="._.trash82dee82e1274a586571086dca04d00308d3a0d86010.html#___sec256" style="font-size: 80%;">Summarizing multiple-choice questions</a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->

<div class="container">

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->

<a name="part0005"></a>
<!-- !split -->

<h1 id="___sec39">Exercises </h1>

<p>
<!-- --- begin exercise --- -->

<h2 id="decay:exer:meshfunc">Exercise 1: Define a mesh function and visualize it</h2>

<p>
<b>a)</b>
Write a function <code>mesh_function(f, t)</code> that returns an array with
mesh point values \( f(t_0),\ldots,f(t_{N_t}) \), where <code>f</code> is a Python
function implementing a mathematical function <code>f(t)</code> and \( t_0,\ldots,t_{N_t} \)
are mesh points stored in the array <code>t</code>. Use a loop over the mesh
points and compute one mesh function value at the time.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_1_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_1_1">

<p>
The function may look like

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">mesh_function</span>(f, t):
    u <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros(<span style="color: #008000">len</span>(t))  <span style="color: #408080; font-style: italic"># or t.size</span>
    <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #008000">len</span>(t)):
        u[i] <span style="color: #666666">=</span> f(t[i])
    <span style="color: #008000; font-weight: bold">return</span> u
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>b)</b>
Use <code>mesh_function</code> to compute the mesh function corresponding to

$$
f(t) = \left\lbrace
\begin{array}{ll}
e^{-t},& 0\leq t\leq 3,\\ 
e^{-3t}, & 3 < t\leq 4
\end{array}\right.
$$

Choose a mesh \( t_n=n\Delta t \) with \( \Delta t=0.1 \).
Plot the mesh function.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_1_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_1_2">

<p>
An appropriate function is

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">demo</span>():
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(t):
        <span style="color: #008000; font-weight: bold">if</span> t <span style="color: #666666">&lt;=</span> <span style="color: #666666">3</span>:
            <span style="color: #008000; font-weight: bold">return</span> np<span style="color: #666666">.</span>exp(<span style="color: #666666">-</span>t)
        <span style="color: #008000; font-weight: bold">else</span>:
            <span style="color: #008000; font-weight: bold">return</span> np<span style="color: #666666">.</span>exp(<span style="color: #666666">-3*</span>t)

    <span style="color: #408080; font-style: italic"># Compute mesh and mesh function</span>
    t <span style="color: #666666">=</span> np<span style="color: #666666">.</span>linspace(<span style="color: #666666">0</span>, <span style="color: #666666">4</span>, <span style="color: #666666">41</span>)
    u <span style="color: #666666">=</span> mesh_function(f, t)

    <span style="color: #408080; font-style: italic"># Plot</span>
    <span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>
    plt<span style="color: #666666">.</span>plot(t, u)
    plt<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;t&#39;</span>)
    plt<span style="color: #666666">.</span>ylabel(<span style="color: #BA2121">&#39;mesh function&#39;</span>)
    plt<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;tmp.png&#39;</span>); plt<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;tmp.pdf&#39;</span>)
    plt<span style="color: #666666">.</span>show()
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
Filename: <code>mesh_function</code>.

<p>
<!-- Closing remarks for this Exercise -->

<h3 id="___sec41">Remarks </h3>

<p>
In the section <a href="._.trash82dee82e1274a586571086dca04d00308d3a0d86004.html#decay:computing:error">Computing the numerical error as a mesh function</a> we show how easy it is to
compute a mesh function by array arithmetics (or array computing).
Using this technique, one could simply implement <code>mesh_function(f,t)</code>
as <code>return f(t)</code>. However, <code>f(t)</code> will not work if there are
if tests involving <code>t</code> inside <code>f</code> as is the case in b). Typically,
<code>if t &lt; 3</code> must have <code>t &lt; 3</code> as a boolean expression, but if <code>t</code> is
array, <code>t &lt; 3</code>, is an <em>array of boolean values</em>, which is not legal
as a boolean expression in an if test.
Computing one element
at a time as suggested in a) is a way of out of this problem.

<p>
We also remark that the function in b) is the solution of \( u^{\prime}=-au \),
\( u(0)=1 \), for \( t\in [0,4] \), where \( a=1 \) for \( t\in [0,3] \) and \( a=3 \) for
\( t\in [3,4] \).

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="decay:exer:dudt">Problem 2: Differentiate a function</h2>

<p>
Given a mesh function \( u^n \) as an array <code>u</code> with \( u^n \) values at mesh
points \( t_n=n\Delta t \), the discrete derivative can be based on
centered differences:

$$
\begin{equation}
d^n = [D_{2t}u]^n =
\frac{u^{n+1}-u^{n-1}}{2\Delta t},\quad n=1,\ldots,N_t-1\tp
\tag{58}
\end{equation}
$$

At the end points we use forward and backward differences:

$$ d^0 = [D_t^+u]^n = \frac{u^{1}-u^{0}}{\Delta t},$$

and

$$ d^{N_t} = [D_t^-u]^n = \frac{u^{N_t}-u^{N_t-1}}{\Delta t}\tp$$

<p>
<b>a)</b>
Write a function
<code>differentiate(u, dt)</code> that returns the discrete derivative \( d^n \) of the
mesh function \( u^n \). The parameter <code>dt</code> reflects the
mesh spacing \( \Delta t \). Write a corresponding test function
<code>test_differentiate()</code> for verifying the implementation.

<p>
<!-- --- begin hint in exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_2_1" style="font-size: 80%;"></a>
<b>Hint.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_2_1">

<p>
The three differentiation formulas are
exact for quadratic polynomials. Use this property to verify the program.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end hint in exercise --- -->

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_2_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_2_2">

<p>
The functions can be written as

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">np</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">differentiate</span>(u, dt):
    dudt <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros(<span style="color: #008000">len</span>(u))
    <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">1</span>, <span style="color: #008000">len</span>(dudt)<span style="color: #666666">-1</span>, <span style="color: #666666">1</span>):
        dudt[i] <span style="color: #666666">=</span> (u[i<span style="color: #666666">+1</span>] <span style="color: #666666">-</span> u[i<span style="color: #666666">-1</span>])<span style="color: #666666">/</span>(<span style="color: #666666">2*</span>dt)
    i <span style="color: #666666">=</span> <span style="color: #666666">0</span>
    dudt[i] <span style="color: #666666">=</span> (u[i<span style="color: #666666">+1</span>] <span style="color: #666666">-</span> u[i])<span style="color: #666666">/</span>dt
    i <span style="color: #666666">=</span> <span style="color: #008000">len</span>(dudt)<span style="color: #666666">-1</span>
    dudt[i] <span style="color: #666666">=</span> (u[i] <span style="color: #666666">-</span> u[i<span style="color: #666666">-1</span>])<span style="color: #666666">/</span>dt
    <span style="color: #008000; font-weight: bold">return</span> dudt

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_differentiate</span>():
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Test differentiate with a linear u.&quot;&quot;&quot;</span>
    <span style="color: #408080; font-style: italic"># Expect exact results</span>
    t <span style="color: #666666">=</span> np<span style="color: #666666">.</span>linspace(<span style="color: #666666">0</span>, <span style="color: #666666">4</span>, <span style="color: #666666">9</span>)
    u <span style="color: #666666">=</span> <span style="color: #666666">2*</span>t <span style="color: #666666">+</span> <span style="color: #666666">7</span>
    dudt <span style="color: #666666">=</span> differentiate(u, dt<span style="color: #666666">=</span>t[<span style="color: #666666">1</span>]<span style="color: #666666">-</span>t[<span style="color: #666666">0</span>])
    diff <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(dudt <span style="color: #666666">-</span> <span style="color: #666666">2</span>)<span style="color: #666666">.</span>max()
    tol <span style="color: #666666">=</span> <span style="color: #666666">1E-15</span>
    <span style="color: #008000; font-weight: bold">assert</span> diff <span style="color: #666666">&lt;</span> tol
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>b)</b>
A standard implementation of the formula <a href="#mjx-eqn-58">(58)</a> is to
have a loop over \( i \). For large \( N_t \), such loop may run slowly in
Python. A technique for speeding up the computations, called vectorization
or array computing,
replaces the loop by array operations. To see how this can be done in
the present mathematical problem, we
define two arrays

$$
\begin{align*}
u^+ &= (u^2,u^3,\ldots,u^{N_t}),
u^- &= (u^0,u^1,\ldots,u^{N_t-2})\tp
\end{align*}
$$

The formula <a href="#mjx-eqn-58">(58)</a> can now be expressed as

$$ (d^1,d^2,\ldots,d^{N_t-1}) = \frac{1}{2\Delta t}(u^+ - u^-)\tp$$

The corresponding Python code reads

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">d[<span style="color: #666666">1</span>:<span style="color: #666666">-1</span>] <span style="color: #666666">=</span> (u[<span style="color: #666666">2</span>:] <span style="color: #666666">-</span> u[<span style="color: #666666">0</span>:<span style="color: #666666">-2</span>])<span style="color: #666666">/</span>(<span style="color: #666666">2*</span>dt)
<span style="color: #408080; font-style: italic"># or</span>
d[<span style="color: #666666">1</span>:N_t] <span style="color: #666666">=</span> (u[<span style="color: #666666">2</span>:N_t<span style="color: #666666">+1</span>] <span style="color: #666666">-</span> u[<span style="color: #666666">0</span>:N_t<span style="color: #666666">-1</span>])<span style="color: #666666">/</span>(<span style="color: #666666">2*</span>dt)
</pre></div>
<p>
Recall that an array slice <code>u[1:-1]</code> contains the elements in <code>u</code> starting
with index 1 and going all indices up to, but not including, the last one
(<code>-1</code>).

<p>
Use the ideas above to implement a vectorized version of the
<code>differentiate</code> function without loops. Make a corresponding
test function that compares the result with that of
<code>differentiate</code>.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_2_3" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_2_3">

<p>
Appropriate functions are

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">differentiate_vec</span>(u, dt):
    dudt <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros(<span style="color: #008000">len</span>(u))
    dudt[<span style="color: #666666">1</span>:<span style="color: #666666">-1</span>] <span style="color: #666666">=</span> (u[<span style="color: #666666">2</span>:] <span style="color: #666666">-</span> u[<span style="color: #666666">0</span>:<span style="color: #666666">-2</span>])<span style="color: #666666">/</span>(<span style="color: #666666">2*</span>dt)
    dudt[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> (u[<span style="color: #666666">1</span>] <span style="color: #666666">-</span> u[<span style="color: #666666">0</span>])<span style="color: #666666">/</span>dt
    dudt[<span style="color: #666666">-1</span>] <span style="color: #666666">=</span> (u[<span style="color: #666666">-1</span>] <span style="color: #666666">-</span> u[<span style="color: #666666">-2</span>])<span style="color: #666666">/</span>dt
    <span style="color: #008000; font-weight: bold">return</span> dudt

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_differentiate_vec</span>():
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Test differentiate_vec by comparing with differentiate.&quot;&quot;&quot;</span>
    t <span style="color: #666666">=</span> np<span style="color: #666666">.</span>linspace(<span style="color: #666666">0</span>, <span style="color: #666666">4</span>, <span style="color: #666666">9</span>)
    u <span style="color: #666666">=</span> <span style="color: #666666">2*</span>np<span style="color: #666666">.</span>sin(t) <span style="color: #666666">+</span> <span style="color: #666666">7</span>
    dudt_expected <span style="color: #666666">=</span> differentiate(u, dt<span style="color: #666666">=</span>t[<span style="color: #666666">1</span>]<span style="color: #666666">-</span>t[<span style="color: #666666">0</span>])
    dudt_computed <span style="color: #666666">=</span> differentiate_vec(u, dt<span style="color: #666666">=</span>t[<span style="color: #666666">1</span>]<span style="color: #666666">-</span>t[<span style="color: #666666">0</span>])
    diff <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(dudt_expected <span style="color: #666666">-</span> dudt_computed)<span style="color: #666666">.</span>max()
    tol <span style="color: #666666">=</span> <span style="color: #666666">1E-15</span>
    <span style="color: #008000; font-weight: bold">assert</span> diff <span style="color: #666666">&lt;</span> tol
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
Filename: <code>differentiate</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="decay:exer:intdiv">Problem 3: Experiment with divisions</h2>

<p>
Explain what happens in the following computations, where
some are mathematically unexpected:

<p>

<!-- code=ipy (!bc ipy) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #666666">&gt;&gt;&gt;</span> dt <span style="color: #666666">=</span> <span style="color: #666666">3</span>
<span style="color: #666666">&gt;&gt;&gt;</span> T <span style="color: #666666">=</span> <span style="color: #666666">8</span>
<span style="color: #666666">&gt;&gt;&gt;</span> Nt <span style="color: #666666">=</span> T<span style="color: #666666">/</span>dt
<span style="color: #666666">&gt;&gt;&gt;</span> Nt
<span style="color: #666666">2</span>
<span style="color: #666666">&gt;&gt;&gt;</span> theta <span style="color: #666666">=</span> <span style="color: #666666">1</span>; a <span style="color: #666666">=</span> <span style="color: #666666">1</span>
<span style="color: #666666">&gt;&gt;&gt;</span> (<span style="color: #666666">1</span> <span style="color: #666666">-</span> (<span style="color: #666666">1-</span>theta)<span style="color: #666666">*</span>a<span style="color: #666666">*</span>dt)<span style="color: #666666">/</span>(<span style="color: #666666">1</span> <span style="color: #666666">+</span> theta<span style="color: #666666">*</span>dt<span style="color: #666666">*</span>a)
<span style="color: #666666">0</span>
</pre></div>
<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_3_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_3_1">

<p>
We add some more investigations of the types and values involved
in the computations:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #666666">&gt;&gt;&gt;</span> dt <span style="color: #666666">=</span> <span style="color: #666666">3</span>
<span style="color: #666666">&gt;&gt;&gt;</span> T <span style="color: #666666">=</span> <span style="color: #666666">8</span>
<span style="color: #666666">&gt;&gt;&gt;</span> Nt <span style="color: #666666">=</span> T<span style="color: #666666">/</span>dt
<span style="color: #666666">&gt;&gt;&gt;</span> Nt
<span style="color: #666666">2</span>
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000">type</span>(Nt)
<span style="color: #666666">&lt;</span><span style="color: #008000">type</span> <span style="color: #BA2121">&#39;int&#39;</span><span style="color: #666666">&gt;</span>
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> linspace
<span style="color: #666666">&gt;&gt;&gt;</span> theta <span style="color: #666666">=</span> <span style="color: #666666">1</span>; a <span style="color: #666666">=</span> <span style="color: #666666">1</span>
<span style="color: #666666">&gt;&gt;&gt;</span> (<span style="color: #666666">1</span> <span style="color: #666666">-</span> (<span style="color: #666666">1-</span>theta)<span style="color: #666666">*</span>a<span style="color: #666666">*</span>dt)<span style="color: #666666">/</span>(<span style="color: #666666">1</span> <span style="color: #666666">+</span> theta<span style="color: #666666">*</span>dt<span style="color: #666666">*</span>a)
<span style="color: #666666">0</span>
<span style="color: #666666">&gt;&gt;&gt;</span> (<span style="color: #666666">1</span> <span style="color: #666666">-</span> (<span style="color: #666666">1-</span>theta)<span style="color: #666666">*</span>a<span style="color: #666666">*</span>dt)
<span style="color: #666666">1</span>
<span style="color: #666666">&gt;&gt;&gt;</span> (<span style="color: #666666">1</span> <span style="color: #666666">+</span> theta<span style="color: #666666">*</span>dt<span style="color: #666666">*</span>a)
<span style="color: #666666">2</span>
</pre></div>
<p>
From this we realize that the unexpected results are caused by
integer division: <code>int</code> object divided by <code>int</code> object.
For example,
<code>Nt</code> is an integer, not a real as we want, because 8/3 according integer
division is 2, not the 2.66666 approximation to \( \frac{8}{3} \).

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>pyproblems</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="decay:exer:decay1err">Problem 4: Experiment with wrong computations</h2>

<p>
Consider the <code>solver</code> function in the <a href="http://tinyurl.com/ofkw6kc/alg/decay_v1.py" target="_self"><tt>decay_v1.py</tt></a> file
and the following call:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">u, t <span style="color: #666666">=</span> solver(I<span style="color: #666666">=1</span>, a<span style="color: #666666">=1</span>, T<span style="color: #666666">=7</span>, dt<span style="color: #666666">=2</span>, theta<span style="color: #666666">=1</span>)
</pre></div>
<p>
The output becomes

<p>

<!-- code=text (!bc dat) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">t= 0.000 u=1
t= 2.000 u=0
t= 4.000 u=0
t= 6.000 u=0
</pre></div>
<p>
Print out the result of all intermediate computations and use
<code>type(v)</code> to see the object type of the result stored in some variable <code>v</code>.
Examine the intermediate calculations and explain
why <code>u</code> is wrong and why we compute up to \( t=6 \) only even though we
specified \( T=7 \).

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_4_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_4_1">

<p>
A code for investigating this problem may look as follows.

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">solver</span>(I, a, T, dt, theta):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Solve u&#39;=-a*u, u(0)=I, for t in (0,T] with steps of dt.&quot;&quot;&quot;</span>
    Nt <span style="color: #666666">=</span> <span style="color: #008000">int</span>(T<span style="color: #666666">/</span>dt)            <span style="color: #408080; font-style: italic"># no of time intervals</span>
    T <span style="color: #666666">=</span> Nt<span style="color: #666666">*</span>dt                 <span style="color: #408080; font-style: italic"># adjust T to fit time step dt</span>
    u <span style="color: #666666">=</span> zeros(Nt<span style="color: #666666">+1</span>)           <span style="color: #408080; font-style: italic"># array of u[n] values</span>
    t <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, T, Nt<span style="color: #666666">+1</span>)  <span style="color: #408080; font-style: italic"># time mesh</span>

    u[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> I                  <span style="color: #408080; font-style: italic"># assign initial condition</span>
    <span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">0</span>, Nt):    <span style="color: #408080; font-style: italic"># n=0,1,...,Nt-1</span>
        factor1 <span style="color: #666666">=</span> (<span style="color: #666666">1</span> <span style="color: #666666">-</span> (<span style="color: #666666">1-</span>theta)<span style="color: #666666">*</span>a<span style="color: #666666">*</span>dt)
        factor2 <span style="color: #666666">=</span> (<span style="color: #666666">1</span> <span style="color: #666666">+</span> theta<span style="color: #666666">*</span>dt<span style="color: #666666">*</span>a)
        factor3 <span style="color: #666666">=</span> factor1<span style="color: #666666">/</span>factor2
        <span style="color: #008000; font-weight: bold">print</span> factor1, <span style="color: #008000">type</span>(factor1), factor2, <span style="color: #008000">type</span>(factor2),
        <span style="color: #008000; font-weight: bold">print</span> factor3, <span style="color: #008000">type</span>(factor3)
        u[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> (<span style="color: #666666">1</span> <span style="color: #666666">-</span> (<span style="color: #666666">1-</span>theta)<span style="color: #666666">*</span>a<span style="color: #666666">*</span>dt)<span style="color: #666666">/</span>(<span style="color: #666666">1</span> <span style="color: #666666">+</span> theta<span style="color: #666666">*</span>dt<span style="color: #666666">*</span>a)<span style="color: #666666">*</span>u[n]
    <span style="color: #008000; font-weight: bold">return</span> u, t

<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #666666">*</span>
u, t <span style="color: #666666">=</span> solver(I<span style="color: #666666">=1</span>, a<span style="color: #666666">=1</span>, T<span style="color: #666666">=7</span>, dt<span style="color: #666666">=2</span>, theta<span style="color: #666666">=1</span>)

<span style="color: #408080; font-style: italic"># Write out a table of t and u values:</span>
<span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #008000">len</span>(t)):
    <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;t=</span><span style="color: #BB6688; font-weight: bold">%6.3f</span><span style="color: #BA2121"> u=</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> (t[i], u[i])
    <span style="color: #408080; font-style: italic"># or print &#39;t={t:6.3f} u={u:g}&#39;.format(t=t[i], u=u[i])</span>
</pre></div>
<p>
Running this code shows

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; python decay_v1_err.py
1 &lt;type &#39;int&#39;&gt; 3 &lt;type &#39;int&#39;&gt; 0 &lt;type &#39;int&#39;&gt;
1 &lt;type &#39;int&#39;&gt; 3 &lt;type &#39;int&#39;&gt; 0 &lt;type &#39;int&#39;&gt;
1 &lt;type &#39;int&#39;&gt; 3 &lt;type &#39;int&#39;&gt; 0 &lt;type &#39;int&#39;&gt;
t= 0.000 u=1
t= 2.000 u=0
t= 4.000 u=0
t= 6.000 u=0
</pre></div>
<p>
We realize that we have integer divided by integer in the numerical
formula, i.e., the result of 1/3 is 0 because of integer division.
This fraction is multiplied by <code>u[n]</code>, but the result remains zero.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>decay_v1_err</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="decay:exer:plot:error">Problem 5: Plot the error function</h2>

<p>
Solve the problem \( u'=-au \), \( u(0)=I \), using the Forward Euler, Backward
Euler, and Crank-Nicolson schemes. For each scheme, plot the error mesh
function \( e^n = \uex(t_n)-u^n \) for \( \Delta t=0.1, 0.05, 0.025 \),
where \( \uex \) is the exact solution of the ODE and
\( u^n \) is the numerical solution at mesh point \( t_n \).

<p>
<!-- --- begin hint in exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_5_1" style="font-size: 80%;"></a>
<b>Hint.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_5_1">

<p>
Modify the <a href="http://tinyurl.com/ofkw6kc/alg/decay_plot_mpl.py" target="_self"><tt>decay_plot_mpl.py</tt></a> code.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end hint in exercise --- -->

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_5_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_5_2">

<p>
Looking at the <code>decay_plot_mpl.py</code> file, we realize that we only
need to change the <code>explore</code> method such that the error and not
the solutions are plotted. We also need to run a loop over
\( \Delta t \) values and get all the corresponding curves in the same
plot. Quite some editing is necessary. Also the <code>main</code> function needs
some edits.

<p>
The <code>solver</code> and <code>exact_solution</code> functions are not altered.
The <code>explore</code> and <code>main</code> functions as well as the call to <code>main</code> are
edited to:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">explore</span>(I, a, T, dt_values, theta<span style="color: #666666">=0.5</span>):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;</span>
<span style="color: #BA2121; font-style: italic">    Run cases with the solver, compute error measure,</span>
<span style="color: #BA2121; font-style: italic">    and plot the error.</span>
<span style="color: #BA2121; font-style: italic">    &quot;&quot;&quot;</span>
    figure() <span style="color: #408080; font-style: italic"># create new plot</span>
    <span style="color: #008000; font-weight: bold">for</span> dt <span style="color: #AA22FF; font-weight: bold">in</span> dt_values:
        <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;dt&#39;</span>, dt
        u, t <span style="color: #666666">=</span> solver(I, a, T, dt, theta)
        <span style="color: #408080; font-style: italic"># Numerical solution</span>
        u_e <span style="color: #666666">=</span> u_exact(t, I, a)
        e <span style="color: #666666">=</span> u_e <span style="color: #666666">-</span> u
        plot(t, e)
        hold(<span style="color: #BA2121">&#39;on&#39;</span>)
    legend([<span style="color: #BA2121">&#39;dt=</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> dt <span style="color: #008000; font-weight: bold">for</span> dt <span style="color: #AA22FF; font-weight: bold">in</span> dt_values])
    xlabel(<span style="color: #BA2121">&#39;t&#39;</span>)
    ylabel(<span style="color: #BA2121">&#39;u&#39;</span>)
    title(<span style="color: #BA2121">&#39;theta=</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> theta)
    theta2name <span style="color: #666666">=</span> {<span style="color: #666666">0</span>: <span style="color: #BA2121">&#39;FE&#39;</span>, <span style="color: #666666">1</span>: <span style="color: #BA2121">&#39;BE&#39;</span>, <span style="color: #666666">0.5</span>: <span style="color: #BA2121">&#39;CN&#39;</span>}
    savefig(<span style="color: #BA2121">&#39;</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">_</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">.png&#39;</span> <span style="color: #666666">%</span> (theta2name[theta], dt))
    savefig(<span style="color: #BA2121">&#39;</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">_</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">.pdf&#39;</span> <span style="color: #666666">%</span> (theta2name[theta], dt))

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">main</span>(I, a, T, dt_values, theta_values<span style="color: #666666">=</span>(<span style="color: #666666">0</span>, <span style="color: #666666">0.5</span>, <span style="color: #666666">1</span>)):
    <span style="color: #008000; font-weight: bold">for</span> theta <span style="color: #AA22FF; font-weight: bold">in</span> theta_values:
        explore(I, a, T, dt_values, theta)

dt <span style="color: #666666">=</span> <span style="color: #666666">0.1</span>
dt_values <span style="color: #666666">=</span> [dt, dt<span style="color: #666666">/4</span>, dt<span style="color: #666666">/8</span>]
main(I<span style="color: #666666">=1</span>, a<span style="color: #666666">=2</span>, T<span style="color: #666666">=5</span>, dt_values<span style="color: #666666">=</span>dt_values)
show()
</pre></div>
<p>
<center><p><img src="fig-alg/decay_plot_error.png" align="bottom" width=800></p></center>

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>decay_plot_error</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="decay:exer:inexact:output">Problem 6: Change formatting of numbers and debug</h2>

<p>
The <a href="http://tinyurl.com/ofkw6kc/alg/decay_memsave.py" target="_self"><tt>decay_memsave.py</tt></a> program
writes the time values and solution values to a file which looks
like
<p>

<!-- code=text typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">0.0000000000000000E+00  1.0000000000000000E+00
2.0000000000000001E-01  8.3333333333333337E-01
4.0000000000000002E-01  6.9444444444444453E-01
6.0000000000000009E-01  5.7870370370370383E-01
8.0000000000000004E-01  4.8225308641975323E-01
1.0000000000000000E+00  4.0187757201646102E-01
1.2000000000000000E+00  3.3489797668038418E-01
1.3999999999999999E+00  2.7908164723365347E-01
</pre></div>
<p>
Modify the file output such that it looks like
<p>

<!-- code=text (!bc dat) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">0.000  1.00000
0.200  0.83333
0.400  0.69444
0.600  0.57870
0.800  0.48225
1.000  0.40188
1.200  0.33490
1.400  0.27908
</pre></div>
<p>
If you have just modified the formatting of numbers in the file,
running the modified program
<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; python decay_memsave_v2.py --T 10 --theta 1 \ 
          --dt 0.2 --makeplot
</pre></div>
<p>
leads to printing of the message <code>Bug in the implementation!</code> in the
terminal window. Why?

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_6_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_6_1">

<p>
The new formatting is obtained by replacing the format <code>%.16E</code> for
<code>t</code> by <code>%.3f</code> and the format for <code>u</code> must be <code>%.5f</code>.

<p>
With only 5 decimals in the file, the <code>test_solver_minmem</code> function compares
truncated elements <code>u</code>, accurate only to \( 10^{-5} \) with the
exact discrete solution and applies a far too small <code>tol</code> value.
<code>tol</code> must be <code>1E-4</code>.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>decay_memsave_v2</code>.

<p>
<!-- --- end exercise --- -->

<p>
<p>
<!-- navigation buttons at the bottom of the page -->
<ul class="pager">
  <li class="previous">
    <a href="._.trash82dee82e1274a586571086dca04d00308d3a0d86004.html">&larr; Prev</a>
  </li>
  <li class="next">
    <a href="._.trash82dee82e1274a586571086dca04d00308d3a0d86006.html">Next &rarr;</a>
  </li>
</ul>
<!-- ------------------- end of main content --------------- -->

</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<!-- Bootstrap footer
<footer>
<a href="http://..."><img width="250" align=right src="http://..."></a>
</footer>
-->


<center style="font-size:80%">
<!-- copyright only on the titlepage -->
</center>


</body>
</html>
    

<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Algorithms and implementations for exponential decay models">
<meta name="keywords" content="decay ODE,exponential decay,mesh,grid,mesh function,finite differences,forward difference,finite differences forward,difference equation,discrete equation,algebraic equation,finite difference scheme,Forward Euler scheme,backward difference,finite differences backward,backward scheme, 1-step,Backward Euler scheme,Crank-Nicolson scheme,centered difference,finite differences centered,averaging arithmetic,weighted average,theta-rule,$\theta$-rule,time step,finite difference operator notation,operator notation, finite differences,directory,folder,doc strings,printf format,format string syntax (Python),plotting curves,visualizing curves,representative (mesh function),array arithmetics,array computing,vectorization,continuous function norms,norm continuous,discrete function norms,mesh function norms,norm discrete (mesh function),error norms,scalar computing,PNG plot,PDF plot,EPS plot,viewing graphics files,cropping images,array arithmetics,array computing,vectorization">

<title>Algorithms and implementations for exponential decay models</title>

<!-- Bootstrap style: bootswatch_journal -->
<link href="http://netdna.bootstrapcdn.com/bootswatch/3.1.1/journal/bootstrap.min.css" rel="stylesheet">
<!-- not necessary
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->

<style type="text/css">
/* Let inline verbatim have the same color as the surroundings */
code { color: inherit; background-color: transparent; }
</style>


</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [('Finite difference methods',
               1,
               'decay:basics',
               'decay:basics'),
              ('A basic model for exponential decay',
               2,
               'decay:model',
               'decay:model'),
              ('The exact solution', 3, None, '___sec2'),
              ('A complete problem formulation', 3, None, '___sec3'),
              ('The Forward Euler scheme',
               2,
               'decay:schemes:FE',
               'decay:schemes:FE'),
              ('Step 1: Discretizing the domain', 3, None, '___sec5'),
              ('Step 2: Fulfilling the equation at discrete time points',
               3,
               None,
               '___sec6'),
              ('Step 3: Replacing derivatives by finite differences',
               3,
               None,
               '___sec7'),
              ('Step 4: Formulating a recursive algorithm',
               3,
               None,
               '___sec8'),
              ('Interpretation', 3, None, '___sec9'),
              ('Computing with the recursive formula', 3, None, '___sec10'),
              ('The Backward Euler scheme',
               2,
               'decay:schemes:BE',
               'decay:schemes:BE'),
              ('The Crank-Nicolson scheme',
               2,
               'decay:schemes:CN',
               'decay:schemes:CN'),
              ('The unifying $\\theta$-rule',
               2,
               'decay:schemes:theta',
               'decay:schemes:theta'),
              ('Constant time step', 2, None, '___sec14'),
              ('Mathematical derivation of finite difference formulas',
               2,
               'decay:fd:taylor',
               'decay:fd:taylor'),
              ('The forward difference', 3, None, '___sec16'),
              ('The backward difference', 3, None, '___sec17'),
              ('The centered difference', 3, None, '___sec18'),
              ('Compact operator notation for finite differences',
               2,
               'decay:fd:op',
               'decay:fd:op'),
              ('Implementation', 1, 'decay:impl1', 'decay:impl1'),
              ('Computer language: Python', 2, None, '___sec21'),
              ('Making a solver function', 2, 'decay:py1', 'decay:py1'),
              ('Integer division', 2, None, '___sec23'),
              ('Doc strings', 2, None, '___sec24'),
              ('Formatting numbers', 2, None, '___sec25'),
              ('Running the program', 2, None, '___sec26'),
              ('Plotting the solution', 2, None, '___sec27'),
              ('Verifying the implementation', 2, None, '___sec28'),
              ('Running a few algorithmic steps by hand',
               3,
               None,
               '___sec29'),
              ('Computing the numerical error as a mesh function',
               2,
               'decay:computing:error',
               'decay:computing:error'),
              ('Computing the norm of the error mesh function',
               2,
               'decay:computing:error:norm',
               'decay:computing:error:norm'),
              ('Scalar computing', 3, None, '___sec32'),
              ('Experiments with computing and plotting',
               2,
               None,
               '___sec33'),
              ('Combining plot files', 3, None, '___sec34'),
              ('Plotting with SciTools', 3, None, '___sec35'),
              ('Memory-saving implementation', 2, None, '___sec36'),
              ('Exercises', 1, None, '___sec37'),
              ('Exercise 1: Define a mesh function and visualize it',
               2,
               'decay:exer:meshfunc',
               'decay:exer:meshfunc'),
              ('Remarks', 3, None, '___sec39'),
              ('Problem 2: Differentiate a function',
               2,
               'decay:exer:dudt',
               'decay:exer:dudt'),
              ('Problem 3: Experiment with divisions',
               2,
               'decay:exer:intdiv',
               'decay:exer:intdiv'),
              ('Problem 4: Experiment with wrong computations',
               2,
               'decay:exer:decay1err',
               'decay:exer:decay1err'),
              ('Problem 5: Plot the error function',
               2,
               'decay:exer:plot:error',
               'decay:exer:plot:error'),
              ('Problem 6: Change formatting of numbers and debug',
               2,
               'decay:exer:inexact:output',
               'decay:exer:inexact:output'),
              ('Bibliography', 1, None, '___sec45')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "none"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<!-- newcommands_keep.tex -->
$$
\newcommand{\half}{\frac{1}{2}}
\newcommand{\tp}{\thinspace .}
\newcommand{\uex}{{u_{\small\mbox{e}}}}
$$




    
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="alg-sol.html">Algorithms and implementations for exponential decay models</a>
  </div>
  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="._alg-sol001.html#decay:basics" style="font-size: 80%;">Finite difference methods</a></li>
     <!-- navigation toc: --> <li><a href="._alg-sol002.html#decay:impl1" style="font-size: 80%;">Implementation</a></li>
     <!-- navigation toc: --> <li><a href="#___sec37" style="font-size: 80%;">Exercises</a></li>
     <!-- navigation toc: --> <li><a href="._alg-sol004.html#___sec45" style="font-size: 80%;">Bibliography</a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->

<div class="container">

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->

<a name="part0003"></a>
<!-- !split -->

<h1 id="___sec37">Exercises </h1>

<p>
<!-- --- begin exercise --- -->

<h2 id="decay:exer:meshfunc">Exercise 1: Define a mesh function and visualize it</h2>

<p>
<b>a)</b>
Write a function <code>mesh_function(f, t)</code> that returns an array with
mesh point values \( f(t_0),\ldots,f(t_{N_t}) \), where <code>f</code> is a Python
function implementing a mathematical function <code>f(t)</code> and \( t_0,\ldots,t_{N_t} \)
are mesh points stored in the array <code>t</code>. Use a loop over the mesh
points and compute one mesh function value at the time.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_1_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_1_1">

<p>
The function may look like

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">mesh_function</span>(f, t):
    u <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros(<span style="color: #008000">len</span>(t))  <span style="color: #408080; font-style: italic"># or t.size</span>
    <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #008000">len</span>(t)):
        u[i] <span style="color: #666666">=</span> f(t[i])
    <span style="color: #008000; font-weight: bold">return</span> u
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>b)</b>
Use <code>mesh_function</code> to compute the mesh function corresponding to

$$
f(t) = \left\lbrace
\begin{array}{ll}
e^{-t},& 0\leq t\leq 3,\\ 
e^{-3t}, & 3 < t\leq 4
\end{array}\right.
$$

Choose a mesh \( t_n=n\Delta t \) with \( \Delta t=0.1 \).
Plot the mesh function.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_1_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_1_2">

<p>
An appropriate function is

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">demo</span>():
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(t):
        <span style="color: #008000; font-weight: bold">if</span> t <span style="color: #666666">&lt;=</span> <span style="color: #666666">3</span>:
            <span style="color: #008000; font-weight: bold">return</span> np<span style="color: #666666">.</span>exp(<span style="color: #666666">-</span>t)
        <span style="color: #008000; font-weight: bold">else</span>:
            <span style="color: #008000; font-weight: bold">return</span> np<span style="color: #666666">.</span>exp(<span style="color: #666666">-3*</span>t)

    <span style="color: #408080; font-style: italic"># Compute mesh and mesh function</span>
    t <span style="color: #666666">=</span> np<span style="color: #666666">.</span>linspace(<span style="color: #666666">0</span>, <span style="color: #666666">4</span>, <span style="color: #666666">41</span>)
    u <span style="color: #666666">=</span> mesh_function(f, t)

    <span style="color: #408080; font-style: italic"># Plot</span>
    <span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>
    plt<span style="color: #666666">.</span>plot(t, u)
    plt<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;t&#39;</span>)
    plt<span style="color: #666666">.</span>ylabel(<span style="color: #BA2121">&#39;mesh function&#39;</span>)
    plt<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;tmp.png&#39;</span>); plt<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;tmp.pdf&#39;</span>)
    plt<span style="color: #666666">.</span>show()
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
Filename: <code>mesh_function</code>.

<p>
<!-- Closing remarks for this Exercise -->

<h3 id="___sec39">Remarks </h3>

<p>
In the section <a href="._alg-sol002.html#decay:computing:error">Computing the numerical error as a mesh function</a> we show how easy it is to
compute a mesh function by array arithmetics (or array computing).
Using this technique, one could simply implement <code>mesh_function(f,t)</code>
as <code>return f(t)</code>. However, <code>f(t)</code> will not work if there are
if tests involving <code>t</code> inside <code>f</code> as is the case in b). Typically,
<code>if t &lt; 3</code> must have <code>t &lt; 3</code> as a boolean expression, but if <code>t</code> is
array, <code>t &lt; 3</code>, is an <em>array of boolean values</em>, which is not legal
as a boolean expression in an if test.
Computing one element
at a time as suggested in a) is a way of out of this problem.

<p>
We also remark that the function in b) is the solution of \( u^{\prime}=-au \),
\( u(0)=1 \), for \( t\in [0,4] \), where \( a=1 \) for \( t\in [0,3] \) and \( a=3 \) for
\( t\in [3,4] \).

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="decay:exer:dudt">Problem 2: Differentiate a function</h2>

<p>
Given a mesh function \( u^n \) as an array <code>u</code> with \( u^n \) values at mesh
points \( t_n=n\Delta t \), the discrete derivative can be based on
centered differences:

$$
\begin{equation}
d^n = [D_{2t}u]^n =
\frac{u^{n+1}-u^{n-1}}{2\Delta t},\quad n=1,\ldots,N_t-1\tp
\tag{58}
\end{equation}
$$

At the end points we use forward and backward differences:

$$ d^0 = [D_t^+u]^n = \frac{u^{1}-u^{0}}{\Delta t},$$

and

$$ d^{N_t} = [D_t^-u]^n = \frac{u^{N_t}-u^{N_t-1}}{\Delta t}\tp$$

<p>
<b>a)</b>
Write a function
<code>differentiate(u, dt)</code> that returns the discrete derivative \( d^n \) of the
mesh function \( u^n \). The parameter <code>dt</code> reflects the
mesh spacing \( \Delta t \). Write a corresponding test function
<code>test_differentiate()</code> for verifying the implementation.

<p>
<!-- --- begin hint in exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_2_1" style="font-size: 80%;"></a>
<b>Hint.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_2_1">

<p>
The three differentiation formulas are
exact for quadratic polynomials. Use this property to verify the program.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end hint in exercise --- -->

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_2_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_2_2">

<p>
The functions can be written as

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">np</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">differentiate</span>(u, dt):
    dudt <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros(<span style="color: #008000">len</span>(u))
    <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">1</span>, <span style="color: #008000">len</span>(dudt)<span style="color: #666666">-1</span>, <span style="color: #666666">1</span>):
        dudt[i] <span style="color: #666666">=</span> (u[i<span style="color: #666666">+1</span>] <span style="color: #666666">-</span> u[i<span style="color: #666666">-1</span>])<span style="color: #666666">/</span>(<span style="color: #666666">2*</span>dt)
    i <span style="color: #666666">=</span> <span style="color: #666666">0</span>
    dudt[i] <span style="color: #666666">=</span> (u[i<span style="color: #666666">+1</span>] <span style="color: #666666">-</span> u[i])<span style="color: #666666">/</span>dt
    i <span style="color: #666666">=</span> <span style="color: #008000">len</span>(dudt)<span style="color: #666666">-1</span>
    dudt[i] <span style="color: #666666">=</span> (u[i] <span style="color: #666666">-</span> u[i<span style="color: #666666">-1</span>])<span style="color: #666666">/</span>dt
    <span style="color: #008000; font-weight: bold">return</span> dudt

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_differentiate</span>():
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Test differentiate with a linear u.&quot;&quot;&quot;</span>
    <span style="color: #408080; font-style: italic"># Expect exact results</span>
    t <span style="color: #666666">=</span> np<span style="color: #666666">.</span>linspace(<span style="color: #666666">0</span>, <span style="color: #666666">4</span>, <span style="color: #666666">9</span>)
    u <span style="color: #666666">=</span> <span style="color: #666666">2*</span>t <span style="color: #666666">+</span> <span style="color: #666666">7</span>
    dudt <span style="color: #666666">=</span> differentiate(u, dt<span style="color: #666666">=</span>t[<span style="color: #666666">1</span>]<span style="color: #666666">-</span>t[<span style="color: #666666">0</span>])
    diff <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(dudt <span style="color: #666666">-</span> <span style="color: #666666">2</span>)<span style="color: #666666">.</span>max()
    tol <span style="color: #666666">=</span> <span style="color: #666666">1E-15</span>
    <span style="color: #008000; font-weight: bold">assert</span> diff <span style="color: #666666">&lt;</span> tol
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
<b>b)</b>
A standard implementation of the formula <a href="#mjx-eqn-58">(58)</a> is to
have a loop over \( i \). For large \( N_t \), such loop may run slowly in
Python. A technique for speeding up the computations, called vectorization
or array computing,
replaces the loop by array operations. To see how this can be done in
the present mathematical problem, we
define two arrays

$$
\begin{align*}
u^+ &= (u^2,u^3,\ldots,u^{N_t}),
u^- &= (u^0,u^1,\ldots,u^{N_t-2})\tp
\end{align*}
$$

The formula <a href="#mjx-eqn-58">(58)</a> can now be expressed as

$$ (d^1,d^2,\ldots,d^{N_t-1}) = \frac{1}{2\Delta t}(u^+ - u^-)\tp$$

The corresponding Python code reads

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">d[<span style="color: #666666">1</span>:<span style="color: #666666">-1</span>] <span style="color: #666666">=</span> (u[<span style="color: #666666">2</span>:] <span style="color: #666666">-</span> u[<span style="color: #666666">0</span>:<span style="color: #666666">-2</span>])<span style="color: #666666">/</span>(<span style="color: #666666">2*</span>dt)
<span style="color: #408080; font-style: italic"># or</span>
d[<span style="color: #666666">1</span>:N_t] <span style="color: #666666">=</span> (u[<span style="color: #666666">2</span>:N_t<span style="color: #666666">+1</span>] <span style="color: #666666">-</span> u[<span style="color: #666666">0</span>:N_t<span style="color: #666666">-1</span>])<span style="color: #666666">/</span>(<span style="color: #666666">2*</span>dt)
</pre></div>
<p>
Recall that an array slice <code>u[1:-1]</code> contains the elements in <code>u</code> starting
with index 1 and going all indices up to, but not including, the last one
(<code>-1</code>).

<p>
Use the ideas above to implement a vectorized version of the
<code>differentiate</code> function without loops. Make a corresponding
test function that compares the result with that of
<code>differentiate</code>.

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_2_3" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_2_3">

<p>
Appropriate functions are

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">differentiate_vec</span>(u, dt):
    dudt <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros(<span style="color: #008000">len</span>(u))
    dudt[<span style="color: #666666">1</span>:<span style="color: #666666">-1</span>] <span style="color: #666666">=</span> (u[<span style="color: #666666">2</span>:] <span style="color: #666666">-</span> u[<span style="color: #666666">0</span>:<span style="color: #666666">-2</span>])<span style="color: #666666">/</span>(<span style="color: #666666">2*</span>dt)
    dudt[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> (u[<span style="color: #666666">1</span>] <span style="color: #666666">-</span> u[<span style="color: #666666">0</span>])<span style="color: #666666">/</span>dt
    dudt[<span style="color: #666666">-1</span>] <span style="color: #666666">=</span> (u[<span style="color: #666666">-1</span>] <span style="color: #666666">-</span> u[<span style="color: #666666">-2</span>])<span style="color: #666666">/</span>dt
    <span style="color: #008000; font-weight: bold">return</span> dudt

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_differentiate_vec</span>():
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Test differentiate_vec by comparing with differentiate.&quot;&quot;&quot;</span>
    t <span style="color: #666666">=</span> np<span style="color: #666666">.</span>linspace(<span style="color: #666666">0</span>, <span style="color: #666666">4</span>, <span style="color: #666666">9</span>)
    u <span style="color: #666666">=</span> <span style="color: #666666">2*</span>np<span style="color: #666666">.</span>sin(t) <span style="color: #666666">+</span> <span style="color: #666666">7</span>
    dudt_expected <span style="color: #666666">=</span> differentiate(u, dt<span style="color: #666666">=</span>t[<span style="color: #666666">1</span>]<span style="color: #666666">-</span>t[<span style="color: #666666">0</span>])
    dudt_computed <span style="color: #666666">=</span> differentiate_vec(u, dt<span style="color: #666666">=</span>t[<span style="color: #666666">1</span>]<span style="color: #666666">-</span>t[<span style="color: #666666">0</span>])
    diff <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(dudt_expected <span style="color: #666666">-</span> dudt_computed)<span style="color: #666666">.</span>max()
    tol <span style="color: #666666">=</span> <span style="color: #666666">1E-15</span>
    <span style="color: #008000; font-weight: bold">assert</span> diff <span style="color: #666666">&lt;</span> tol
</pre></div>
<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->

<p>
Filename: <code>differentiate</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="decay:exer:intdiv">Problem 3: Experiment with divisions</h2>

<p>
Explain what happens in the following computations, where
some are mathematically unexpected:

<p>

<!-- code=ipy (!bc ipy) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #666666">&gt;&gt;&gt;</span> dt <span style="color: #666666">=</span> <span style="color: #666666">3</span>
<span style="color: #666666">&gt;&gt;&gt;</span> T <span style="color: #666666">=</span> <span style="color: #666666">8</span>
<span style="color: #666666">&gt;&gt;&gt;</span> Nt <span style="color: #666666">=</span> T<span style="color: #666666">/</span>dt
<span style="color: #666666">&gt;&gt;&gt;</span> Nt
<span style="color: #666666">2</span>
<span style="color: #666666">&gt;&gt;&gt;</span> theta <span style="color: #666666">=</span> <span style="color: #666666">1</span>; a <span style="color: #666666">=</span> <span style="color: #666666">1</span>
<span style="color: #666666">&gt;&gt;&gt;</span> (<span style="color: #666666">1</span> <span style="color: #666666">-</span> (<span style="color: #666666">1-</span>theta)<span style="color: #666666">*</span>a<span style="color: #666666">*</span>dt)<span style="color: #666666">/</span>(<span style="color: #666666">1</span> <span style="color: #666666">+</span> theta<span style="color: #666666">*</span>dt<span style="color: #666666">*</span>a)
<span style="color: #666666">0</span>
</pre></div>
<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_3_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_3_1">

<p>
We add some more investigations of the types and values involved
in the computations:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #666666">&gt;&gt;&gt;</span> dt <span style="color: #666666">=</span> <span style="color: #666666">3</span>
<span style="color: #666666">&gt;&gt;&gt;</span> T <span style="color: #666666">=</span> <span style="color: #666666">8</span>
<span style="color: #666666">&gt;&gt;&gt;</span> Nt <span style="color: #666666">=</span> T<span style="color: #666666">/</span>dt
<span style="color: #666666">&gt;&gt;&gt;</span> Nt
<span style="color: #666666">2</span>
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000">type</span>(Nt)
<span style="color: #666666">&lt;</span><span style="color: #008000">type</span> <span style="color: #BA2121">&#39;int&#39;</span><span style="color: #666666">&gt;</span>
<span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> linspace
<span style="color: #666666">&gt;&gt;&gt;</span> theta <span style="color: #666666">=</span> <span style="color: #666666">1</span>; a <span style="color: #666666">=</span> <span style="color: #666666">1</span>
<span style="color: #666666">&gt;&gt;&gt;</span> (<span style="color: #666666">1</span> <span style="color: #666666">-</span> (<span style="color: #666666">1-</span>theta)<span style="color: #666666">*</span>a<span style="color: #666666">*</span>dt)<span style="color: #666666">/</span>(<span style="color: #666666">1</span> <span style="color: #666666">+</span> theta<span style="color: #666666">*</span>dt<span style="color: #666666">*</span>a)
<span style="color: #666666">0</span>
<span style="color: #666666">&gt;&gt;&gt;</span> (<span style="color: #666666">1</span> <span style="color: #666666">-</span> (<span style="color: #666666">1-</span>theta)<span style="color: #666666">*</span>a<span style="color: #666666">*</span>dt)
<span style="color: #666666">1</span>
<span style="color: #666666">&gt;&gt;&gt;</span> (<span style="color: #666666">1</span> <span style="color: #666666">+</span> theta<span style="color: #666666">*</span>dt<span style="color: #666666">*</span>a)
<span style="color: #666666">2</span>
</pre></div>
<p>
From this we realize that the unexpected results are caused by
integer division: <code>int</code> object divided by <code>int</code> object.
For example,
<code>Nt</code> is an integer, not a real as we want, because 8/3 according integer
division is 2, not the 2.66666 approximation to \( \frac{8}{3} \).

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>pyproblems</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="decay:exer:decay1err">Problem 4: Experiment with wrong computations</h2>

<p>
Consider the <code>solver</code> function in the <a href="http://tinyurl.com/ofkw6kc/alg/decay_v1.py" target="_self"><tt>decay_v1.py</tt></a> file
and the following call:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">u, t <span style="color: #666666">=</span> solver(I<span style="color: #666666">=1</span>, a<span style="color: #666666">=1</span>, T<span style="color: #666666">=7</span>, dt<span style="color: #666666">=2</span>, theta<span style="color: #666666">=1</span>)
</pre></div>
<p>
The output becomes

<p>

<!-- code=text (!bc dat) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">t= 0.000 u=1
t= 2.000 u=0
t= 4.000 u=0
t= 6.000 u=0
</pre></div>
<p>
Print out the result of all intermediate computations and use
<code>type(v)</code> to see the object type of the result stored in some variable <code>v</code>.
Examine the intermediate calculations and explain
why <code>u</code> is wrong and why we compute up to \( t=6 \) only even though we
specified \( T=7 \).

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_4_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_4_1">

<p>
A code for investigating this problem may look as follows.

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">solver</span>(I, a, T, dt, theta):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Solve u&#39;=-a*u, u(0)=I, for t in (0,T] with steps of dt.&quot;&quot;&quot;</span>
    Nt <span style="color: #666666">=</span> <span style="color: #008000">int</span>(T<span style="color: #666666">/</span>dt)            <span style="color: #408080; font-style: italic"># no of time intervals</span>
    T <span style="color: #666666">=</span> Nt<span style="color: #666666">*</span>dt                 <span style="color: #408080; font-style: italic"># adjust T to fit time step dt</span>
    u <span style="color: #666666">=</span> zeros(Nt<span style="color: #666666">+1</span>)           <span style="color: #408080; font-style: italic"># array of u[n] values</span>
    t <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, T, Nt<span style="color: #666666">+1</span>)  <span style="color: #408080; font-style: italic"># time mesh</span>

    u[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> I                  <span style="color: #408080; font-style: italic"># assign initial condition</span>
    <span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">0</span>, Nt):    <span style="color: #408080; font-style: italic"># n=0,1,...,Nt-1</span>
        factor1 <span style="color: #666666">=</span> (<span style="color: #666666">1</span> <span style="color: #666666">-</span> (<span style="color: #666666">1-</span>theta)<span style="color: #666666">*</span>a<span style="color: #666666">*</span>dt)
        factor2 <span style="color: #666666">=</span> (<span style="color: #666666">1</span> <span style="color: #666666">+</span> theta<span style="color: #666666">*</span>dt<span style="color: #666666">*</span>a)
        factor3 <span style="color: #666666">=</span> factor1<span style="color: #666666">/</span>factor2
        <span style="color: #008000; font-weight: bold">print</span> factor1, <span style="color: #008000">type</span>(factor1), factor2, <span style="color: #008000">type</span>(factor2),
        <span style="color: #008000; font-weight: bold">print</span> factor3, <span style="color: #008000">type</span>(factor3)
        u[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> (<span style="color: #666666">1</span> <span style="color: #666666">-</span> (<span style="color: #666666">1-</span>theta)<span style="color: #666666">*</span>a<span style="color: #666666">*</span>dt)<span style="color: #666666">/</span>(<span style="color: #666666">1</span> <span style="color: #666666">+</span> theta<span style="color: #666666">*</span>dt<span style="color: #666666">*</span>a)<span style="color: #666666">*</span>u[n]
    <span style="color: #008000; font-weight: bold">return</span> u, t

<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #666666">*</span>
u, t <span style="color: #666666">=</span> solver(I<span style="color: #666666">=1</span>, a<span style="color: #666666">=1</span>, T<span style="color: #666666">=7</span>, dt<span style="color: #666666">=2</span>, theta<span style="color: #666666">=1</span>)

<span style="color: #408080; font-style: italic"># Write out a table of t and u values:</span>
<span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #008000">len</span>(t)):
    <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;t=</span><span style="color: #BB6688; font-weight: bold">%6.3f</span><span style="color: #BA2121"> u=</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> (t[i], u[i])
    <span style="color: #408080; font-style: italic"># or print &#39;t={t:6.3f} u={u:g}&#39;.format(t=t[i], u=u[i])</span>
</pre></div>
<p>
Running this code shows

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; python decay_v1_err.py
1 &lt;type &#39;int&#39;&gt; 3 &lt;type &#39;int&#39;&gt; 0 &lt;type &#39;int&#39;&gt;
1 &lt;type &#39;int&#39;&gt; 3 &lt;type &#39;int&#39;&gt; 0 &lt;type &#39;int&#39;&gt;
1 &lt;type &#39;int&#39;&gt; 3 &lt;type &#39;int&#39;&gt; 0 &lt;type &#39;int&#39;&gt;
t= 0.000 u=1
t= 2.000 u=0
t= 4.000 u=0
t= 6.000 u=0
</pre></div>
<p>
We realize that we have integer divided by integer in the numerical
formula, i.e., the result of 1/3 is 0 because of integer division.
This fraction is multiplied by <code>u[n]</code>, but the result remains zero.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>decay_v1_err</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="decay:exer:plot:error">Problem 5: Plot the error function</h2>

<p>
Solve the problem \( u'=-au \), \( u(0)=I \), using the Forward Euler, Backward
Euler, and Crank-Nicolson schemes. For each scheme, plot the error mesh
function \( e^n = \uex(t_n)-u^n \) for \( \Delta t \), \( \frac{1}{4}\Delta t \), and
\( \frac{1}{8}\Delta t \), where \( \uex \) is the exact solution of the ODE and
\( u^n \) is the numerical solution at mesh point \( t_n \).

<p>
<!-- --- begin hint in exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_5_1" style="font-size: 80%;"></a>
<b>Hint.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_5_1">

<p>
Modify the <a href="http://tinyurl.com/ofkw6kc/alg/decay_plot_mpl.py" target="_self"><tt>decay_plot_mpl.py</tt></a> code.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end hint in exercise --- -->

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_5_2" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_5_2">

<p>
Looking at the <code>decay_plot_mpl.py</code> file, we realize that we only
need to change the <code>explore</code> method such that the error and not
the solutions are plotted. We also need to run a loop over
\( \Delta t \) values and get all the corresponding curves in the same
plot. Quite some editing is necessary. Also the <code>main</code> function needs
some edits.

<p>
The <code>solver</code> and <code>exact_solution</code> functions are not altered.
The <code>explore</code> and <code>main</code> functions as well as the call to <code>main</code> are
edited to:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">explore</span>(I, a, T, dt_values, theta<span style="color: #666666">=0.5</span>):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;</span>
<span style="color: #BA2121; font-style: italic">    Run cases with the solver, compute error measure,</span>
<span style="color: #BA2121; font-style: italic">    and plot the error.</span>
<span style="color: #BA2121; font-style: italic">    &quot;&quot;&quot;</span>
    figure() <span style="color: #408080; font-style: italic"># create new plot</span>
    <span style="color: #008000; font-weight: bold">for</span> dt <span style="color: #AA22FF; font-weight: bold">in</span> dt_values:
        <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;dt&#39;</span>, dt
        u, t <span style="color: #666666">=</span> solver(I, a, T, dt, theta)    <span style="color: #408080; font-style: italic"># Numerical solution</span>
        u_e <span style="color: #666666">=</span> u_exact(t, I, a)
        e <span style="color: #666666">=</span> u_e <span style="color: #666666">-</span> u
        plot(t, e)
        hold(<span style="color: #BA2121">&#39;on&#39;</span>)
    legend([<span style="color: #BA2121">&#39;dt=</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> dt <span style="color: #008000; font-weight: bold">for</span> dt <span style="color: #AA22FF; font-weight: bold">in</span> dt_values])
    xlabel(<span style="color: #BA2121">&#39;t&#39;</span>)
    ylabel(<span style="color: #BA2121">&#39;u&#39;</span>)
    title(<span style="color: #BA2121">&#39;theta=</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> theta)
    theta2name <span style="color: #666666">=</span> {<span style="color: #666666">0</span>: <span style="color: #BA2121">&#39;FE&#39;</span>, <span style="color: #666666">1</span>: <span style="color: #BA2121">&#39;BE&#39;</span>, <span style="color: #666666">0.5</span>: <span style="color: #BA2121">&#39;CN&#39;</span>}
    savefig(<span style="color: #BA2121">&#39;</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">_</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">.png&#39;</span> <span style="color: #666666">%</span> (theta2name[theta], dt))
    savefig(<span style="color: #BA2121">&#39;</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">_</span><span style="color: #BB6688; font-weight: bold">%g</span><span style="color: #BA2121">.pdf&#39;</span> <span style="color: #666666">%</span> (theta2name[theta], dt))

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">main</span>(I, a, T, dt_values, theta_values<span style="color: #666666">=</span>(<span style="color: #666666">0</span>, <span style="color: #666666">0.5</span>, <span style="color: #666666">1</span>)):
    <span style="color: #008000; font-weight: bold">for</span> theta <span style="color: #AA22FF; font-weight: bold">in</span> theta_values:
        explore(I, a, T, dt_values, theta)

dt <span style="color: #666666">=</span> <span style="color: #666666">0.1</span>
dt_values <span style="color: #666666">=</span> [dt, dt<span style="color: #666666">/4</span>, dt<span style="color: #666666">/8</span>]
main(I<span style="color: #666666">=1</span>, a<span style="color: #666666">=2</span>, T<span style="color: #666666">=5</span>, dt_values<span style="color: #666666">=</span>dt_values)
show()
</pre></div>
<p>
<center><p><img src="fig-alg/decay_plot_error.png" align="bottom" width=800></p></center>

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>decay_plot_error</code>.

<p>
<!-- --- end exercise --- -->

<p>
<!-- --- begin exercise --- -->

<h2 id="decay:exer:inexact:output">Problem 6: Change formatting of numbers and debug</h2>

<p>
The <a href="http://tinyurl.com/ofkw6kc/alg/decay_memsave.py" target="_self"><tt>decay_memsave.py</tt></a> program
writes the time values and solution values to a file which looks
like
<p>

<!-- code=text typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">0.0000000000000000E+00  1.0000000000000000E+00
2.0000000000000001E-01  8.3333333333333337E-01
4.0000000000000002E-01  6.9444444444444453E-01
6.0000000000000009E-01  5.7870370370370383E-01
8.0000000000000004E-01  4.8225308641975323E-01
1.0000000000000000E+00  4.0187757201646102E-01
1.2000000000000000E+00  3.3489797668038418E-01
1.3999999999999999E+00  2.7908164723365347E-01
</pre></div>
<p>
Modify the file output such that it looks like
<p>

<!-- code=text (!bc dat) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">0.000  1.00000
0.200  0.83333
0.400  0.69444
0.600  0.57870
0.800  0.48225
1.000  0.40188
1.200  0.33490
1.400  0.27908
</pre></div>
<p>
If you have just modified the formatting of numbers in the file,
running the modified program
<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; python decay_memsave_v2.py --T 10 --theta 1 \ 
          --dt 0.2 --makeplot
</pre></div>
<p>
leads to printing of the message <code>Bug in the implementation!</code> in the
terminal window. Why?

<p>
<!-- --- begin solution of exercise --- -->

<p>
<a class="glyphicon glyphicon-hand-right showdetails" data-toggle="collapse"
 data-target="#exer_6_1" style="font-size: 80%;"></a>
<b>Solution.</b>
<div class="collapse-group">
<p><div class="collapse" id="exer_6_1">

<p>
The new formatting is obtained by replacing the format <code>%.16E</code> for
<code>t</code> by <code>%.3f</code> and the format for <code>u</code> must be <code>%.5f</code>.

<p>
With only 5 decimals in the file, the <code>test_solver_minmem</code> function compares
truncated elements <code>u</code>, accurate only to \( 10^{-5} \) with the
exact discrete solution and applies a far too small <code>tol</code> value.
<code>tol</code> must be <code>1E-4</code>.

<p>
</div></p>
</div>
</p>

<p>
<!-- --- end solution of exercise --- -->
Filename: <code>decay_memsave_v2</code>.

<p>
<!-- --- end exercise --- -->

<p>
<p>
<!-- navigation buttons at the bottom of the page -->
<ul class="pager">
  <li class="previous">
    <a href="._alg-sol002.html">&larr; Prev</a>
  </li>
  <li class="next">
    <a href="._alg-sol004.html">Next &rarr;</a>
  </li>
</ul>
<!-- ------------------- end of main content --------------- -->

</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<!-- Bootstrap footer
<footer>
<a href="http://..."><img width="250" align=right src="http://..."></a>
</footer>
-->


</body>
</html>
    

